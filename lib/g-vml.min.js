G.Layer.Tile=G.Layer.Tile.extend({_initContainer:function(){var a=this._map,b=G.DomUtil,c=this._container=b.create("div","g-layer");this._bg=b.create("div","g-tile-container g-zoom-animated",this._container);this._front=b.create("div","g-tile-container g-zoom-animated",this._container);a._layersFrame.appendChild(this._container);b.setZIndex(c,this._zIndex)},_destroyContainer:function(){this._container.parentNode.removeChild(this._container);delete this._container},_update:function(){var a=this._map;
if(a._isLoaded()){var b=this._zoom=this._calcNearestZoom(!0),c=this._calcVisTileInfos(!0);a.getSize();var d=a.getCenter(),e=this.options,f=e.zoomReses[b],k=e.tileSize,h=a.getDrawSize(),m=h[0],h=h[1],f=[d[0]-m*f/2,d[1]-h*f/2,d[0]+m*f/2,d[1]+h*f/2],a=a.options.maxExtent,q,p,l;this._redrawExtent=f;var f=G.ExtentUtil.intersect(f,a),r;for(r in this._tiles)p=this._tiles[r],a=p._info,q=a[0],m=a[1],l=a[2],h=e.zoomReses[l],l!==b&&(this._stopLoadingTile(p),(!e.keepResample||1>e.opacity)&&this._removeTile(r)),
p=e.originX+q*k*h,q=e.originX+(q+1)*k*h,l=e.originY-(m+1)*k*h,m=e.originY-m*k*h,(m=G.ExtentUtil.overlaps([p,l,q,m],f))||this._tileInfoExist(a,c)||this._removeTile(r);this._placeLoadedTiles(this._bg);this._placeLoadedTiles(this._front);b=this._calcTileIndex(d[0],d[1],b);this._sortTileInfos(c,b[0],b[1]);this._addTiles(c)}},_draw:function(){var a=G.DomUtil;this._map._isLoaded()&&(a.show(this._bg),a.show(this._front),a.setZIndex(this._container,this._zIndex),this._placeLoadedTiles(this._bg),this._placeLoadedTiles(this._front))},
_erase:function(){var a=G.DomUtil;a.hide(this._bg);a.hide(this._front)},_onZoomEnd:function(){var a=this._front,b=this._bg,c=G.DomUtil,d=c.Transition,c=c.Transform;a.parentNode.appendChild(a);a.style[c]="";a.style[d]="";b.style[c]="";b.style[d]="";this._zooming=!1},_clearBgBuffer:function(){var a=this._map;a&&!a._zooming&&(this._bg.innerHTML="")},_prepareBgBuffer:function(){var a=this._front,b=this._bg;this._stopLoadingTiles(b);this._front=b;this._bg=a},_placeLoadedTiles:function(a){var b=this.options.zoomReses.length,
c=this._calcNearestZoom(!0);a=a.getElementsByTagName("img");for(var d,e,f,k,h,m=0,q=a.length;m<q;m++)(d=a[m])&&d.complete&&(e=d._info,f=parseInt(e[0]),k=parseInt(e[1]),e=parseInt(e[2]),h=e==c?b+1:e,this._placeTile(d,f,k,e,h))},_addTiles:function(a){if(0!==a.length){this._numLoad=a.length;this._numLoadError=this._numLoadSuccess=0;for(var b=this.options,c=b.zoomReses.length,d,e,f,k,h,m=this.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE,q=0,p=a.length;q<p;q++){d=a[q];e=d[0];f=d[1];k=d[2];h=this._getTileName(e,
f,k);(d=this._tiles[h])?d.src==m?+new Date-d._responseTime>b.tileLiveMs&&this._loadTile(d,e,f,k):this._numLoadSuccess++:(d=this._getIdleTile(),this._tiles[h]=d,this._loadTile(d,e,f,k));if(d.parentNode!==this._front&&(this._front.appendChild(d),d._wraps))for(var l in d._wraps)(h=d._wraps[l])&&h.parentNode!==this._front&&this._front.appendChild(h);this._placeTile(d,e,f,k,c)}}},_onNewWrapTile:function(a,b){var c=a._wraps[b];c&&c.parentNode!==this._front&&this._front.appendChild(c)}});
G.Layer.Graphic=G.Layer.Graphic.extend({_initContainer:function(){var a=this._map,b=G.DomUtil,c=this._container=b.create("div","g-layer");this._vml=b.createVML("group","",c);a._layersFrame.appendChild(c);b.setZIndex(c,this._zIndex)},_update:function(){this.isVisible()?this._draw():this._erase()},_draw:function(){var a=this._map,b=G.DomUtil,c=a.getDrawSize(),d=c[0],c=c[1],e=this._vml;b.setZIndex(this._container,this._zIndex);b.show(e);e.style.width=d;e.style.height=c;e.coordsize=[d,c].join(" ");var a=
a.getRedrawExtent(),f;for(f in this._graphics)b=this._graphics[f],d=b.bbox,b._layer&&G.ExtentUtil.overlaps(d,a)?b._draw():b._erase()},_erase:function(){G.DomUtil.hide(this._vml)},_onClear:function(){var a=this._vml;a&&(a.innerHTML="")}});
G.Layer.Label=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{icons:"",cluster:[],crossOrigin:"*"},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a;this.options=G.Util.merge({},this.options,b);this._lts={};this._gx=this._gy=10},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);
if(a._isLoaded()){var b=this._zoom=this._calcNearestZoom(!0),c=a.getCenter();this._clearGrids();a=a._zoomAnim;a&&a._playing||(a=this._calcVisTileInfos(),b=this._calcTileIndex(c[0],c[1],b),this._sortTileInfos(a,b[0],b[1]),this._setLts(a))}},_setLts:function(a){if(a.length){for(var b=[],c,d,e,f,k,h=0,m=a.length;h<m;h++)c=a[h],e=c[0],f=c[1],k=c[2],c=this._getTileName(e,f,k),b.push(c),c in this._lts?(d=this._lts[c],d.loading||d.data||d.ri||this._loadLtI(e,f,k)):this._loadLtI(e,f,k),this._placeLt(c);this._dirtyTileKeys=
this._dirtyTileKeys||[];for(c in this._lts)-1<b.indexOf(c)||(this._stopLoadingLt(c),this._dirtyTileKeys.push(c))}},_checkDirtyTiles:function(){var a=this._dirtyTileKeys,b;if(a&&0<a.length)for(var c=0,d=a.length;c<d;c++)b=a[c],this._removeLt(b);this._dirtyTileKeys=[]},_placeLt:function(a){if((a=this._lts[a])&&a._info&&a.data){var b=a.data.l,c,d,e,f,k,h,m,q,p,l,r,n;for(c in b)for(r in d=b[c],e=Number(d[0]),f=Number(d[1]),d=d[6],e=[e,f],f="imgs"+c,l=a[f],l)f=l[r],k=f[0],h=f[1],m=f[2],q=f[3],p=f[4],n=
f[5],n||(f[5]=n=new G.Graphic.Point(e,null,{shape:"image",size:[h,m],offset:[q,p],image:k,imageGravity:!!d}),n.addTo(this))}},_removeLt:function(a){var b=this._lts[a];if(b&&b._info&&b.data){this._stopLoadingLt(a);var c=b.data.l,d,e,f;for(d in c)for(f in c="imgs"+d,e=b[c],e)c=e[f],(g=c[5])&&g.remove();delete this._lts[a]}},_loadLtI:function(a,b,c){var d=this,e=d._getTileName(a,b,c),f=d._lts[e]=d._lts[e]||{};f._info=[a,b,c];""!==f.data&&(f.loading=!0,a=d._getTileUrl(a,b,c,{d:"i",i:G.Browser.retina?
"@2x":""}),b={},d.options.crossOrigin&&(b.crossOrigin=d.options.crossOrigin),b={responseType:"http"===a.slice(0,4).toLowerCase()?"JSONP":"JSON",header:b,success:function(a,b){f.data=b;d._processLt(e)},error:function(a){404==a.status&&(f.data="")},complete:function(){delete f.ri;f.loading=!1}},d.options.crossOrigin&&(b.responseType="JSON"),a=G.Util.ajax(a,b),f.ri=a)},_processLt:function(a){var b=this._lts[a],c=b.data;if(c){var d=c.l,e=c.b,f=c.i,c=c.bb,k=this.options.icons||"",h,m,q,p,l,r,n,t,u;for(h in d){if(e&&
h in e)for(n=e[h],t=0,u=n.length;t<u;t++)r=n[t],d=r[0],m=r[1],q=r[2],p=r[3],l=r[4],r=r[5],0!=r&&c&&(l=c.slice(l,l+r),l="data:image/png;base64,"+l,r="b"+t,b["imgs"+h]=b["imgs"+h]||{},b["imgs"+h][r]=[l,d,m,q,p]);if(f&&h in f)for(n=f[h],t=0,u=n.length;t<u;t++)l=n[t],d=l[0],m=l[1],q=l[2],p=l[3],l=l[4],l=k+l,r="i"+t,b["imgs"+h]=b["imgs"+h]||{},b["imgs"+h][r]=[l,d,m,q,p]}this._checkDirtyTiles();this._placeLt(a)}},_stopLoadingLt:function(a){a=this._lts[a];var b=G.Util.ajaxCancel;a&&(b(a.ri),a.loading=!1)},
_onIconLoad:function(){this._dirtyIcons=!0},_clearGrids:function(){this._g={}},_hitGrids:function(a,b,c,d){for(var e=a;e<=c;e++)for(var f=b;f<=d;f++)if(a=e+","+f,this._g[a])return!0;return!1},_markGrids:function(a,b,c,d){for(var e=a;e<=c;e++)for(var f=b;f<=d;f++)a=e+","+f,this._g[a]=!0}});
G.Layer.VectorCache=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{cluster:[]},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a;this.options=G.Util.merge({},this.options,b);this._vts={};this._visVtKeys=[];this._vIds={}},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);
a._isLoaded()&&(a=this._calcVisTileInfos(),this._addVts(a))},_addVts:function(a){if(0!==a.length){var b,c,d=[],e,f,k,h;b=0;for(c=a.length;b<c;b++)e=a[b],f=e[0],k=e[1],h=e[2],e=this._getTileName(f,k,h),d.push(e),e in this._vts?(f=this._vts[e],f.data&&this._processVt(e)):this._loadVt(f,k,h);b=0;for(c=this._visVtKeys.length;b<c;b++)e=this._visVtKeys[b],0>d.indexOf(e)&&this._removeVt(e);this._visVtKeys=d}},_removeVt:function(a){this._vts[a]&&this._stopLoadingVt(a)},_loadVt:function(a,b,c){var d=this,
e=d._getTileName(a,b,c),f=d._vts[e]=d._vts[e]||{};f._info=[a,b,c];""!==f.data&&(f.loading=!0,a=d._getTileUrl(a,b,c,{d:"f"}),b={responseType:"http"===a.slice(0,4).toLowerCase()?"JSONP":"JSON",success:function(a,b){f.data=b;d._processVt(e)},error:function(a){404==a.status&&(f.data="")},complete:function(){delete f.req;f.loading=!1}},a=G.Util.ajax(a,b),f.req=a)},_processVt:function(a){for(var b=this._map,c=this._vts[a].data,d=c.v,c=c.s,e,f,k,h,m,q=G.Util.colorHex,p=0,l=d.length;p<l;p++)e=d[p],f=e.id,
k=e.g,h=e.gt,e=e.st,e=c[e],(m=this._vIds[f])?m._updateGeom(k):"pt"===h?m=new G.Graphic.Point(k):"pl"===h?m=new G.Graphic.Polyline(k):"pg"===h&&(m=new G.Graphic.Polygon(k)),m&&(k=m.options,"pt"!==h&&"pl"===h&&(h=e.line_color,k.lineWidth=e.line_width,k.lineColor=q(h[0],h[1],h[2])),m&&(m.addTo(this),m._vtKeys=m._vtKeys||{},m._vtKeys[a]=!0,this._vIds[f]=m));b._requestRedraw()},_stopLoadingVt:function(a){a=this._vts[a];var b=G.Util.ajaxCancel;a&&(b(a.req),a.loading=!1)}});
G.Layer.FeatureService=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{mode:"all",vacuumCount:1E3},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.options=G.Util.merge({},this.options,b);this._reqFunc=a;this._loadingKeys={}},onSuccess:function(a){"tile"==this.options.mode?this.fireEvent("loadTileSuccess",{extent:a}):this.fireEvent("loadAllSuccess")},onError:function(a){"tile"==this.options.mode?this.fireEvent("loadTileError",{extent:a}):this.fireEvent("loadAllError")},onComplete:function(a){if("tile"==
this.options.mode){var b=a.join(",");delete this._loadingKeys[b];this.fireEvent("loadTileComplete",{extent:a})}else this.fireEvent("loadAllComplete")},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);a._isLoaded()&&("tile"==this.options.mode?(this.count()>this.options.vacuumCount&&this._vacuum(),a=this._calcVisTileInfos(),this._addFts(a)):this._loadAll())},_addFts:function(a){if(0!==a.length){var b,c,d,e,f,k=this._loadingKeys,h={};b=0;for(c=a.length;b<c;b++)e=a[b],d=
e[0],f=e[1],e=e[2],f=this._calcTileExtent(d,f,e),d=f.join(","),h[d]=f;for(d in k)h[d]||(a=k[d],G.Util.ajaxCancel(a),delete k[d]);for(d in h)f=h[d],this._loadFt(f)}},_loadFt:function(a){var b=a.join(","),c=this._reqFunc;b in this._loadingKeys||!c||(c=c.call(this,a),this._loadingKeys[b]=c,this.fireEvent("loadTileStart",{extent:a}))},_loadAll:function(){var a=this._reqFunc;"all"in this._loadingKeys||!a||(a=a.call(this),this._loadingKeys.all=a,this.fireEvent("loadAllStart"))}});
G.Layer.GeoHeyFeature=G.Layer.FeatureService.extend({options:{apiKey:"",where:"1=1",outFields:"",limit:1E3},init:function(a,b){var c=this;G.Layer.FeatureService.prototype.init.call(c,function(b){var e=a+"/query",f=c.options,k={ak:f.apiKey,where:f.where,outFields:f.outFields,limit:f.limit};b&&(k.geometry=JSON.stringify(b));k={responseType:"http"===e.slice(0,4).toLowerCase()?"JSONP":"JSON",data:k,success:function(a,e){var k=e.data,p=k.geometryType;if(k=k.features){var l;l=k.length-1;for(var r=Math.max(0,
l-f.limit),n,t,u,s=[],w,v,x;l>=r;l--){n=k[l];t=n.id;u=n.geom;n=n.attrs||{};if("Point"==p)s.push(new G.Graphic.Point(u,n));else if("Polyline"==p)s.push(new G.Graphic.Polyline(u,n));else if("Polygon"==p)s.push(new G.Graphic.Polygon(u,n));else if("MultiPoint"==p)for(w in u.m)v=u.m[w],s.push(new G.Graphic.Point(v,n));else if("MultiPolyline"==p)for(w in u.m)v=u.m[w],s.push(new G.Graphic.Polyline(v,n));else if("MultiPolygon"==p)for(w in u.m)v=u.m[w],s.push(new G.Graphic.Polygon(v,n));for(x in s)if(n=s[x])u=
t+"_"+x,c.get(u)||n.addTo(c,u)}}c.onSuccess(b)},error:function(){c.onError(b)},complete:function(){c.onComplete(b)}};G.Util.ajax(e,k)},b)}});
G.Layer.GeoHeyProgressiveFeature=G.Layer.Graphic.extend({options:{stepFactor:4,stepCount:4,tolerance:8,outFields:"[]"},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a},onSuccess:function(a){this.fireEvent("extentSuccess",{extent:a})},onError:function(a){this.fireEvent("extentError",{extent:a})},onComplete:function(a){this.fireEvent("extentComplete",{extent:a})},_update:function(){var a=this._map,b=this._loadRes=a._res,c=this._loadExtent=a.getExtent(),d=this._loadedStatus;
if(!d||b!=d[0]||!G.ExtentUtil.equals(c,d[1]))if(G.Layer.Graphic.prototype._update.call(this),a._isLoaded()){(a=this._req)&&G.Util.ajaxCancel(a);var e,b=this._graphics;for(e in b)a=b[e],a._dirty=!0;this._loadStep(1)}},_loadStep:function(a){var b=this,c=b.options,d=b._loadRes,e=b._loadExtent,f=c.tolerance*Math.pow(c.stepFactor,c.stepCount-a),k=b.url+"/filter",c={responseType:"JSON",data:{extent:JSON.stringify(e),excludeExtents:JSON.stringify([]),res:d,cellPixel:f,outFields:c.outFields},success:function(c,
d){b._processResult(a,d)},complete:function(){b._req=null}};b._req=G.Util.ajax(k,c)},_processResult:function(a,b){var c=this.options,d=this._loadRes,e=this._loadExtent,f=c.tolerance*Math.pow(c.stepFactor,c.stepCount-a),f=d*f,k=b.geometryType,h=b.features;if(h){var m,q,p,l,r,n;for(m=h.length-1;0<=m;m--)if(q=h[m],p=q.id,l=q.geom,q=q.attrs||{},"Point"==k)n=new G.Graphic.Point(l,q),this._updateGraphic(f,p,0,n);else if("Polyline"==k)n=new G.Graphic.Polyline(l,q),this._updateGraphic(f,p,0,n);else if("Polygon"==
k)n=new G.Graphic.Polygon(l,q),this._updateGraphic(f,p,0,n);else if("MultiPoint"==k)for(r in l.multi)n=l.multi[r],n=new G.Graphic.Point(n,q),this._updateGraphic(f,p,r,n);else if("MultiPolyline"==k)for(r in l.multi)n=l.multi[r],n=new G.Graphic.Polyline(n,q),this._updateGraphic(f,p,r,n);else if("MultiPolygon"==k)for(r in l.multi)n=l.multi[r],n=new G.Graphic.Polygon(n,q),this._updateGraphic(f,p,r,n);a<c.stepCount?this._loadStep(a+1):(this._clearDirty(),this._loadedStatus=[d,e],this.onSuccess(e),this.onComplete(e))}else this.onError(e),
this.onComplete(e)},_updateGraphic:function(a,b,c,d){b+=c?"_"+c:"";(c=this.get(b))?(a<c._res&&(c.updateGeom(d.geom,!0),c._res=a),c._dirty=!1):(d._res=a,d.addTo(this,b))},_clearDirty:function(){var a=this._graphics,b,c;for(c in a)b=a[c],b._dirty&&b.remove()}});
G.Layer.TiledService=G.Layer.extend({mixins:[G.Layer.LOD],init:function(a,b){this.options=G.Util.merge({},this.options,b);this._reqFunc=a;this._loadingKeys={};this._loadedKeys={}},onSuccess:function(a,b){var c=parseInt(a[0]),d=parseInt(a[1]),e=parseInt(a[2]),c=this._getTileName(c,d,e);this._loadedKeys[c]=a;this.fireEvent("loadTileSuccess",{tileInfo:a,data:b})},onError:function(a){this.fireEvent("loadTileError",{tileInfo:a})},onComplete:function(a){var b=parseInt(a[0]),c=parseInt(a[1]),d=parseInt(a[2]),
b=this._getTileName(b,c,d);delete this._loadingKeys[b];this.fireEvent("loadTileComplete",{tileInfo:a})},_update:function(){if(this._map._isLoaded()){var a,b,c,d,e,f,k=this._calcVisTileInfos(),h={};a=0;for(b=k.length;a<b;a++)d=k[a],c=d[0],e=d[1],f=d[2],c=this._getTileName(c,e,f),h[c]=d;this._addTiles(h);for(c in this._loadedKeys)h[c]||(d=this._loadedKeys[c],delete this._loadedKeys[c],this.fireEvent("unusedTile",{tileInfo:d}))}},_addTiles:function(a){var b,c,d=this._loadingKeys;for(b in d)a[b]||(c=
d[b],G.Util.ajaxCancel(c),delete d[b]);for(b in a)c=a[b],this._loadTile(c)},_loadTile:function(a){var b=this._reqFunc,c=parseInt(a[0]),d=parseInt(a[1]),e=parseInt(a[2]),f=this._getTileName(c,d,e);f in this._loadingKeys||f in this._loadedKeys||!b||(b=b.call(this,c,d,e),this._loadingKeys[f]=b,this.fireEvent("loadTileStart",{tileInfo:a}))}});
G.Graphic.Point=G.Graphic.Point.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._points={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this.options,c=this._layer._map;if(this.geom){var d=this._layer._vml;this._dom&&(d&&!this._dom.parentNode)&&d.appendChild(this._dom);a.getPosition(c._mapFrame);
var d=b.shape,e=b.size,f=e[0],e=e[1],k=b.offset,h=b.imageRotate;b.imageGravity&&(h+=c._rotate);"image"==d&&h&&(k=G.MathUtil.rotateVector(k,h));for(var m=this.geom[0],q=this.geom[1],p=c._calcWrapPointRange(this.geom)||[0,0],l=c.options.maxExtent,l=l[2]-l[0],r=p[0];r<=p[1];r++){var n=this._points[r];n||(n="rect"==d?this._points[r]=a.createVML("rect","g-vml"):"image"==d?this._points[r]=a.createVML("image","g-vml"):"text"==d?this._points[r]=a.createVML("text","g-vml"):this._points[r]=a.createVML("oval",
"g-vml"),n._graphic=this,this._dom.appendChild(n));var t=c.toScreen([m+r*l,q]),u=t[0]+k[0],t=t[1]+k[1],s=n.style;if("circle"==d)s.left=u-f/2,s.top=t-f/2,s.width=s.height=f;else if("rect"==d)s.left=u-f/2,s.top=t-e/2,s.width=f,s.height=e;else if("image"==d){s.left=u;s.top=t;s.width=f;s.height=e;if(h){s.rotation=h;var w=[f/2,e/2],v=G.MathUtil.rotateVector(w,h);s.left=u-(w[0]-v[0]);s.top=t-(w[1]-v[1])}u=G.Browser.getImageSrc(b.image);n.src=u}else if("text"==d){w=b.text;this._textMeasureWidth&&this._textMeasure==
w||(v=a.create("div","",document.body),v.style.position="absolute",v.style.visibility="hidden",v.style.width=v.style.height="auto",v.style.fontFamily=b.textFont,v.style.fontStyle="italic"==b.textStyle?"italic":"normal",v.style.fontWeight="bold"==b.textStyle?"bold":"normal",v.style.fontSize=f+"px",v.innerHTML=w,this._textMeasureWidth=v.clientWidth+4,v.parentNode.removeChild(v),this._textMeasure=w);var w=f,v=this._textMeasureWidth,x=b.textAlign;s.left=u+("left"==x?0:"right"==x?-v:-v/2);s.top=t-w/2;
s.width=v;s.height=w;s.fontFamily=b.textFont;s.fontStyle="italic"==b.textStyle?"italic":"normal";s.fontWeight="bold"==b.textStyle?"bold":"normal";s.fontSize=f+"px";s.color=b.fillColor;s.filter="alpha(opacity="+100*b.fillOpacity+")";n.innerHTML=b.text}}this._updateStyles()}},_updateStyles:function(){var a=G.DomUtil,b=this.options,c;for(c in this._points){var d=this._points[c];if((b.outline||this._mouseOver||this._editing)&&"text"!=b.shape){var e=[];for(c=0;c<b.outlineDashArray.length;c++)e[c]=parseInt(b.outlineDashArray[c]/
b.outlineWidth);a.strokeVML(d,{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:e.join(" "),weight:this._mouseOver?b.outlineWidth+b.lineHighlightWiden:b.outlineWidth,opacity:b.outlineOpacity})}else a.strokeVML(d,{opacity:0});b.fill?(e=G.Browser.getImageSrc(b.fillImage),a.fillVML(d,{color:b.fillColor,opacity:b.fillOpacity,color2:b.fillColor,src:e,focusposition:"50%, 50%",type:b.fillImage?"tile":b.gradual?"gradientradial":"solid"})):a.fillVML(d,{opacity:0})}},
_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,d;for(c in b.DOWN)d=b.DOWN[c],a.removeListener(d,this._onVertexDragStart,this),a.removeListener(b.MOVE[d],this._onVertexDrag,this),a.removeListener(b.UP[d],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil,
c=a._handlers.Drag;!c||(c._dragging||this.options.allowPan)||c.off();this._updateStyles();this._isVertex?b.addClass(a._layersFrame,"g-edit"):b.addClass(a._layersFrame,"g-clickable")}},_onMouseOut:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil,c=a._handlers.Drag;if(c&&!c._dragging)c.on();this._updateStyles();this._isVertex?b.removeClass(a._layersFrame,"g-edit"):b.removeClass(a._layersFrame,"g-clickable")}}});
G.Graphic.Polyline=G.Graphic.Polyline.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._polylines={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map;if(this.geom){var c=this._layer._vml;this._dom&&(c&&!this._dom.parentNode)&&c.appendChild(this._dom);for(var c=Math.round,
d=a.getPosition(b._mapFrame),e=this.geom,f=e.length,k=this.bbox,k=b._calcWrapPointRange([(k[0]+k[2])/2,(k[1]+k[3])/2])||[0,0],h=b.options.maxExtent,h=h[2]-h[0],m=k[0];m<=k[1];m++){var q=this._polylines[m];q||(q=this._polylines[m]=a.createVML("shape","g-vml"),q._path=a.createVML("path","g-vml",q),q._graphic=this,this._dom.appendChild(q));for(var p="",l,r,n=0;n<f;n++)l=b.toScreen([e[n][0]+m*h,e[n][1]]),r=l[0]-d[0],l=l[1]-d[1],p+=0===n?" M ":"",p+=1===n?" L ":" ",p+=c(r)+","+c(l);p+=" E";q._path.v=p;
q.filled="f";q.style.width=q.style.height=1;q.coordsize="1 1"}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,c=[],d=0;d<b.lineDashArray.length;d++)c[d]=parseInt(b.lineDashArray[d]/b.lineWidth);for(d in this._polylines)a.strokeVML(this._polylines[d],{color:this._editing?b.lineHighlightColor:b.lineColor,dashstyle:c.join(" "),endcap:b.lineCap?b.lineCap.replace("butt","flat"):"",joinstyle:b.lineJoin,weight:this._mouseOver?b.lineWidth+b.lineHighlightWiden:b.lineWidth,
opacity:b.lineOpacity})},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,d;for(c in b.DOWN)d=b.DOWN[c],a.removeListener(d,this._onVertexDragStart,this),a.removeListener(b.MOVE[d],this._onVertexDrag,this),a.removeListener(b.UP[d],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map,
b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Polygon=G.Graphic.Polygon.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._polygons={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map;if(this.geom){var c=this._layer._vml;this._dom&&(c&&!this._dom.parentNode)&&c.appendChild(this._dom);for(var c=Math.round,
d=a.getPosition(b._mapFrame),e=this.geom,f=this.bbox,f=b._calcWrapPointRange([(f[0]+f[2])/2,(f[1]+f[3])/2])||[0,0],k=b.options.maxExtent,k=k[2]-k[0],h=f[0];h<=f[1];h++){var m=this._polygons[h];m||(m=this._polygons[h]=a.createVML("shape","g-vml"),m._path=a.createVML("path","g-vml",m),m._graphic=this,this._dom.appendChild(m));for(var q="",p,l,r,n,t=0,u=e.length;t<u;t++){p=e[t];l="";for(var s=0,w=p.length;s<w;s++)r=b.toScreen([p[s][0]+h*k,p[s][1]]),n=r[0]-d[0],r=r[1]-d[1],l+=0===s?" M ":"",l+=1===s?
" L ":" ",l+=c(n)+","+c(r);l+=" X";q+=l}q+=" E";m._path.v=q;m.style.width=m.style.height=1;m.coordsize="1 1"}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,c=[],d=0;d<b.outlineDashArray.length;d++)c[d]=parseInt(b.outlineDashArray[d]/b.outlineWidth);for(d in this._polygons){var e=this._polygons[d];b.outline||this._mouseOver||this._editing?a.strokeVML(e,{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:c.join(" "),endcap:b.outlineCap?
b.outlineCap.replace("butt","flat"):"",joinstyle:b.outlineJoin,weight:(b.outline?b.outlineWidth:0)+(this._mouseOver?b.lineHighlightWiden:0),opacity:b.outlineOpacity}):a.strokeVML(e,{opacity:0});if(b.fill){var f=G.Browser.getImageSrc(b.fillImage);a.fillVML(e,{color:b.fillColor,opacity:b.fillOpacity,src:f,type:b.fillImage?"tile":"solid"})}else a.fillVML(e,{opacity:0})}},_updateMask:function(){},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],
this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,d;for(c in b.DOWN)d=b.DOWN[c],a.removeListener(d,this._onVertexDragStart,this),a.removeListener(b.MOVE[d],this._onVertexDrag,this),a.removeListener(b.UP[d],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=
this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Circle=G.Graphic.Circle.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._circles={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map;if(this.geom){var c=this._layer._vml;this._dom&&(c&&!this._dom.parentNode)&&c.appendChild(this._dom);for(var c=a.getPosition(b._mapFrame),
d=b._res,e=this.geom[0],f=this.geom[1],k=this.geom[2],h=b._calcWrapPointRange(this.geom)||[0,0],m=b.options.maxExtent,m=m[2]-m[0],q=h[0];q<=h[1];q++){var p=this._circles[q];p||(p=this._circles[q]=a.createVML("oval","g-vml"),p._graphic=this,this._dom.appendChild(p));var l=b.toScreen([e+q*m,f]),r=l[0]-c[0],l=l[1]-c[1],n=k/d,p=p.style;p.width=p.height=2*n;p.left=r-n;p.top=l-n}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,c=[],d=0;d<b.outlineDashArray.length;d++)c[d]=
parseInt(b.outlineDashArray[d]/b.outlineWidth);for(d in this._circles){var e=this._circles[d];b.outline||this._mouseOver||this._editing?a.strokeVML(e,{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:c.join(" "),weight:(b.outline?b.outlineWidth:0)+(this._mouseOver?b.lineHighlightWiden:0),opacity:b.outlineOpacity}):a.strokeVML(e,{opacity:0});if(b.fill){var f=G.Browser.getImageSrc(b.fillImage);a.fillVML(e,{color:b.fillColor,opacity:b.fillOpacity,color2:b.fillColor,
src:f,focusposition:"50%, 50%",type:b.fillImage?"tile":b.gradual?"gradientradial":"solid"})}else a.fillVML(e,{opacity:0})}},_updateMask:function(){},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,d;for(c in b.DOWN)d=b.DOWN[c],a.removeListener(d,this._onVertexDragStart,this),a.removeListener(b.MOVE[d],this._onVertexDrag,
this),a.removeListener(b.UP[d],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Arrow=G.Graphic.Arrow.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._polygons={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map;this._updateGeomDraw(b._res);if(this._geomDraw){var c=this._layer._vml;this._dom&&(c&&!this._dom.parentNode)&&c.appendChild(this._dom);
for(var c=Math.round,d=a.getPosition(b._mapFrame),e=this._geomDraw,f=this.bbox,f=b._calcWrapPointRange([(f[0]+f[2])/2,(f[1]+f[3])/2])||[0,0],k=b.options.maxExtent,k=k[2]-k[0],h=f[0];h<=f[1];h++){var m=this._polygons[h];m||(m=this._polygons[h]=a.createVML("shape","g-vml"),m._path=a.createVML("path","g-vml",m),m._graphic=this,this._dom.appendChild(m));for(var q="",p,l,r,n,t=0,u=e.length;t<u;t++){p=e[t];l="";for(var s=0,w=p.length;s<w;s++)r=b.toScreen([p[s][0]+h*k,p[s][1]]),n=r[0]-d[0],r=r[1]-d[1],l+=
0===s?" M ":"",l+=1===s?" L ":" ",l+=c(n)+","+c(r);l+=" X";q+=l}q+=" E";m._path.v=q;m.style.width=m.style.height=1;m.coordsize="1 1"}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,c=[],d=0;d<b.outlineDashArray.length;d++)c[d]=parseInt(b.outlineDashArray[d]/b.outlineWidth);for(d in this._polygons){var e=this._polygons[d];b.outline||this._mouseOver||this._editing?a.strokeVML(e,{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:c.join(" "),
endcap:b.outlineCap?b.outlineCap.replace("butt","flat"):"",joinstyle:b.outlineJoin,weight:(b.outline?b.outlineWidth:0)+(this._mouseOver?b.lineHighlightWiden:0),opacity:b.outlineOpacity}):a.strokeVML(e,{opacity:0});if(b.fill){var f=G.Browser.getImageSrc(b.fillImage);a.fillVML(e,{color:b.fillColor,opacity:b.fillOpacity,src:f,type:b.fillImage?"tile":"solid"})}else a.fillVML(e,{opacity:0})}},_updateMask:function(){},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],
this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,d;for(c in b.DOWN)d=b.DOWN[c],a.removeListener(d,this._onVertexDragStart,this),a.removeListener(b.MOVE[d],this._onVertexDrag,this),a.removeListener(b.UP[d],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=
this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Group=G.Graphic.Group.extend({_updateStyles:function(){var a=this._graphics,b,c,d;if(a&&a.length)for(b=0,c=a.length;b<c;b++)d=a[b],d._updateStyles&&d._updateStyles()},_onMouseOver:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Map=G.Map.extend({_initAddition:function(){this._mode="vml"}});

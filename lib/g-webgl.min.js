(function(a){var b;"undefined"===typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(b={},define(function(){return b})):b="undefined"!==typeof window?window:a:b=exports;(function(a){if(!b)var b=1E-6;if(!l)var l="undefined"!==typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var m={setMatrixArrayType:function(f){l=f}};"undefined"!==typeof a&&(a.glMatrix=m);var p=Math.PI/180;m.toRadian=function(f){return f*p};var k={create:function(){var f=new l(2);f[0]=0;
f[1]=0;return f},clone:function(f){var u=new l(2);u[0]=f[0];u[1]=f[1];return u},fromValues:function(f,u){var a=new l(2);a[0]=f;a[1]=u;return a},copy:function(f,u){f[0]=u[0];f[1]=u[1];return f},set:function(f,u,a){f[0]=u;f[1]=a;return f},add:function(f,u,a){f[0]=u[0]+a[0];f[1]=u[1]+a[1];return f},subtract:function(f,u,a){f[0]=u[0]-a[0];f[1]=u[1]-a[1];return f}};k.sub=k.subtract;k.multiply=function(f,u,a){f[0]=u[0]*a[0];f[1]=u[1]*a[1];return f};k.mul=k.multiply;k.divide=function(f,u,a){f[0]=u[0]/a[0];
f[1]=u[1]/a[1];return f};k.div=k.divide;k.min=function(f,u,a){f[0]=Math.min(u[0],a[0]);f[1]=Math.min(u[1],a[1]);return f};k.max=function(f,u,a){f[0]=Math.max(u[0],a[0]);f[1]=Math.max(u[1],a[1]);return f};k.scale=function(f,u,a){f[0]=u[0]*a;f[1]=u[1]*a;return f};k.scaleAndAdd=function(f,u,a,b){f[0]=u[0]+a[0]*b;f[1]=u[1]+a[1]*b;return f};k.distance=function(f,u){var a=u[0]-f[0],b=u[1]-f[1];return Math.sqrt(a*a+b*b)};k.dist=k.distance;k.squaredDistance=function(f,u){var a=u[0]-f[0],b=u[1]-f[1];return a*
a+b*b};k.sqrDist=k.squaredDistance;k.length=function(f){var u=f[0];f=f[1];return Math.sqrt(u*u+f*f)};k.len=k.length;k.squaredLength=function(f){var u=f[0];f=f[1];return u*u+f*f};k.sqrLen=k.squaredLength;k.negate=function(f,u){f[0]=-u[0];f[1]=-u[1];return f};k.normalize=function(f,u){var a=u[0],b=u[1],a=a*a+b*b;0<a&&(a=1/Math.sqrt(a),f[0]=u[0]*a,f[1]=u[1]*a);return f};k.dot=function(f,u){return f[0]*u[0]+f[1]*u[1]};k.cross=function(f,u,a){u=u[0]*a[1]-u[1]*a[0];f[0]=f[1]=0;f[2]=u;return f};k.lerp=function(f,
u,a,b){var d=u[0];u=u[1];f[0]=d+b*(a[0]-d);f[1]=u+b*(a[1]-u);return f};k.random=function(f,u){u=u||1;var a=2*d()*Math.PI;f[0]=Math.cos(a)*u;f[1]=Math.sin(a)*u;return f};k.transformMat2=function(f,u,a){var b=u[0];u=u[1];f[0]=a[0]*b+a[2]*u;f[1]=a[1]*b+a[3]*u;return f};k.transformMat2d=function(f,u,a){var b=u[0];u=u[1];f[0]=a[0]*b+a[2]*u+a[4];f[1]=a[1]*b+a[3]*u+a[5];return f};k.transformMat3=function(f,u,a){var b=u[0];u=u[1];f[0]=a[0]*b+a[3]*u+a[6];f[1]=a[1]*b+a[4]*u+a[7];return f};k.transformMat4=function(f,
u,a){var b=u[0];u=u[1];f[0]=a[0]*b+a[4]*u+a[12];f[1]=a[1]*b+a[5]*u+a[13];return f};k.forEach=function(){var f=k.create();return function(u,a,b,d,c,e){a||(a=2);b||(b=0);for(d=d?Math.min(d*a+b,u.length):u.length;b<d;b+=a)f[0]=u[b],f[1]=u[b+1],c(f,f,e),u[b]=f[0],u[b+1]=f[1];return u}}();k.str=function(f){return"vec2("+f[0]+", "+f[1]+")"};"undefined"!==typeof a&&(a.vec2=k);var q={create:function(){var f=new l(3);f[0]=0;f[1]=0;f[2]=0;return f},clone:function(f){var u=new l(3);u[0]=f[0];u[1]=f[1];u[2]=
f[2];return u},fromValues:function(f,u,a){var b=new l(3);b[0]=f;b[1]=u;b[2]=a;return b},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];return f},set:function(f,a,b,d){f[0]=a;f[1]=b;f[2]=d;return f},add:function(f,a,b){f[0]=a[0]+b[0];f[1]=a[1]+b[1];f[2]=a[2]+b[2];return f},subtract:function(f,a,b){f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];return f}};q.sub=q.subtract;q.multiply=function(f,a,b){f[0]=a[0]*b[0];f[1]=a[1]*b[1];f[2]=a[2]*b[2];return f};q.mul=q.multiply;q.divide=function(f,a,b){f[0]=
a[0]/b[0];f[1]=a[1]/b[1];f[2]=a[2]/b[2];return f};q.div=q.divide;q.min=function(f,a,b){f[0]=Math.min(a[0],b[0]);f[1]=Math.min(a[1],b[1]);f[2]=Math.min(a[2],b[2]);return f};q.max=function(f,a,b){f[0]=Math.max(a[0],b[0]);f[1]=Math.max(a[1],b[1]);f[2]=Math.max(a[2],b[2]);return f};q.scale=function(f,a,b){f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;return f};q.scaleAndAdd=function(f,a,b,d){f[0]=a[0]+b[0]*d;f[1]=a[1]+b[1]*d;f[2]=a[2]+b[2]*d;return f};q.distance=function(f,a){var b=a[0]-f[0],d=a[1]-f[1],c=a[2]-
f[2];return Math.sqrt(b*b+d*d+c*c)};q.dist=q.distance;q.squaredDistance=function(f,a){var b=a[0]-f[0],d=a[1]-f[1],c=a[2]-f[2];return b*b+d*d+c*c};q.sqrDist=q.squaredDistance;q.length=function(f){var a=f[0],b=f[1];f=f[2];return Math.sqrt(a*a+b*b+f*f)};q.len=q.length;q.squaredLength=function(f){var a=f[0],b=f[1];f=f[2];return a*a+b*b+f*f};q.sqrLen=q.squaredLength;q.negate=function(f,a){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];return f};q.normalize=function(f,a){var b=a[0],d=a[1],c=a[2],b=b*b+d*d+c*c;0<b&&(b=
1/Math.sqrt(b),f[0]=a[0]*b,f[1]=a[1]*b,f[2]=a[2]*b);return f};q.dot=function(f,a){return f[0]*a[0]+f[1]*a[1]+f[2]*a[2]};q.cross=function(f,a,b){var d=a[0],c=a[1];a=a[2];var e=b[0],m=b[1];b=b[2];f[0]=c*b-a*m;f[1]=a*e-d*b;f[2]=d*m-c*e;return f};q.lerp=function(f,a,b,d){var c=a[0],e=a[1];a=a[2];f[0]=c+d*(b[0]-c);f[1]=e+d*(b[1]-e);f[2]=a+d*(b[2]-a);return f};q.random=function(f,a){a=a||1;var b=2*d()*Math.PI,c=2*d()-1,e=Math.sqrt(1-c*c)*a;f[0]=Math.cos(b)*e;f[1]=Math.sin(b)*e;f[2]=c*a;return f};q.transformMat4=
function(f,a,b){var d=a[0],c=a[1];a=a[2];f[0]=b[0]*d+b[4]*c+b[8]*a+b[12];f[1]=b[1]*d+b[5]*c+b[9]*a+b[13];f[2]=b[2]*d+b[6]*c+b[10]*a+b[14];return f};q.transformMat3=function(f,a,b){var d=a[0],c=a[1];a=a[2];f[0]=d*b[0]+c*b[3]+a*b[6];f[1]=d*b[1]+c*b[4]+a*b[7];f[2]=d*b[2]+c*b[5]+a*b[8];return f};q.transformQuat=function(f,a,b){var d=a[0],c=a[1],e=a[2];a=b[0];var m=b[1],l=b[2];b=b[3];var k=b*d+m*e-l*c,p=b*c+l*d-a*e,n=b*e+a*c-m*d,d=-a*d-m*c-l*e;f[0]=k*b+d*-a+p*-l-n*-m;f[1]=p*b+d*-m+n*-a-k*-l;f[2]=n*b+d*
-l+k*-m-p*-a;return f};q.rotateX=function(f,a,b,d){var c=[],e=[];c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];e[0]=c[0];e[1]=c[1]*Math.cos(d)-c[2]*Math.sin(d);e[2]=c[1]*Math.sin(d)+c[2]*Math.cos(d);f[0]=e[0]+b[0];f[1]=e[1]+b[1];f[2]=e[2]+b[2];return f};q.rotateY=function(f,a,b,d){var c=[],e=[];c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];e[0]=c[2]*Math.sin(d)+c[0]*Math.cos(d);e[1]=c[1];e[2]=c[2]*Math.cos(d)-c[0]*Math.sin(d);f[0]=e[0]+b[0];f[1]=e[1]+b[1];f[2]=e[2]+b[2];return f};q.rotateZ=function(f,
a,b,d){var c=[],e=[];c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];e[0]=c[0]*Math.cos(d)-c[1]*Math.sin(d);e[1]=c[0]*Math.sin(d)+c[1]*Math.cos(d);e[2]=c[2];f[0]=e[0]+b[0];f[1]=e[1]+b[1];f[2]=e[2]+b[2];return f};q.forEach=function(){var f=q.create();return function(a,b,d,c,e,m){b||(b=3);d||(d=0);for(c=c?Math.min(c*b+d,a.length):a.length;d<c;d+=b)f[0]=a[d],f[1]=a[d+1],f[2]=a[d+2],e(f,f,m),a[d]=f[0],a[d+1]=f[1],a[d+2]=f[2];return a}}();q.str=function(f){return"vec3("+f[0]+", "+f[1]+", "+f[2]+")"};"undefined"!==
typeof a&&(a.vec3=q);var s={create:function(){var f=new l(4);f[0]=0;f[1]=0;f[2]=0;f[3]=0;return f},clone:function(f){var a=new l(4);a[0]=f[0];a[1]=f[1];a[2]=f[2];a[3]=f[3];return a},fromValues:function(f,a,b,d){var c=new l(4);c[0]=f;c[1]=a;c[2]=b;c[3]=d;return c},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];return f},set:function(f,a,b,d,c){f[0]=a;f[1]=b;f[2]=d;f[3]=c;return f},add:function(f,a,b){f[0]=a[0]+b[0];f[1]=a[1]+b[1];f[2]=a[2]+b[2];f[3]=a[3]+b[3];return f},subtract:function(f,
a,b){f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];f[3]=a[3]-b[3];return f}};s.sub=s.subtract;s.multiply=function(f,a,b){f[0]=a[0]*b[0];f[1]=a[1]*b[1];f[2]=a[2]*b[2];f[3]=a[3]*b[3];return f};s.mul=s.multiply;s.divide=function(f,a,b){f[0]=a[0]/b[0];f[1]=a[1]/b[1];f[2]=a[2]/b[2];f[3]=a[3]/b[3];return f};s.div=s.divide;s.min=function(f,a,b){f[0]=Math.min(a[0],b[0]);f[1]=Math.min(a[1],b[1]);f[2]=Math.min(a[2],b[2]);f[3]=Math.min(a[3],b[3]);return f};s.max=function(f,a,b){f[0]=Math.max(a[0],b[0]);f[1]=
Math.max(a[1],b[1]);f[2]=Math.max(a[2],b[2]);f[3]=Math.max(a[3],b[3]);return f};s.scale=function(f,a,b){f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;f[3]=a[3]*b;return f};s.scaleAndAdd=function(f,a,b,d){f[0]=a[0]+b[0]*d;f[1]=a[1]+b[1]*d;f[2]=a[2]+b[2]*d;f[3]=a[3]+b[3]*d;return f};s.distance=function(f,a){var b=a[0]-f[0],d=a[1]-f[1],c=a[2]-f[2],e=a[3]-f[3];return Math.sqrt(b*b+d*d+c*c+e*e)};s.dist=s.distance;s.squaredDistance=function(f,a){var b=a[0]-f[0],d=a[1]-f[1],c=a[2]-f[2],e=a[3]-f[3];return b*b+d*d+
c*c+e*e};s.sqrDist=s.squaredDistance;s.length=function(f){var a=f[0],b=f[1],d=f[2];f=f[3];return Math.sqrt(a*a+b*b+d*d+f*f)};s.len=s.length;s.squaredLength=function(f){var a=f[0],b=f[1],d=f[2];f=f[3];return a*a+b*b+d*d+f*f};s.sqrLen=s.squaredLength;s.negate=function(f,a){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];f[3]=-a[3];return f};s.normalize=function(f,a){var b=a[0],d=a[1],c=a[2],e=a[3],b=b*b+d*d+c*c+e*e;0<b&&(b=1/Math.sqrt(b),f[0]=a[0]*b,f[1]=a[1]*b,f[2]=a[2]*b,f[3]=a[3]*b);return f};s.dot=function(f,
a){return f[0]*a[0]+f[1]*a[1]+f[2]*a[2]+f[3]*a[3]};s.lerp=function(f,a,b,d){var c=a[0],e=a[1],m=a[2];a=a[3];f[0]=c+d*(b[0]-c);f[1]=e+d*(b[1]-e);f[2]=m+d*(b[2]-m);f[3]=a+d*(b[3]-a);return f};s.random=function(f,a){a=a||1;f[0]=d();f[1]=d();f[2]=d();f[3]=d();s.normalize(f,f);s.scale(f,f,a);return f};s.transformMat4=function(f,a,b){var d=a[0],c=a[1],e=a[2];a=a[3];f[0]=b[0]*d+b[4]*c+b[8]*e+b[12]*a;f[1]=b[1]*d+b[5]*c+b[9]*e+b[13]*a;f[2]=b[2]*d+b[6]*c+b[10]*e+b[14]*a;f[3]=b[3]*d+b[7]*c+b[11]*e+b[15]*a;return f};
s.transformQuat=function(f,a,b){var d=a[0],c=a[1],e=a[2];a=b[0];var m=b[1],l=b[2];b=b[3];var k=b*d+m*e-l*c,p=b*c+l*d-a*e,n=b*e+a*c-m*d,d=-a*d-m*c-l*e;f[0]=k*b+d*-a+p*-l-n*-m;f[1]=p*b+d*-m+n*-a-k*-l;f[2]=n*b+d*-l+k*-m-p*-a;return f};s.forEach=function(){var f=s.create();return function(a,b,d,c,e,m){b||(b=4);d||(d=0);for(c=c?Math.min(c*b+d,a.length):a.length;d<c;d+=b)f[0]=a[d],f[1]=a[d+1],f[2]=a[d+2],f[3]=a[d+3],e(f,f,m),a[d]=f[0],a[d+1]=f[1],a[d+2]=f[2],a[d+3]=f[3];return a}}();s.str=function(f){return"vec4("+
f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"};"undefined"!==typeof a&&(a.vec4=s);m={create:function(){var f=new l(4);f[0]=1;f[1]=0;f[2]=0;f[3]=1;return f},clone:function(f){var a=new l(4);a[0]=f[0];a[1]=f[1];a[2]=f[2];a[3]=f[3];return a},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];return f},identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=1;return f},transpose:function(f,a){if(f===a){var b=a[1];f[1]=a[2];f[2]=b}else f[0]=a[0],f[1]=a[2],f[2]=a[1],f[3]=a[3];return f},invert:function(f,a){var b=
a[0],d=a[1],c=a[2],e=a[3],m=b*e-c*d;if(!m)return null;m=1/m;f[0]=e*m;f[1]=-d*m;f[2]=-c*m;f[3]=b*m;return f},adjoint:function(f,a){var b=a[0];f[0]=a[3];f[1]=-a[1];f[2]=-a[2];f[3]=b;return f},determinant:function(f){return f[0]*f[3]-f[2]*f[1]},multiply:function(f,a,b){var d=a[0],c=a[1],e=a[2];a=a[3];var m=b[0],l=b[1],k=b[2];b=b[3];f[0]=d*m+e*l;f[1]=c*m+a*l;f[2]=d*k+e*b;f[3]=c*k+a*b;return f}};m.mul=m.multiply;m.rotate=function(f,a,b){var d=a[0],c=a[1],e=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);f[0]=
d*b+e*m;f[1]=c*b+a*m;f[2]=d*-m+e*b;f[3]=c*-m+a*b;return f};m.scale=function(f,a,b){var d=a[1],c=a[2],e=a[3],m=b[0];b=b[1];f[0]=a[0]*m;f[1]=d*m;f[2]=c*b;f[3]=e*b;return f};m.str=function(f){return"mat2("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"};m.frob=function(f){return Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2)+Math.pow(f[2],2)+Math.pow(f[3],2))};m.LDU=function(f,a,b,d){f[2]=d[2]/d[0];b[0]=d[0];b[1]=d[1];b[3]=d[3]-f[2]*b[1];return[f,a,b]};"undefined"!==typeof a&&(a.mat2=m);m={create:function(){var f=
new l(6);f[0]=1;f[1]=0;f[2]=0;f[3]=1;f[4]=0;f[5]=0;return f},clone:function(f){var a=new l(6);a[0]=f[0];a[1]=f[1];a[2]=f[2];a[3]=f[3];a[4]=f[4];a[5]=f[5];return a},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];f[4]=a[4];f[5]=a[5];return f},identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=1;f[4]=0;f[5]=0;return f},invert:function(f,a){var b=a[0],d=a[1],c=a[2],e=a[3],m=a[4],l=a[5],k=b*e-d*c;if(!k)return null;k=1/k;f[0]=e*k;f[1]=-d*k;f[2]=-c*k;f[3]=b*k;f[4]=(c*l-e*m)*k;f[5]=(d*m-b*l)*k;return f},
determinant:function(f){return f[0]*f[3]-f[1]*f[2]},multiply:function(f,a,b){var d=a[0],c=a[1],e=a[2],m=a[3],l=a[4];a=a[5];var k=b[0],p=b[1],n=b[2],r=b[3],q=b[4];b=b[5];f[0]=d*k+e*p;f[1]=c*k+m*p;f[2]=d*n+e*r;f[3]=c*n+m*r;f[4]=d*q+e*b+l;f[5]=c*q+m*b+a;return f}};m.mul=m.multiply;m.rotate=function(f,a,b){var d=a[0],c=a[1],e=a[2],m=a[3],l=a[4];a=a[5];var k=Math.sin(b);b=Math.cos(b);f[0]=d*b+e*k;f[1]=c*b+m*k;f[2]=d*-k+e*b;f[3]=c*-k+m*b;f[4]=l;f[5]=a;return f};m.scale=function(f,a,b){var d=a[1],c=a[2],
e=a[3],m=a[4],l=a[5],k=b[0];b=b[1];f[0]=a[0]*k;f[1]=d*k;f[2]=c*b;f[3]=e*b;f[4]=m;f[5]=l;return f};m.translate=function(a,b,d){var c=b[0],e=b[1],m=b[2],l=b[3],k=b[4];b=b[5];var p=d[0];d=d[1];a[0]=c;a[1]=e;a[2]=m;a[3]=l;a[4]=c*p+m*d+k;a[5]=e*p+l*d+b;return a};m.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};m.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};"undefined"!==
typeof a&&(a.mat2d=m);var t={create:function(){var a=new l(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},fromMat4:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},clone:function(a){var b=new l(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];
return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(a===b){var d=b[1],c=b[2],e=b[5];a[1]=b[3];a[2]=b[6];a[3]=d;a[5]=b[7];a[6]=c;a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},invert:function(a,b){var d=b[0],c=b[1],e=b[2],m=b[3],l=b[4],k=b[5],p=b[6],n=b[7],r=b[8],q=r*l-k*n,s=-r*m+k*p,t=n*m-l*p,x=d*q+c*s+e*t;if(!x)return null;x=1/x;a[0]=q*x;a[1]=(-r*c+e*n)*
x;a[2]=(k*c-e*l)*x;a[3]=s*x;a[4]=(r*d-e*p)*x;a[5]=(-k*d+e*m)*x;a[6]=t*x;a[7]=(-n*d+c*p)*x;a[8]=(l*d-c*m)*x;return a},adjoint:function(a,b){var d=b[0],c=b[1],e=b[2],m=b[3],l=b[4],k=b[5],p=b[6],n=b[7],r=b[8];a[0]=l*r-k*n;a[1]=e*n-c*r;a[2]=c*k-e*l;a[3]=k*p-m*r;a[4]=d*r-e*p;a[5]=e*m-d*k;a[6]=m*n-l*p;a[7]=c*p-d*n;a[8]=d*l-c*m;return a},determinant:function(a){var b=a[3],d=a[4],c=a[5],e=a[6],m=a[7],l=a[8];return a[0]*(l*d-c*m)+a[1]*(-l*b+c*e)+a[2]*(m*b-d*e)},multiply:function(a,b,d){var c=b[0],e=b[1],m=
b[2],l=b[3],k=b[4],p=b[5],n=b[6],r=b[7];b=b[8];var q=d[0],s=d[1],t=d[2],x=d[3],z=d[4],A=d[5],B=d[6],E=d[7];d=d[8];a[0]=q*c+s*l+t*n;a[1]=q*e+s*k+t*r;a[2]=q*m+s*p+t*b;a[3]=x*c+z*l+A*n;a[4]=x*e+z*k+A*r;a[5]=x*m+z*p+A*b;a[6]=B*c+E*l+d*n;a[7]=B*e+E*k+d*r;a[8]=B*m+E*p+d*b;return a}};t.mul=t.multiply;t.translate=function(a,b,d){var c=b[0],e=b[1],m=b[2],l=b[3],k=b[4],p=b[5],n=b[6],r=b[7];b=b[8];var q=d[0];d=d[1];a[0]=c;a[1]=e;a[2]=m;a[3]=l;a[4]=k;a[5]=p;a[6]=q*c+d*l+n;a[7]=q*e+d*k+r;a[8]=q*m+d*p+b;return a};
t.rotate=function(a,b,d){var c=b[0],e=b[1],m=b[2],l=b[3],k=b[4],p=b[5],n=b[6],r=b[7];b=b[8];var q=Math.sin(d);d=Math.cos(d);a[0]=d*c+q*l;a[1]=d*e+q*k;a[2]=d*m+q*p;a[3]=d*l-q*c;a[4]=d*k-q*e;a[5]=d*p-q*m;a[6]=n;a[7]=r;a[8]=b;return a};t.scale=function(a,b,d){var c=d[0];d=d[1];a[0]=c*b[0];a[1]=c*b[1];a[2]=c*b[2];a[3]=d*b[3];a[4]=d*b[4];a[5]=d*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};t.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};
t.fromQuat=function(a,b){var d=b[0],c=b[1],e=b[2],m=b[3],l=d+d,k=c+c,p=e+e,d=d*l,n=c*l,c=c*k,r=e*l,q=e*k,e=e*p,l=m*l,k=m*k,m=m*p;a[0]=1-c-e;a[3]=n-m;a[6]=r+k;a[1]=n+m;a[4]=1-d-e;a[7]=q-l;a[2]=r-k;a[5]=q+l;a[8]=1-d-c;return a};t.normalFromMat4=function(a,b){var d=b[0],c=b[1],e=b[2],m=b[3],l=b[4],k=b[5],p=b[6],n=b[7],r=b[8],q=b[9],s=b[10],t=b[11],x=b[12],z=b[13],A=b[14],B=b[15],E=d*k-c*l,H=d*p-e*l,F=d*n-m*l,I=c*p-e*k,R=c*n-m*k,T=e*n-m*p,U=r*z-q*x,V=r*A-s*x,r=r*B-t*x,W=q*A-s*z,q=q*B-t*z,s=s*B-t*A,t=
E*s-H*q+F*W+I*r-R*V+T*U;if(!t)return null;t=1/t;a[0]=(k*s-p*q+n*W)*t;a[1]=(p*r-l*s-n*V)*t;a[2]=(l*q-k*r+n*U)*t;a[3]=(e*q-c*s-m*W)*t;a[4]=(d*s-e*r+m*V)*t;a[5]=(c*r-d*q-m*U)*t;a[6]=(z*T-A*R+B*I)*t;a[7]=(A*F-x*T-B*H)*t;a[8]=(x*R-z*F+B*E)*t;return a};t.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};t.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],
2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=t);var n={create:function(){var a=new l(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var b=new l(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},copy:function(a,b){a[0]=b[0];
a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(a===b){var d=b[1],c=b[2],e=b[3],m=b[6],l=b[7],k=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=d;a[6]=b[9];a[7]=b[13];a[8]=c;a[9]=m;a[11]=b[14];a[12]=e;a[13]=
l;a[14]=k}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},invert:function(a,b){var d=b[0],c=b[1],e=b[2],m=b[3],l=b[4],k=b[5],p=b[6],n=b[7],r=b[8],q=b[9],s=b[10],t=b[11],x=b[12],z=b[13],A=b[14],B=b[15],E=d*k-c*l,H=d*p-e*l,F=d*n-m*l,I=c*p-e*k,R=c*n-m*k,T=e*n-m*p,U=r*z-q*x,V=r*A-s*x,W=r*B-t*x,X=q*A-s*z,Y=q*B-t*z,Z=s*B-t*A,S=E*Z-H*Y+F*X+I*W-R*V+T*U;if(!S)return null;
S=1/S;a[0]=(k*Z-p*Y+n*X)*S;a[1]=(e*Y-c*Z-m*X)*S;a[2]=(z*T-A*R+B*I)*S;a[3]=(s*R-q*T-t*I)*S;a[4]=(p*W-l*Z-n*V)*S;a[5]=(d*Z-e*W+m*V)*S;a[6]=(A*F-x*T-B*H)*S;a[7]=(r*T-s*F+t*H)*S;a[8]=(l*Y-k*W+n*U)*S;a[9]=(c*W-d*Y-m*U)*S;a[10]=(x*R-z*F+B*E)*S;a[11]=(q*F-r*R-t*E)*S;a[12]=(k*V-l*X-p*U)*S;a[13]=(d*X-c*V+e*U)*S;a[14]=(z*H-x*I-A*E)*S;a[15]=(r*I-q*H+s*E)*S;return a},adjoint:function(a,b){var d=b[0],c=b[1],e=b[2],m=b[3],l=b[4],k=b[5],p=b[6],n=b[7],r=b[8],q=b[9],s=b[10],t=b[11],x=b[12],z=b[13],A=b[14],B=b[15];
a[0]=k*(s*B-t*A)-q*(p*B-n*A)+z*(p*t-n*s);a[1]=-(c*(s*B-t*A)-q*(e*B-m*A)+z*(e*t-m*s));a[2]=c*(p*B-n*A)-k*(e*B-m*A)+z*(e*n-m*p);a[3]=-(c*(p*t-n*s)-k*(e*t-m*s)+q*(e*n-m*p));a[4]=-(l*(s*B-t*A)-r*(p*B-n*A)+x*(p*t-n*s));a[5]=d*(s*B-t*A)-r*(e*B-m*A)+x*(e*t-m*s);a[6]=-(d*(p*B-n*A)-l*(e*B-m*A)+x*(e*n-m*p));a[7]=d*(p*t-n*s)-l*(e*t-m*s)+r*(e*n-m*p);a[8]=l*(q*B-t*z)-r*(k*B-n*z)+x*(k*t-n*q);a[9]=-(d*(q*B-t*z)-r*(c*B-m*z)+x*(c*t-m*q));a[10]=d*(k*B-n*z)-l*(c*B-m*z)+x*(c*n-m*k);a[11]=-(d*(k*t-n*q)-l*(c*t-m*q)+r*
(c*n-m*k));a[12]=-(l*(q*A-s*z)-r*(k*A-p*z)+x*(k*s-p*q));a[13]=d*(q*A-s*z)-r*(c*A-e*z)+x*(c*s-e*q);a[14]=-(d*(k*A-p*z)-l*(c*A-e*z)+x*(c*p-e*k));a[15]=d*(k*s-p*q)-l*(c*s-e*q)+r*(c*p-e*k);return a},determinant:function(a){var b=a[0],d=a[1],c=a[2],e=a[3],m=a[4],l=a[5],k=a[6],p=a[7],n=a[8],q=a[9],r=a[10],s=a[11],t=a[12],x=a[13],z=a[14];a=a[15];return(b*l-d*m)*(r*a-s*z)-(b*k-c*m)*(q*a-s*x)+(b*p-e*m)*(q*z-r*x)+(d*k-c*l)*(n*a-s*t)-(d*p-e*l)*(n*z-r*t)+(c*p-e*k)*(n*x-q*t)},multiply:function(a,b,d){var c=b[0],
e=b[1],m=b[2],l=b[3],k=b[4],p=b[5],n=b[6],q=b[7],r=b[8],s=b[9],t=b[10],x=b[11],z=b[12],A=b[13],B=b[14];b=b[15];var E=d[0],H=d[1],F=d[2],I=d[3];a[0]=E*c+H*k+F*r+I*z;a[1]=E*e+H*p+F*s+I*A;a[2]=E*m+H*n+F*t+I*B;a[3]=E*l+H*q+F*x+I*b;E=d[4];H=d[5];F=d[6];I=d[7];a[4]=E*c+H*k+F*r+I*z;a[5]=E*e+H*p+F*s+I*A;a[6]=E*m+H*n+F*t+I*B;a[7]=E*l+H*q+F*x+I*b;E=d[8];H=d[9];F=d[10];I=d[11];a[8]=E*c+H*k+F*r+I*z;a[9]=E*e+H*p+F*s+I*A;a[10]=E*m+H*n+F*t+I*B;a[11]=E*l+H*q+F*x+I*b;E=d[12];H=d[13];F=d[14];I=d[15];a[12]=E*c+H*k+
F*r+I*z;a[13]=E*e+H*p+F*s+I*A;a[14]=E*m+H*n+F*t+I*B;a[15]=E*l+H*q+F*x+I*b;return a}};n.mul=n.multiply;n.translate=function(a,b,d){var c=d[0],e=d[1];d=d[2];var m,l,k,p,n,q,r,s,t,x,z,A;b===a?(a[12]=b[0]*c+b[4]*e+b[8]*d+b[12],a[13]=b[1]*c+b[5]*e+b[9]*d+b[13],a[14]=b[2]*c+b[6]*e+b[10]*d+b[14],a[15]=b[3]*c+b[7]*e+b[11]*d+b[15]):(m=b[0],l=b[1],k=b[2],p=b[3],n=b[4],q=b[5],r=b[6],s=b[7],t=b[8],x=b[9],z=b[10],A=b[11],a[0]=m,a[1]=l,a[2]=k,a[3]=p,a[4]=n,a[5]=q,a[6]=r,a[7]=s,a[8]=t,a[9]=x,a[10]=z,a[11]=A,a[12]=
m*c+n*e+t*d+b[12],a[13]=l*c+q*e+x*d+b[13],a[14]=k*c+r*e+z*d+b[14],a[15]=p*c+s*e+A*d+b[15]);return a};n.scale=function(a,b,d){var c=d[0],e=d[1];d=d[2];a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*d;a[9]=b[9]*d;a[10]=b[10]*d;a[11]=b[11]*d;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};n.rotate=function(a,d,c,m){var l=m[0],k=m[1];m=m[2];var p=Math.sqrt(l*l+k*k+m*m),n,q,r,s,t,O,P,x,z,A,B,E,H,F,I,R,T,U,V,W;if(Math.abs(p)<b)return null;
p=1/p;l*=p;k*=p;m*=p;n=Math.sin(c);q=Math.cos(c);r=1-q;c=d[0];p=d[1];s=d[2];t=d[3];O=d[4];P=d[5];x=d[6];z=d[7];A=d[8];B=d[9];E=d[10];H=d[11];F=l*l*r+q;I=k*l*r+m*n;R=m*l*r-k*n;T=l*k*r-m*n;U=k*k*r+q;V=m*k*r+l*n;W=l*m*r+k*n;l=k*m*r-l*n;k=m*m*r+q;a[0]=c*F+O*I+A*R;a[1]=p*F+P*I+B*R;a[2]=s*F+x*I+E*R;a[3]=t*F+z*I+H*R;a[4]=c*T+O*U+A*V;a[5]=p*T+P*U+B*V;a[6]=s*T+x*U+E*V;a[7]=t*T+z*U+H*V;a[8]=c*W+O*l+A*k;a[9]=p*W+P*l+B*k;a[10]=s*W+x*l+E*k;a[11]=t*W+z*l+H*k;d!==a&&(a[12]=d[12],a[13]=d[13],a[14]=d[14],a[15]=d[15]);
return a};n.rotateX=function(a,b,d){var c=Math.sin(d);d=Math.cos(d);var e=b[4],m=b[5],l=b[6],k=b[7],p=b[8],n=b[9],r=b[10],q=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=e*d+p*c;a[5]=m*d+n*c;a[6]=l*d+r*c;a[7]=k*d+q*c;a[8]=p*d-e*c;a[9]=n*d-m*c;a[10]=r*d-l*c;a[11]=q*d-k*c;return a};n.rotateY=function(a,b,d){var c=Math.sin(d);d=Math.cos(d);var e=b[0],m=b[1],l=b[2],k=b[3],p=b[8],n=b[9],r=b[10],q=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],
a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*d-p*c;a[1]=m*d-n*c;a[2]=l*d-r*c;a[3]=k*d-q*c;a[8]=e*c+p*d;a[9]=m*c+n*d;a[10]=l*c+r*d;a[11]=k*c+q*d;return a};n.rotateZ=function(a,b,d){var c=Math.sin(d);d=Math.cos(d);var e=b[0],m=b[1],l=b[2],k=b[3],p=b[4],n=b[5],r=b[6],q=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*d+p*c;a[1]=m*d+n*c;a[2]=l*d+r*c;a[3]=k*d+q*c;a[4]=p*d-e*c;a[5]=n*d-m*c;a[6]=r*d-l*c;a[7]=q*d-k*c;return a};
n.fromRotationTranslation=function(a,b,d){var c=b[0],e=b[1],m=b[2],l=b[3],k=c+c,p=e+e,n=m+m;b=c*k;var r=c*p,c=c*n,q=e*p,e=e*n,m=m*n,k=l*k,p=l*p,l=l*n;a[0]=1-(q+m);a[1]=r+l;a[2]=c-p;a[3]=0;a[4]=r-l;a[5]=1-(b+m);a[6]=e+k;a[7]=0;a[8]=c+p;a[9]=e-k;a[10]=1-(b+q);a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a};n.fromQuat=function(a,b){var d=b[0],c=b[1],e=b[2],m=b[3],l=d+d,k=c+c,p=e+e,d=d*l,n=c*l,c=c*k,r=e*l,q=e*k,e=e*p,l=m*l,k=m*k,m=m*p;a[0]=1-c-e;a[1]=n+m;a[2]=r-k;a[3]=0;a[4]=n-m;a[5]=1-d-e;
a[6]=q+l;a[7]=0;a[8]=r+k;a[9]=q-l;a[10]=1-d-c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};n.frustum=function(a,b,d,c,e,m,l){var k=1/(d-b),p=1/(e-c),n=1/(m-l);a[0]=2*m*k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*m*p;a[6]=0;a[7]=0;a[8]=(d+b)*k;a[9]=(e+c)*p;a[10]=(l+m)*n;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*(l*m)*n;a[15]=0;return a};n.perspective=function(a,b,d,c,e){b=1/Math.tan(b/2);var m=1/(c-e);a[0]=b/d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(e+c)*m;a[11]=-1;a[12]=0;a[13]=
0;a[14]=2*e*c*m;a[15]=0;return a};n.ortho=function(a,b,d,c,e,m,l){var k=1/(b-d),p=1/(c-e),n=1/(m-l);a[0]=-2*k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*p;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*n;a[11]=0;a[12]=(b+d)*k;a[13]=(e+c)*p;a[14]=(l+m)*n;a[15]=1;return a};n.lookAt=function(a,d,c,m){var l,k,p,r,q,s,t,D,O=d[0],P=d[1];d=d[2];p=m[0];r=m[1];k=m[2];t=c[0];m=c[1];l=c[2];if(Math.abs(O-t)<b&&Math.abs(P-m)<b&&Math.abs(d-l)<b)return n.identity(a);c=O-t;m=P-m;t=d-l;D=1/Math.sqrt(c*c+m*m+t*t);c*=D;m*=D;t*=D;l=r*
t-k*m;k=k*c-p*t;p=p*m-r*c;(D=Math.sqrt(l*l+k*k+p*p))?(D=1/D,l*=D,k*=D,p*=D):p=k=l=0;r=m*p-t*k;q=t*l-c*p;s=c*k-m*l;(D=Math.sqrt(r*r+q*q+s*s))?(D=1/D,r*=D,q*=D,s*=D):s=q=r=0;a[0]=l;a[1]=r;a[2]=c;a[3]=0;a[4]=k;a[5]=q;a[6]=m;a[7]=0;a[8]=p;a[9]=s;a[10]=t;a[11]=0;a[12]=-(l*O+k*P+p*d);a[13]=-(r*O+q*P+s*d);a[14]=-(c*O+m*P+t*d);a[15]=1;return a};n.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+
a[13]+", "+a[14]+", "+a[15]+")"};n.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=n);var r={create:function(){var a=new l(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};r.rotationTo=function(){var a=
q.create(),b=q.fromValues(1,0,0),d=q.fromValues(0,1,0);return function(c,e,m){var l=q.dot(e,m);if(-0.999999>l)return q.cross(a,b,e),1E-6>q.length(a)&&q.cross(a,d,e),q.normalize(a,a),r.setAxisAngle(c,a,Math.PI),c;if(0.999999<l)return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c;q.cross(a,e,m);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=1+l;return r.normalize(c,c)}}();r.setAxes=function(){var a=t.create();return function(b,d,c,e){a[0]=c[0];a[3]=c[1];a[6]=c[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=-d[0];a[5]=-d[1];a[8]=-d[2];
return r.normalize(b,r.fromMat3(b,a))}}();r.clone=s.clone;r.fromValues=s.fromValues;r.copy=s.copy;r.set=s.set;r.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};r.setAxisAngle=function(a,b,d){d*=0.5;var c=Math.sin(d);a[0]=c*b[0];a[1]=c*b[1];a[2]=c*b[2];a[3]=Math.cos(d);return a};r.add=s.add;r.multiply=function(a,b,d){var c=b[0],e=b[1],m=b[2];b=b[3];var l=d[0],k=d[1],p=d[2];d=d[3];a[0]=c*d+b*l+e*p-m*k;a[1]=e*d+b*k+m*l-c*p;a[2]=m*d+b*p+c*k-e*l;a[3]=b*d-c*l-e*k-m*p;return a};r.mul=r.multiply;
r.scale=s.scale;r.rotateX=function(a,b,d){d*=0.5;var c=b[0],e=b[1],m=b[2];b=b[3];var l=Math.sin(d);d=Math.cos(d);a[0]=c*d+b*l;a[1]=e*d+m*l;a[2]=m*d-e*l;a[3]=b*d-c*l;return a};r.rotateY=function(a,b,d){d*=0.5;var c=b[0],e=b[1],m=b[2];b=b[3];var l=Math.sin(d);d=Math.cos(d);a[0]=c*d-m*l;a[1]=e*d+b*l;a[2]=m*d+c*l;a[3]=b*d-e*l;return a};r.rotateZ=function(a,b,d){d*=0.5;var c=b[0],e=b[1],m=b[2];b=b[3];var l=Math.sin(d);d=Math.cos(d);a[0]=c*d+e*l;a[1]=e*d-c*l;a[2]=m*d+b*l;a[3]=b*d-m*l;return a};r.calculateW=
function(a,b){var d=b[0],c=b[1],e=b[2];a[0]=d;a[1]=c;a[2]=e;a[3]=-Math.sqrt(Math.abs(1-d*d-c*c-e*e));return a};r.dot=s.dot;r.lerp=s.lerp;r.slerp=function(a,b,d,c){var e=b[0],m=b[1],l=b[2];b=b[3];var k=d[0],p=d[1],n=d[2];d=d[3];var r,q,s;q=e*k+m*p+l*n+b*d;0>q&&(q=-q,k=-k,p=-p,n=-n,d=-d);1E-6<1-q?(r=Math.acos(q),s=Math.sin(r),q=Math.sin((1-c)*r)/s,c=Math.sin(c*r)/s):q=1-c;a[0]=q*e+c*k;a[1]=q*m+c*p;a[2]=q*l+c*n;a[3]=q*b+c*d;return a};r.invert=function(a,b){var d=b[0],c=b[1],e=b[2],m=b[3],l=d*d+c*c+e*
e+m*m,l=l?1/l:0;a[0]=-d*l;a[1]=-c*l;a[2]=-e*l;a[3]=m*l;return a};r.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};r.length=s.length;r.len=r.length;r.squaredLength=s.squaredLength;r.sqrLen=r.squaredLength;r.normalize=s.normalize;r.fromMat3=function(a,b){var d=b[0]+b[4]+b[8];if(0<d)d=Math.sqrt(d+1),a[3]=0.5*d,d=0.5/d,a[0]=(b[7]-b[5])*d,a[1]=(b[2]-b[6])*d,a[2]=(b[3]-b[1])*d;else{var c=0;b[4]>b[0]&&(c=1);b[8]>b[3*c+c]&&(c=2);var e=(c+1)%3,m=(c+2)%3,d=Math.sqrt(b[3*c+c]-b[3*
e+e]-b[3*m+m]+1);a[c]=0.5*d;d=0.5/d;a[3]=(b[3*m+e]-b[3*e+m])*d;a[e]=(b[3*e+c]+b[3*c+e])*d;a[m]=(b[3*m+c]+b[3*c+m])*d}return a};r.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=r)})(b)})(this);
!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);b.poly2tri=a()}}(function(){return function b(c,e,l){function d(k,p){if(!e[k]){if(!c[k]){var s="function"==typeof require&&require;if(!p&&s)return s(k,!0);if(m)return m(k,!0);throw Error("Cannot find module '"+k+"'");}s=e[k]={exports:{}};c[k][0].call(s.exports,function(b){var e=
c[k][1][b];return d(e?e:b)},s,s.exports,b,c,e,l)}return e[k].exports}for(var m="function"==typeof require&&require,p=0;p<l.length;p++)d(l[p]);return d}({1:[function(b,c,e){c.exports={version:"1.3.5"}},{}],2:[function(b,c,e){b=function(b,d){this.head_=b;this.tail_=d;this.search_node_=b};b.prototype.head=function(){return this.head_};b.prototype.setHead=function(b){this.head_=b};b.prototype.tail=function(){return this.tail_};b.prototype.setTail=function(b){this.tail_=b};b.prototype.search=function(){return this.search_node_};
b.prototype.setSearch=function(b){this.search_node_=b};b.prototype.findSearchNode=function(){return this.search_node_};b.prototype.locateNode=function(b){var d=this.search_node_;if(b<d.value)for(;d=d.prev;){if(b>=d.value)return this.search_node_=d}else for(;d=d.next;)if(b<d.value)return this.search_node_=d.prev;return null};b.prototype.locatePoint=function(b){var d=b.x,c=this.findSearchNode(d),e=c.point.x;if(d===e){if(b!==c.point)if(b===c.prev.point)c=c.prev;else if(b===c.next.point)c=c.next;else throw Error("poly2tri Invalid AdvancingFront.locatePoint() call");
}else if(d<e)for(;(c=c.prev)&&b!==c.point;);else for(;(c=c.next)&&b!==c.point;);c&&(this.search_node_=c);return c};c.exports=b;c.exports.Node=function(b,d){this.point=b;this.triangle=d||null;this.prev=this.next=null;this.value=b.x}},{}],3:[function(b,c,e){c.exports=function(b,d){if(!b)throw Error(d||"Assert Failed");}},{}],4:[function(b,c,e){var l=b("./xy"),d=function(b,d){this.x=+b||0;this.y=+d||0;this._p2t_edge_list=null};d.prototype.toString=function(){return l.toStringBase(this)};d.prototype.toJSON=
function(){return{x:this.x,y:this.y}};d.prototype.clone=function(){return new d(this.x,this.y)};d.prototype.set_zero=function(){this.y=this.x=0;return this};d.prototype.set=function(b,d){this.x=+b||0;this.y=+d||0;return this};d.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};d.prototype.add=function(b){this.x+=b.x;this.y+=b.y;return this};d.prototype.sub=function(b){this.x-=b.x;this.y-=b.y;return this};d.prototype.mul=function(b){this.x*=b;this.y*=b;return this};d.prototype.length=
function(){return Math.sqrt(this.x*this.x+this.y*this.y)};d.prototype.normalize=function(){var b=this.length();this.x/=b;this.y/=b;return b};d.prototype.equals=function(b){return this.x===b.x&&this.y===b.y};d.negate=function(b){return new d(-b.x,-b.y)};d.add=function(b,c){return new d(b.x+c.x,b.y+c.y)};d.sub=function(b,c){return new d(b.x-c.x,b.y-c.y)};d.mul=function(b,c){return new d(b*c.x,b*c.y)};d.cross=function(b,c){return"number"===typeof b?"number"===typeof c?b*c:new d(-b*c.y,b*c.x):"number"===
typeof c?new d(c*b.y,-c*b.x):b.x*c.y-b.y*c.x};d.toString=l.toString;d.compare=l.compare;d.cmp=l.compare;d.equals=l.equals;d.dot=function(b,d){return b.x*d.x+b.y*d.y};c.exports=d},{"./xy":11}],5:[function(b,c,e){var l=b("./xy");b=function(b,c){this.name="PointError";this.points=c=c||[];this.message=b||"Invalid Points!";for(var e=0;e<c.length;e++)this.message+=" "+l.toString(c[e])};b.prototype=Error();b.prototype.constructor=b;c.exports=b},{"./xy":11}],6:[function(b,c,e){(function(c){var d=c.poly2tri;
e.noConflict=function(){c.poly2tri=d;return e};e.VERSION=b("../dist/version.json").version;e.PointError=b("./pointerror");e.Point=b("./point");e.Triangle=b("./triangle");e.SweepContext=b("./sweepcontext");var m=b("./sweep");e.triangulate=m.triangulate;e.sweep={Triangulate:m.triangulate}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(b,c,e){function l(b,
c,e,f,m){if(!d(f,c,e)){var k=f.pointCCW(m),p=D(e,k,c);if(p===M.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[e,k,c]);var k=f.pointCW(m),n=D(e,k,c);if(n===M.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[e,k,c]);p===n?(f=p===M.CW?f.neighborCCW(m):f.neighborCW(m),l(b,c,e,f,m)):v(b,c,e,f,m)}}function d(b,d,c){var e=b.edgeIndex(d,c);return-1!==e?(b.markConstrainedEdgeByIndex(e),(b=b.getNeighbor(e))&&b.markConstrainedEdgeByPoints(d,c),!0):!1}function m(b,
d){var c=new Q(d.prev.point,d.point,d.next.point);c.markNeighbor(d.prev.triangle);c.markNeighbor(d.triangle);b.addToMap(c);d.prev.next=d.next;d.next.prev=d.prev;p(b,c)||b.mapTriangleToNodes(c)}function p(b,d){for(var c=0;3>c;++c)if(!d.delaunay_edge[c]){var e=d.getNeighbor(c);if(e){var f=d.getPoint(c),m=e.oppositePoint(d,f),l=e.index(m);if(e.constrained_edge[l]||e.delaunay_edge[l])d.constrained_edge[c]=e.constrained_edge[l];else{var n;var r=d.pointCCW(f),q=d.pointCW(f);n=f.x-m.x;var s=f.y-m.y,u=r.x-
m.x,r=r.y-m.y,t=n*r-u*s;if(0>=t)n=!1;else{var v=q.x-m.x,q=q.y-m.y,D=v*s-n*q;n=0>=D?!1:0<(n*n+s*s)*(u*q-v*r)+(u*u+r*r)*D+(v*v+q*q)*t}if(n)return d.delaunay_edge[c]=!0,e.delaunay_edge[l]=!0,k(d,f,e,m),(f=!p(b,d))&&b.mapTriangleToNodes(d),(f=!p(b,e))&&b.mapTriangleToNodes(e),d.delaunay_edge[c]=!1,e.delaunay_edge[l]=!1,!0}}}return!1}function k(b,d,c,e){var f,m,l,k;f=b.neighborCCW(d);m=b.neighborCW(d);l=c.neighborCCW(e);k=c.neighborCW(e);var p,n,r,q;p=b.getConstrainedEdgeCCW(d);n=b.getConstrainedEdgeCW(d);
r=c.getConstrainedEdgeCCW(e);q=c.getConstrainedEdgeCW(e);var s,u,t,v;s=b.getDelaunayEdgeCCW(d);u=b.getDelaunayEdgeCW(d);t=c.getDelaunayEdgeCCW(e);v=c.getDelaunayEdgeCW(e);b.legalize(d,e);c.legalize(e,d);c.setDelaunayEdgeCCW(d,s);b.setDelaunayEdgeCW(d,u);b.setDelaunayEdgeCCW(e,t);c.setDelaunayEdgeCW(e,v);c.setConstrainedEdgeCCW(d,p);b.setConstrainedEdgeCW(d,n);b.setConstrainedEdgeCCW(e,r);c.setConstrainedEdgeCW(e,q);b.clearNeighbors();c.clearNeighbors();f&&c.markNeighbor(f);m&&b.markNeighbor(m);l&&
b.markNeighbor(l);k&&c.markNeighbor(k);b.markNeighbor(c)}function q(b,d){var c;c=b.basin.width>(b.basin.left_highest?b.basin.left_node.point.y-d.point.y:b.basin.right_node.point.y-d.point.y)?!0:!1;if(!c&&(m(b,d),d.prev!==b.basin.left_node||d.next!==b.basin.right_node)){if(d.prev===b.basin.left_node){c=D(d.point,d.next.point,d.next.next.point);if(c===M.CW)return;d=d.next}else if(d.next===b.basin.right_node){c=D(d.point,d.prev.point,d.prev.prev.point);if(c===M.CCW)return;d=d.prev}else d=d.prev.point.y<
d.next.point.y?d.prev:d.next;q(b,d)}}function s(b,d,c){c.point.x<d.p.x&&(D(c.point,c.next.point,c.next.next.point)===M.CCW?t(b,d,c):(n(b,d,c),s(b,d,c)))}function t(b,d,c){m(b,c.next);c.next.point!==d.p&&(D(d.q,c.next.point,d.p)===M.CCW&&D(c.point,c.next.point,c.next.next.point)===M.CCW)&&t(b,d,c)}function n(b,d,c){D(c.next.point,c.next.next.point,c.next.next.next.point)===M.CCW?t(b,d,c.next):D(d.q,c.next.next.point,d.p)===M.CCW&&n(b,d,c.next)}function r(b,d,c){c.point.x>d.p.x&&(D(c.point,c.prev.point,
c.prev.prev.point)===M.CW?u(b,d,c):(f(b,d,c),r(b,d,c)))}function f(b,d,c){D(c.prev.point,c.prev.prev.point,c.prev.prev.prev.point)===M.CW?u(b,d,c.prev):D(d.q,c.prev.prev.point,d.p)===M.CW&&f(b,d,c.prev)}function u(b,d,c){m(b,c.prev);c.prev.point!==d.p&&(D(d.q,c.prev.point,d.p)===M.CW&&D(c.point,c.prev.point,c.prev.prev.point)===M.CW)&&u(b,d,c)}function v(b,d,c,e,f){var m=e.neighborAcross(f);L(m,"FLIP failed due to missing triangle!");var n=m.oppositePoint(e,f);if(e.getConstrainedEdgeAcross(f))throw b=
e.index(f),new y("poly2tri Intersecting Constraints",[f,n,e.getPoint((b+1)%3),e.getPoint((b+2)%3)]);if(O(f,e.pointCCW(f),e.pointCW(f),n))if(k(e,f,m,n),b.mapTriangleToNodes(e),b.mapTriangleToNodes(m),f===c&&n===d)c===b.edge_event.constrained_edge.q&&d===b.edge_event.constrained_edge.p&&(e.markConstrainedEdgeByPoints(d,c),m.markConstrainedEdgeByPoints(d,c),p(b,e),p(b,m));else{var r=D(c,n,d);r===M.CCW?(n=m.edgeIndex(f,n),m.delaunay_edge[n]=!0,p(b,m),m.clearDelaunayEdges()):(n=e.edgeIndex(f,n),e.delaunay_edge[n]=
!0,p(b,e),e.clearDelaunayEdges(),e=m);v(b,d,c,e,f)}else n=K(d,c,m,n),C(b,d,c,e,m,n),l(b,d,c,e,f)}function K(b,d,c,e){var f=D(d,e,b);if(f===M.CW)return c.pointCCW(e);if(f===M.CCW)return c.pointCW(e);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[d,e,b]);}function C(b,d,c,e,f,m){var l=f.neighborAcross(m);L(l,"FLIP failed due to missing triangle");f=l.oppositePoint(f,m);O(c,e.pointCCW(c),e.pointCW(c),f)?v(b,c,f,l,f):(f=K(d,c,l,f),C(b,d,c,e,l,f))}var L=b("./assert"),
y=b("./pointerror"),Q=b("./triangle"),N=b("./advancingfront").Node;b=b("./utils");var J=b.EPSILON,M=b.Orientation,D=b.orient2d,O=b.inScanArea,P=b.isAngleObtuse;e.triangulate=function(b){b.initTriangulation();b.createAdvancingFront();var c,e=b.pointCount();for(c=1;c<e;++c){var f=b.getPoint(c),k;k=b;var n=f,u=k.locateNode(n),t;t=k;var v=n,y=u,C=new Q(v,y.point,y.next.point);C.markNeighbor(y.triangle);t.addToMap(C);v=new N(v);v.next=y.next;v.prev=y;y.next.prev=v;y.next=v;p(t,C)||t.mapTriangleToNodes(C);
t=v;n.x<=u.point.x+J&&m(k,u);n=t;for(u=n.next;u.next&&!P(u.point,u.next.point,u.prev.point);)m(k,u),u=u.next;for(u=n.prev;u.prev&&!P(u.point,u.next.point,u.prev.point);)m(k,u),u=u.prev;if(n.next&&n.next.next&&(u=n.point.x-n.next.next.point.x,y=n.point.y-n.next.next.point.y,L(0<=y,"unordered y"),0<=u||Math.abs(u)<y)){D(n.point,n.next.point,n.next.next.point)===M.CCW?k.basin.left_node=n.next.next:k.basin.left_node=n.next;for(k.basin.bottom_node=k.basin.left_node;k.basin.bottom_node.next&&k.basin.bottom_node.point.y>=
k.basin.bottom_node.next.point.y;)k.basin.bottom_node=k.basin.bottom_node.next;if(k.basin.bottom_node!==k.basin.left_node){for(k.basin.right_node=k.basin.bottom_node;k.basin.right_node.next&&k.basin.right_node.point.y<k.basin.right_node.next.point.y;)k.basin.right_node=k.basin.right_node.next;k.basin.right_node!==k.basin.bottom_node&&(k.basin.width=k.basin.right_node.point.x-k.basin.left_node.point.x,k.basin.left_highest=k.basin.left_node.point.y>k.basin.right_node.point.y,q(k,k.basin.bottom_node))}}k=
t;f=f._p2t_edge_list;for(n=0;f&&n<f.length;++n)if(u=b,t=f[n],y=k,u.edge_event.constrained_edge=t,u.edge_event.right=t.p.x>t.q.x,!d(y.triangle,t.p,t.q)){var C=u,v=t,K=y;if(C.edge_event.right)for(;K.next.point.x<v.p.x;)D(v.q,K.next.point,v.p)===M.CCW?s(C,v,K):K=K.next;else for(;K.prev.point.x>v.p.x;)D(v.q,K.prev.point,v.p)===M.CW?r(C,v,K):K=K.prev;l(u,t.p,t.q,y.triangle,t.q)}}c=b.front().head().next.triangle;for(e=b.front().head().next.point;!c.getConstrainedEdgeCW(e);)c=c.neighborCCW(e);b.meshClean(c)}},
{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(b,c,e){var l=b("./pointerror"),d=b("./point"),m=b("./triangle"),p=b("./sweep"),k=b("./advancingfront"),q=k.Node,s=function(b,d){this.p=b;this.q=d;if(b.y>d.y)this.q=b,this.p=d;else if(b.y===d.y)if(b.x>d.x)this.q=b,this.p=d;else if(b.x===d.x)throw new l("poly2tri Invalid Edge constructor: repeated points!",[b]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]);this.q._p2t_edge_list.push(this)},t=function(){this.right_node=
this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};t.prototype.clear=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};var n=function(){this.constrained_edge=null;this.right=!1};b=function(b,d){d=d||{};this.triangles_=[];this.map_=[];this.points_=d.cloneArrays?b.slice(0):b;this.edge_list=[];this.af_tail_=this.af_middle_=this.af_head_=this.tail_=this.head_=this.front_=this.pmin_=this.pmax_=null;this.basin=new t;this.edge_event=new n;
this.initEdges(this.points_)};b.prototype.addHole=function(b){this.initEdges(b);var d,c=b.length;for(d=0;d<c;d++)this.points_.push(b[d]);return this};b.prototype.AddHole=b.prototype.addHole;b.prototype.addHoles=function(b){var d,c=b.length;for(d=0;d<c;d++)this.initEdges(b[d]);this.points_=this.points_.concat.apply(this.points_,b);return this};b.prototype.addPoint=function(b){this.points_.push(b);return this};b.prototype.AddPoint=b.prototype.addPoint;b.prototype.addPoints=function(b){this.points_=
this.points_.concat(b);return this};b.prototype.triangulate=function(){p.triangulate(this);return this};b.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};b.prototype.getTriangles=function(){return this.triangles_};b.prototype.GetTriangles=b.prototype.getTriangles;b.prototype.front=function(){return this.front_};b.prototype.pointCount=function(){return this.points_.length};b.prototype.head=function(){return this.head_};b.prototype.setHead=function(b){this.head_=b};b.prototype.tail=
function(){return this.tail_};b.prototype.setTail=function(b){this.tail_=b};b.prototype.getMap=function(){return this.map_};b.prototype.initTriangulation=function(){var b=this.points_[0].x,c=this.points_[0].x,e=this.points_[0].y,m=this.points_[0].y,k,l=this.points_.length;for(k=1;k<l;k++){var p=this.points_[k];p.x>b&&(b=p.x);p.x<c&&(c=p.x);p.y>e&&(e=p.y);p.y<m&&(m=p.y)}this.pmin_=new d(c,m);this.pmax_=new d(b,e);k=0.3*(b-c);e=0.3*(e-m);this.head_=new d(b+k,m-e);this.tail_=new d(c-k,m-e);this.points_.sort(d.compare)};
b.prototype.initEdges=function(b){var d,c=b.length;for(d=0;d<c;++d)this.edge_list.push(new s(b[d],b[(d+1)%c]))};b.prototype.getPoint=function(b){return this.points_[b]};b.prototype.addToMap=function(b){this.map_.push(b)};b.prototype.locateNode=function(b){return this.front_.locateNode(b.x)};b.prototype.createAdvancingFront=function(){var b,d,c;c=new m(this.points_[0],this.tail_,this.head_);this.map_.push(c);b=new q(c.getPoint(1),c);d=new q(c.getPoint(0),c);c=new q(c.getPoint(2));this.front_=new k(b,
c);b.next=d;d.next=c;d.prev=b;c.prev=d};b.prototype.removeNode=function(b){};b.prototype.mapTriangleToNodes=function(b){for(var d=0;3>d;++d)if(!b.getNeighbor(d)){var c=this.front_.locatePoint(b.pointCW(b.getPoint(d)));c&&(c.triangle=b)}};b.prototype.removeFromMap=function(b){var d,c=this.map_,e=c.length;for(d=0;d<e;d++)if(c[d]===b){c.splice(d,1);break}};b.prototype.meshClean=function(b){b=[b];for(var d,c;d=b.pop();)if(!d.isInterior())for(d.setInterior(!0),this.triangles_.push(d),c=0;3>c;c++)d.constrained_edge[c]||
b.push(d.getNeighbor(c))};c.exports=b},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(b,c,e){e=function(b,c,e){this.points_=[b,c,e];this.neighbors_=[null,null,null];this.interior_=!1;this.constrained_edge=[!1,!1,!1];this.delaunay_edge=[!1,!1,!1]};var l=b("./xy").toString;e.prototype.toString=function(){return"["+l(this.points_[0])+l(this.points_[1])+l(this.points_[2])+"]"};e.prototype.getPoint=function(b){return this.points_[b]};e.prototype.GetPoint=e.prototype.getPoint;
e.prototype.getPoints=function(){return this.points_};e.prototype.getNeighbor=function(b){return this.neighbors_[b]};e.prototype.containsPoint=function(b){var c=this.points_;return b===c[0]||b===c[1]||b===c[2]};e.prototype.containsEdge=function(b){return this.containsPoint(b.p)&&this.containsPoint(b.q)};e.prototype.containsPoints=function(b,c){return this.containsPoint(b)&&this.containsPoint(c)};e.prototype.isInterior=function(){return this.interior_};e.prototype.setInterior=function(b){this.interior_=
b;return this};e.prototype.markNeighborPointers=function(b,c,e){var k=this.points_;if(b===k[2]&&c===k[1]||b===k[1]&&c===k[2])this.neighbors_[0]=e;else if(b===k[0]&&c===k[2]||b===k[2]&&c===k[0])this.neighbors_[1]=e;else if(b===k[0]&&c===k[1]||b===k[1]&&c===k[0])this.neighbors_[2]=e;else throw Error("poly2tri Invalid Triangle.markNeighborPointers() call");};e.prototype.markNeighbor=function(b){var c=this.points_;b.containsPoints(c[1],c[2])?(this.neighbors_[0]=b,b.markNeighborPointers(c[1],c[2],this)):
b.containsPoints(c[0],c[2])?(this.neighbors_[1]=b,b.markNeighborPointers(c[0],c[2],this)):b.containsPoints(c[0],c[1])&&(this.neighbors_[2]=b,b.markNeighborPointers(c[0],c[1],this))};e.prototype.clearNeighbors=function(){this.neighbors_[0]=null;this.neighbors_[1]=null;this.neighbors_[2]=null};e.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1;this.delaunay_edge[1]=!1;this.delaunay_edge[2]=!1};e.prototype.pointCW=function(b){var c=this.points_;return b===c[0]?c[2]:b===c[1]?c[0]:b===
c[2]?c[1]:null};e.prototype.pointCCW=function(b){var c=this.points_;return b===c[0]?c[1]:b===c[1]?c[2]:b===c[2]?c[0]:null};e.prototype.neighborCW=function(b){return b===this.points_[0]?this.neighbors_[1]:b===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};e.prototype.neighborCCW=function(b){return b===this.points_[0]?this.neighbors_[2]:b===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};e.prototype.getConstrainedEdgeCW=function(b){return b===this.points_[0]?this.constrained_edge[1]:
b===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};e.prototype.getConstrainedEdgeCCW=function(b){return b===this.points_[0]?this.constrained_edge[2]:b===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};e.prototype.getConstrainedEdgeAcross=function(b){return b===this.points_[0]?this.constrained_edge[0]:b===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};e.prototype.setConstrainedEdgeCW=function(b,c){b===this.points_[0]?this.constrained_edge[1]=
c:b===this.points_[1]?this.constrained_edge[2]=c:this.constrained_edge[0]=c};e.prototype.setConstrainedEdgeCCW=function(b,c){b===this.points_[0]?this.constrained_edge[2]=c:b===this.points_[1]?this.constrained_edge[0]=c:this.constrained_edge[1]=c};e.prototype.getDelaunayEdgeCW=function(b){return b===this.points_[0]?this.delaunay_edge[1]:b===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};e.prototype.getDelaunayEdgeCCW=function(b){return b===this.points_[0]?this.delaunay_edge[2]:b===this.points_[1]?
this.delaunay_edge[0]:this.delaunay_edge[1]};e.prototype.setDelaunayEdgeCW=function(b,c){b===this.points_[0]?this.delaunay_edge[1]=c:b===this.points_[1]?this.delaunay_edge[2]=c:this.delaunay_edge[0]=c};e.prototype.setDelaunayEdgeCCW=function(b,c){b===this.points_[0]?this.delaunay_edge[2]=c:b===this.points_[1]?this.delaunay_edge[0]=c:this.delaunay_edge[1]=c};e.prototype.neighborAcross=function(b){return b===this.points_[0]?this.neighbors_[0]:b===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};
e.prototype.oppositePoint=function(b,c){var e=b.pointCW(c);return this.pointCW(e)};e.prototype.legalize=function(b,c){var e=this.points_;if(b===e[0])e[1]=e[0],e[0]=e[2],e[2]=c;else if(b===e[1])e[2]=e[1],e[1]=e[0],e[0]=c;else if(b===e[2])e[0]=e[2],e[2]=e[1],e[1]=c;else throw Error("poly2tri Invalid Triangle.legalize() call");};e.prototype.index=function(b){var c=this.points_;if(b===c[0])return 0;if(b===c[1])return 1;if(b===c[2])return 2;throw Error("poly2tri Invalid Triangle.index() call");};e.prototype.edgeIndex=
function(b,c){var e=this.points_;if(b===e[0]){if(c===e[1])return 2;if(c===e[2])return 1}else if(b===e[1]){if(c===e[2])return 0;if(c===e[0])return 2}else if(b===e[2]){if(c===e[0])return 1;if(c===e[1])return 0}return-1};e.prototype.markConstrainedEdgeByIndex=function(b){this.constrained_edge[b]=!0};e.prototype.markConstrainedEdgeByEdge=function(b){this.markConstrainedEdgeByPoints(b.p,b.q)};e.prototype.markConstrainedEdgeByPoints=function(b,c){var e=this.points_;if(c===e[0]&&b===e[1]||c===e[1]&&b===
e[0])this.constrained_edge[2]=!0;else if(c===e[0]&&b===e[2]||c===e[2]&&b===e[0])this.constrained_edge[1]=!0;else if(c===e[1]&&b===e[2]||c===e[2]&&b===e[1])this.constrained_edge[0]=!0};c.exports=e},{"./xy":11}],10:[function(b,c,e){e.EPSILON=1E-12;var l={CW:1,CCW:-1,COLLINEAR:0};e.Orientation=l;e.orient2d=function(b,c,e){b=(b.x-e.x)*(c.y-e.y)-(b.y-e.y)*(c.x-e.x);return-1E-12<b&&1E-12>b?l.COLLINEAR:0<b?l.CCW:l.CW};e.inScanArea=function(b,c,e,k){return-1E-12<=(b.x-c.x)*(k.y-c.y)-(k.x-c.x)*(b.y-c.y)||
1E-12>=(b.x-e.x)*(k.y-e.y)-(k.x-e.x)*(b.y-e.y)?!1:!0};e.isAngleObtuse=function(b,c,e){return 0>(c.x-b.x)*(e.x-b.x)+(c.y-b.y)*(e.y-b.y)}},{}],11:[function(b,c,e){function l(b){return"("+b.x+";"+b.y+")"}c.exports={toString:function(b){var c=b.toString();return"[object Object]"===c?l(b):c},toStringBase:l,compare:function(b,c){return b.y===c.y?b.x-c.x:b.y-c.y},equals:function(b,c){return b.x===c.x&&b.y===c.y}}},{}]},{},[6])(6)});
G.GLShaderUtil={compile:function(a,b,c){if(a)return b=a.createShader(b),a.shaderSource(b,c),a.compileShader(b),!1===a.getShaderParameter(b,a.COMPILE_STATUS)&&console.error("Compile shader error:\n",c),b;console.error("No WebGL context!")},genProgram:function(a,b,c){if(a){var e=a.createProgram();a.attachShader(e,b);a.attachShader(e,c);a.linkProgram(e);a.getProgramParameter(e,a.LINK_STATUS)||(console.error("Link WebGL program error"),a.deleteProgram(e),a.deleteShader(b),a.deleteShader(c));return e}console.error("No WebGL context!")},
TILE_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nattribute vec2 a_pt;\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y - u_center.y) /u_res;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"}(),
TILE_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float u_alpha;\nuniform sampler2D u_sampler;\nvarying vec2 v_texcoord;\nvoid main(){\nvec4 v_color = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));\ngl_FragColor = vec4(v_color.rgb, v_color.a * u_alpha);\n}"}(),PT_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nattribute vec2 a_pt;\nuniform vec4 u_color;\nuniform vec2 u_shape_size;\nuniform vec2 u_offset;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh + u_offset.y;\n}\nx += u_offset.x;\ny += u_offset.y;\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\ngl_PointSize = u_shape_size.x;\nv_color = u_color;\n}"}(),
PT_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color;\n}"}(),LINE_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nattribute vec2 a_pt;\nuniform vec4 u_color;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nv_color = u_color;\n}"}(),
LINE_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color;\n}"}(),FILL_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nattribute vec2 a_pt;\nuniform float u_fill_image;\nuniform vec2 u_image_size;\nuniform float u_alpha;\nuniform vec4 u_color;\nvarying float v_fill_image;\nvarying vec2 v_texcoord;\nvarying float v_alpha;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nv_color = u_color;\nv_alpha = u_alpha;\nv_fill_image = u_fill_image;\nif( v_fill_image!=0.0 ){\nfloat imageWidth = u_image_size.x;\nfloat imageHeight = u_image_size.y;\nfloat texcoordX = x/imageWidth;\nfloat texcoordY = y/imageHeight;\nv_texcoord = vec2(texcoordX, texcoordY);\n}\n}"}(),
FILL_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_sampler;\nvarying float v_fill_image;\nvarying vec2 v_texcoord;\nvarying float v_alpha;\nvarying vec4 v_color;\nvoid main(){\nif( v_fill_image!=0.0 ){\nvec4 tex = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));\ngl_FragColor = vec4(tex.rgb, tex.a * v_alpha);\n}else{\ngl_FragColor = v_color;\n}\n}"}(),SHAPE_FILL_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nconst float PI_2 = 2.0*3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_canvas_scale;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nuniform int u_shape;\nuniform float u_size_x;\nuniform float u_size_y;\nuniform float u_offset_x;\nuniform float u_offset_y;\nattribute vec3 a_pt;\nuniform float u_fill_image;\nuniform vec2 u_image_size;\nuniform float u_alpha;\nuniform vec4 u_color;\nuniform vec4 u_color_center;\nvarying float v_fill_image;\nvarying vec2 v_texcoord;\nvarying float v_alpha;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x)/u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y)/u_res;\nfloat z = a_pt.z;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nfloat hw_shape = u_size_x/2.0;\nfloat hh_shape = u_size_y/2.0;\nif(u_shape==1){\nif(z!=-1.0){\nfloat theta = PI_2*z;\nx += hw_shape * sin(theta);\ny += hw_shape * cos(theta);\n}\n}else if(u_shape==2){\nif(z==1.0){\nx -= hw_shape;\ny -= hh_shape;\n}else if(z==2.0){\nx += hw_shape;\ny -= hh_shape;\n}else if(z==3.0){\nx += hw_shape;\ny += hh_shape;\n}else if(z==4.0){\nx -= hw_shape;\ny += hh_shape;\n}\n}\nx += u_offset_x;\ny += u_offset_y;\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nif(u_shape==1){\nif(z!=-1.0){\nv_color = u_color;\n} else {\nv_color = u_color_center;\n}\n}else if(u_shape==2){\nif(z!=0.0){\nv_color = u_color;\n} else {\nv_color = u_color_center;\n}\n}\nv_alpha = u_alpha;\nv_fill_image = u_fill_image;\nif( v_fill_image!=0.0 ){\nfloat imageWidth = u_image_size.x;\nfloat imageHeight = u_image_size.y;\nfloat texcoordX = x/imageWidth;\nfloat texcoordY = y/imageHeight;\nv_texcoord = vec2(texcoordX, texcoordY);\n}\n}"}(),
SHAPE_FILL_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_sampler;\nvarying float v_fill_image;\nvarying vec2 v_texcoord;\nvarying float v_alpha;\nvarying vec4 v_color;\nvoid main(){\nif( v_fill_image!=0.0 ){\nvec4 tex = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));\ngl_FragColor = vec4(tex.rgb, tex.a * v_alpha);\n}else{\ngl_FragColor = v_color;\n}\n}"}(),SHAPE_LINE_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nconst float PI_2 = 2.0*3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_canvas_scale;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nuniform int u_shape;\nuniform float u_size_x;\nuniform float u_size_y;\nuniform float u_offset_x;\nuniform float u_offset_y;\nattribute vec3 a_pt;\nuniform vec4 u_color;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;\nfloat z = a_pt.z;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nfloat hw_shape = u_size_x / 2.0;\nfloat hh_shape = u_size_y / 2.0;\nif(u_shape==1){\nif(z!=-1.0){\nfloat theta = PI_2*z;\nx += hw_shape * sin(theta);\ny += hw_shape * cos(theta);\n}\n}else if(u_shape==2){\nif(z==1.0){\nx -= hw_shape;\ny -= hh_shape;\n}else if(z==2.0){\nx += hw_shape;\ny -= hh_shape;\n}else if(z==3.0){\nx += hw_shape;\ny += hh_shape;\n}else if(z==4.0){\nx -= hw_shape;\ny += hh_shape;\n}\n}\nx += u_offset_x;\ny += u_offset_y;\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nv_color = u_color;\n}"}(),
SHAPE_LINE_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color;\n}"}(),SHAPE_IMAGE_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_canvas_scale;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nuniform float u_size_x;\nuniform float u_size_y;\nuniform float u_offset_x;\nuniform float u_offset_y;\nuniform float u_image_rotate;\nuniform float u_texture_size;\nattribute vec3 a_pt;\nvarying vec2 v_texcoord;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x)/u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y)/u_res;\nfloat z = a_pt.z;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nfloat hw_shape = u_size_x/2.0;\nfloat hh_shape = u_size_y/2.0;\nfloat texcoordX = 0.0;\nfloat texcoordY = 0.0;\nfloat vx = u_offset_x;\nfloat vy = u_offset_y;\nif(z==0.0){\nvx += hw_shape;\nvy += hh_shape;\ntexcoordX = hw_shape/u_texture_size;\ntexcoordY = (u_texture_size - hh_shape)/u_texture_size;\n}else if(z==1.0){\ntexcoordY = 1.0;\n}else if(z==2.0){\nvx += u_size_x;\ntexcoordX = u_size_x/u_texture_size;\ntexcoordY = 1.0;\n}else if(z==3.0){\nvx += u_size_x;\nvy += u_size_y;\ntexcoordX = u_size_x/u_texture_size;\ntexcoordY = (u_texture_size - u_size_y)/u_texture_size;\n}else if(z==4.0){\nvy += u_size_y;\ntexcoordY = (u_texture_size - u_size_y)/u_texture_size;\n}\nv_texcoord = vec2(texcoordX, texcoordY);\nfloat ra = u_image_rotate/DEGREE_PER_RADIAN;\nvec2 rv;\nrotate(vec2(vx, vy), ra, rv);\nx += rv.x;\ny += rv.y;\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\n}"}(),
SHAPE_IMAGE_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_sampler;\nvarying vec2 v_texcoord;\nvoid main(){\ngl_FragColor = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));\n}"}()};
G.GLCamera=G.Class.extend({init:function(){this._pos=vec3.create();this._target=vec3.create();this._up=vec3.fromValues(0,1,0);this._mvMatrix=mat4.create();this._pMatrix=mat4.create()},moveTo:function(a,b,c){vec3.set(this._pos,a,b,c);return this},lookAt:function(a,b,c){vec3.set(this._target,a,b,c);mat4.lookAt(this._mvMatrix,this._pos,this._target,this._up);return this}});
G.GLOrthoCamera=G.GLCamera.extend({init:function(a,b,c,e,l,d){G.GLCamera.prototype.init.call(this);this.left=a;this.right=b;this.bottom=c;this.top=e;this.near=void 0===l?0.1:l;this.far=void 0===d?2E6:d;this._updatePMatrix()},_updatePMatrix:function(){mat4.ortho(this._pMatrix,this.left,this.right,this.bottom,this.top,this.near,this.far);return this}});
G.GLDrawUtil={_tileIndices:new Uint16Array([0,1,2,0,2,3]),_tileTextureCoords:new Float32Array([0,1,1,1,1,0,0,0]),_bufferFloat32Array:function(a,b,c,e,l){a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);a.enableVertexAttribArray(e);a.vertexAttribPointer(e,l,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,null)},drawTile:function(a,b,c,e){var l=a._map;if(l){var d=l._gl,m=l._camera,p=l._canvasOffset,k=l.getCenter(),q=l.getSize(),s=a._zoomScale||a._scale,t=a._aroundScreen||[];if(b._loaded&&
(b._gl_t||(a=b._gl_t=d.createTexture(),d.bindTexture(d.TEXTURE_2D,a),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.generateMipmap(d.TEXTURE_2D),d.bindTexture(d.TEXTURE_2D,null)),a=b._gl_t)){var n=d.tileProgram;d.useProgram(n);var r=b._gl_u_mv=
b._gl_u_mv||d.getUniformLocation(n,"u_mv"),f=b._gl_u_p=b._gl_u_p||d.getUniformLocation(n,"u_p"),u=b._gl_u_canvas_offset=b._gl_u_canvas_offset||d.getUniformLocation(n,"u_canvas_offset"),v=b._gl_u_zoom_around=b._gl_u_zoom_around||d.getUniformLocation(n,"u_zoom_around"),K=b._gl_u_zoom_scale=b._gl_u_zoom_scale||d.getUniformLocation(n,"u_zoom_scale"),C=b._gl_u_ignore_rotate=b._gl_u_ignore_rotate||d.getUniformLocation(n,"u_ignore_rotate"),L=b._gl_u_res=b._gl_u_res||d.getUniformLocation(n,"u_res"),y=b._gl_u_center=
b._gl_u_center||d.getUniformLocation(n,"u_center"),Q=b._gl_u_size=b._gl_u_size||d.getUniformLocation(n,"u_size"),N=b._gl_u_rotate=b._gl_u_rotate||d.getUniformLocation(n,"u_rotate"),J=b._gl_a_pt=b._gl_a_pt||d.getAttribLocation(n,"a_pt"),M=b._gl_u_sampler=b._gl_u_sampler||d.getUniformLocation(n,"u_sampler"),D=b._gl_a_texcoord=b._gl_a_texcoord||d.getAttribLocation(n,"a_texcoord"),n=b._gl_u_alpha=b._gl_u_alpha||d.getUniformLocation(n,"u_alpha");d.uniformMatrix4fv(r,!1,m._mvMatrix);d.uniformMatrix4fv(f,
!1,m._pMatrix);d.uniform2f(u,p[0],p[1]);d.uniform2f(v,t[0]||0,t[1]||0);d.uniform1f(K,s||1);d.uniform1i(C,1);d.uniform1f(L,l._res);d.uniform2f(y,k[0],k[1]);d.uniform2f(Q,q[0],q[1]);d.uniform1f(N,l._rotate);d.uniform1f(n,e||1);e=b._gl_vb=b._gl_vb||d.createBuffer();l=b._gl_ib=b._gl_ib||d.createBuffer();b=b._gl_tcb=b._gl_tcb||d.createBuffer();this._bufferFloat32Array(d,e,new Float32Array(c),J,2);this._bufferFloat32Array(d,b,this._tileTextureCoords,D,2);d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,
a);d.uniform1i(M,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l);d.bufferData(d.ELEMENT_ARRAY_BUFFER,this._tileIndices,d.STATIC_DRAW);d.drawElements(d.TRIANGLES,this._tileIndices.length,d.UNSIGNED_SHORT,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null);d.bindTexture(d.TEXTURE_2D,null)}}},drawLine:function(a,b,c,e,l,d,m,p){var k=a._layer;m=k._map;if(!(2>a._gl_line_vcount)){d=m._gl;p=m._camera;var q=m._canvasOffset,s=m.getCenter(),t=m.getSize(),n=k._zoomScale||k._scale,r=k._aroundScreen||[],f=d.lineProgram;d.useProgram(f);
var u=a._gl_l_u_mv=a._gl_l_u_mv||d.getUniformLocation(f,"u_mv"),v=a._gl_l_u_p=a._gl_l_u_p||d.getUniformLocation(f,"u_p"),K=a._gl_l_u_canvas_offset=a._gl_l_u_canvas_offset||d.getUniformLocation(f,"u_canvas_offset"),C=a._gl_l_u_graphic_offset=a._gl_l_u_graphic_offset||d.getUniformLocation(f,"u_graphic_offset"),L=a._gl_l_u_zoom_around=a._gl_l_u_zoom_around||d.getUniformLocation(f,"u_zoom_around"),y=a._gl_l_u_zoom_scale=a._gl_l_u_zoom_scale||d.getUniformLocation(f,"u_zoom_scale"),Q=a._gl_l_u_ignore_rotate=
a._gl_l_u_ignore_rotate||d.getUniformLocation(f,"u_ignore_rotate"),N=a._gl_l_u_res=a._gl_l_u_res||d.getUniformLocation(f,"u_res"),J=a._gl_l_u_center=a._gl_l_u_center||d.getUniformLocation(f,"u_center"),M=a._gl_l_u_size=a._gl_l_u_size||d.getUniformLocation(f,"u_size"),D=a._gl_l_u_rotate=a._gl_l_u_rotate||d.getUniformLocation(f,"u_rotate"),k=a._gl_l_a_pt=a._gl_l_a_pt||d.getAttribLocation(f,"a_pt"),f=a._gl_l_u_color=a._gl_l_u_color||d.getUniformLocation(f,"u_color");d.uniformMatrix4fv(u,!1,p._mvMatrix);
d.uniformMatrix4fv(v,!1,p._pMatrix);d.uniform2f(K,q[0],q[1]);d.uniform2f(C,b[0]||0,b[1]||0);d.uniform2f(L,r[0]||0,r[1]||0);d.uniform1f(y,n||1);d.uniform1i(Q,1);d.uniform1f(N,m._res);d.uniform2f(J,s[0],s[1]);d.uniform2f(M,t[0],t[1]);d.uniform1f(D,m._rotate);d.uniform4f(f,c[0]/255,c[1]/255,c[2]/255,e);d.lineWidth(l);b=a._gl_line_vb=a._gl_line_vb||d.createBuffer();this._bufferFloat32Array(d,b,a._gl_line_vs,k,2);d.bindBuffer(d.ARRAY_BUFFER,b);d.drawArrays(d.LINE_STRIP,0,a._gl_line_vcount);d.bindBuffer(d.ARRAY_BUFFER,
null)}},drawFill:function(a,b,c,e,l,d){var m=a._layer,p=m._map;if(!(3>a._gl_fill_vcount)){var k=p._gl,q=p._camera,s=p._canvasOffset,t=p.getCenter(),n=p.getSize(),r=m._zoomScale||m._scale,f=m._aroundScreen||[],u=k.fillProgram;k.useProgram(u);var v=a._gl_f_u_mv=a._gl_f_u_mv||k.getUniformLocation(u,"u_mv"),K=a._gl_f_u_p=a._gl_f_u_p||k.getUniformLocation(u,"u_p"),C=a._gl_f_u_canvas_offset=a._gl_f_u_canvas_offset||k.getUniformLocation(u,"u_canvas_offset"),L=a._gl_f_u_graphic_offset=a._gl_f_u_graphic_offset||
k.getUniformLocation(u,"u_graphic_offset"),y=a._gl_f_u_zoom_around=a._gl_f_u_zoom_around||k.getUniformLocation(u,"u_zoom_around"),Q=a._gl_f_u_zoom_scale=a._gl_f_u_zoom_scale||k.getUniformLocation(u,"u_zoom_scale"),N=a._gl_f_u_ignore_rotate=a._gl_f_u_ignore_rotate||k.getUniformLocation(u,"u_ignore_rotate"),J=a._gl_f_u_res=a._gl_f_u_res||k.getUniformLocation(u,"u_res"),M=a._gl_f_u_center=a._gl_f_u_center||k.getUniformLocation(u,"u_center"),D=a._gl_f_u_size=a._gl_f_u_size||k.getUniformLocation(u,"u_size"),
O=a._gl_f_u_rotate=a._gl_f_u_rotate||k.getUniformLocation(u,"u_rotate"),P=a._gl_f_a_pt=a._gl_f_a_pt||k.getAttribLocation(u,"a_pt"),x=a._gl_f_u_fill_image=a._gl_f_u_fill_image||k.getUniformLocation(u,"u_fill_image"),m=a._gl_f_u_image_size=a._gl_f_u_image_size||k.getUniformLocation(u,"u_image_size"),z=a._gl_f_u_sampler=a._gl_f_u_sampler||k.getUniformLocation(u,"u_sampler");a._gl_f_a_texcoord=a._gl_f_a_texcoord||k.getAttribLocation(u,"a_texcoord");var A=a._gl_f_u_alpha=a._gl_f_u_alpha||k.getUniformLocation(u,
"u_alpha"),u=a._gl_f_u_color=a._gl_f_u_color||k.getUniformLocation(u,"u_color");k.uniformMatrix4fv(v,!1,q._mvMatrix);k.uniformMatrix4fv(K,!1,q._pMatrix);k.uniform2f(C,s[0],s[1]);k.uniform2f(L,b[0]||0,b[1]||0);k.uniform2f(y,f[0]||0,f[1]||0);k.uniform1f(Q,r||1);k.uniform1i(N,1);k.uniform1f(J,p._res);k.uniform2f(M,t[0],t[1]);k.uniform2f(D,n[0],n[1]);k.uniform1f(O,p._rotate);k.uniform1f(x,e?1:0);k.uniform1f(A,d);b=a._gl_fill_vb=a._gl_fill_vb||k.createBuffer();this._bufferFloat32Array(k,b,a._gl_fill_vs,
P,2);if(e)if(k.uniform2f(m,l[0],l[1]),this._ensureImageTexture(e,l,p._textureCtx,k.REPEAT),c=e._gl_t)k.uniform2f(m,l[0],l[1]),k.activeTexture(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,c),k.uniform1i(z,0);else return;else k.uniform4f(u,c[0]/255,c[1]/255,c[2]/255,d);k.bindBuffer(k.ARRAY_BUFFER,b);k.drawArrays(k.TRIANGLES,0,a._gl_fill_vcount);k.bindBuffer(k.ARRAY_BUFFER,null);k.bindTexture(k.TEXTURE_2D,null)}},drawShapeFill:function(a,b,c,e,l,d,m,p,k,q){var s=a._layer,t=s._map;if(!(3>a._gl_fill_vcount)){var n=
t._gl,r=t._camera,f=t._canvasOffset,u=t._canvasScale,v=t.getCenter(),K=t.getSize(),C=s._zoomScale||s._scale,L=s._aroundScreen||[],y=n.shapeFillProgram;n.useProgram(y);var Q=a._gl_sf_u_mv=a._gl_sf_u_mv||n.getUniformLocation(y,"u_mv"),N=a._gl_sf_u_p=a._gl_sf_u_p||n.getUniformLocation(y,"u_p"),J=a._gl_sf_u_canvas_offset=a._gl_sf_u_canvas_offset||n.getUniformLocation(y,"u_canvas_offset"),M=a._gl_sf_u_canvas_scale=a._gl_sf_u_canvas_scale||n.getUniformLocation(y,"u_canvas_scale"),D=a._gl_sf_u_graphic_offset=
a._gl_sf_u_graphic_offset||n.getUniformLocation(y,"u_graphic_offset"),O=a._gl_sf_u_zoom_around=a._gl_sf_u_zoom_around||n.getUniformLocation(y,"u_zoom_around"),P=a._gl_sf_u_zoom_scale=a._gl_sf_u_zoom_scale||n.getUniformLocation(y,"u_zoom_scale"),x=a._gl_sf_u_ignore_rotate=a._gl_sf_u_ignore_rotate||n.getUniformLocation(y,"u_ignore_rotate"),z=a._gl_sf_u_res=a._gl_sf_u_res||n.getUniformLocation(y,"u_res"),A=a._gl_sf_u_center=a._gl_sf_u_center||n.getUniformLocation(y,"u_center"),B=a._gl_sf_u_size=a._gl_sf_u_size||
n.getUniformLocation(y,"u_size"),E=a._gl_sf_u_rotate=a._gl_sf_u_rotate||n.getUniformLocation(y,"u_rotate"),H=a._gl_sf_u_shape=a._gl_sf_u_shape||n.getUniformLocation(y,"u_shape"),F=a._gl_sf_u_size_x=a._gl_sf_u_size_x||n.getUniformLocation(y,"u_size_x"),I=a._gl_sf_u_size_y=a._gl_sf_u_size_y||n.getUniformLocation(y,"u_size_y"),R=a._gl_sf_u_offset_x=a._gl_sf_u_offset_x||n.getUniformLocation(y,"u_offset_x"),T=a._gl_sf_u_offset_y=a._gl_sf_u_offset_y||n.getUniformLocation(y,"u_offset_y"),U=a._gl_sf_a_pt=
a._gl_sf_a_pt||n.getAttribLocation(y,"a_pt"),V=a._gl_sf_u_fill_image=a._gl_sf_u_fill_image||n.getUniformLocation(y,"u_fill_image"),s=a._gl_sf_u_image_size=a._gl_sf_u_image_size||n.getUniformLocation(y,"u_image_size"),W=a._gl_sf_u_sampler=a._gl_sf_u_sampler||n.getUniformLocation(y,"u_sampler");a._gl_sf_a_texcoord=a._gl_sf_a_texcoord||n.getAttribLocation(y,"a_texcoord");var X=a._gl_sf_u_alpha=a._gl_sf_u_alpha||n.getUniformLocation(y,"u_alpha"),Y=a._gl_sf_u_color=a._gl_sf_u_color||n.getUniformLocation(y,
"u_color"),y=a._gl_sf_u_color_center=a._gl_sf_u_color_center||n.getUniformLocation(y,"u_color_center");n.uniformMatrix4fv(Q,!1,r._mvMatrix);n.uniformMatrix4fv(N,!1,r._pMatrix);n.uniform2f(J,f[0],f[1]);n.uniform2f(M,u[0],u[1]);n.uniform2f(D,b[0]||0,b[1]||0);n.uniform2f(O,L[0]||0,L[1]||0);n.uniform1f(P,C||1);n.uniform1i(x,1);n.uniform1f(z,t._res);n.uniform2f(A,v[0],v[1]);n.uniform2f(B,K[0],K[1]);n.uniform1f(E,t._rotate);"circle"==c?n.uniform1i(H,1):"rect"==c&&n.uniform1i(H,2);n.uniform1f(F,e[0]||0);
n.uniform1f(I,e[1]||0);n.uniform1f(R,l[0]||0);n.uniform1f(T,l[1]||0);n.uniform1f(V,m?1:0);n.uniform1f(X,k);b=a._gl_fill_vb=a._gl_fill_vb||n.createBuffer();this._bufferFloat32Array(n,b,a._gl_fill_vs,U,3);if(m)if(this._ensureImageTexture(m,p,t._textureCtx,n.REPEAT),d=m._gl_t)n.uniform2f(s,p[0],p[1]),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,d),n.uniform1i(W,0);else return;else n.uniform4f(Y,d[0]/255,d[1]/255,d[2]/255,k),n.uniform4f(y,d[0]/255,d[1]/255,d[2]/255,q?1:k);n.bindBuffer(n.ARRAY_BUFFER,
b);n.drawArrays(n.TRIANGLES,0,a._gl_fill_vcount);n.bindBuffer(n.ARRAY_BUFFER,null);n.bindTexture(n.TEXTURE_2D,null)}},drawShapeLine:function(a,b,c,e,l,d,m,p,k,q,s){var t=a._layer;q=t._map;if(!(2>a._gl_line_vcount)){k=q._gl;s=q._camera;var n=q._canvasOffset,r=q._canvasScale,f=q.getCenter(),u=q.getSize(),v=t._zoomScale||t._scale,K=t._aroundScreen||[],C=k.shapeLineProgram;k.useProgram(C);var L=a._gl_sl_u_mv=a._gl_sl_u_mv||k.getUniformLocation(C,"u_mv"),y=a._gl_sl_u_p=a._gl_sl_u_p||k.getUniformLocation(C,
"u_p"),Q=a._gl_sl_u_canvas_offset=a._gl_sl_u_canvas_offset||k.getUniformLocation(C,"u_canvas_offset"),N=a._gl_sl_u_canvas_scale=a._gl_sl_u_canvas_scale||k.getUniformLocation(C,"u_canvas_scale"),J=a._gl_sl_u_graphic_offset=a._gl_sl_u_graphic_offset||k.getUniformLocation(C,"u_graphic_offset"),M=a._gl_sl_u_zoom_around=a._gl_sl_u_zoom_around||k.getUniformLocation(C,"u_zoom_around"),D=a._gl_sl_u_zoom_scale=a._gl_sl_u_zoom_scale||k.getUniformLocation(C,"u_zoom_scale"),O=a._gl_sl_u_ignore_rotate=a._gl_sl_u_ignore_rotate||
k.getUniformLocation(C,"u_ignore_rotate"),P=a._gl_sl_u_res=a._gl_sl_u_res||k.getUniformLocation(C,"u_res"),x=a._gl_sl_u_center=a._gl_sl_u_center||k.getUniformLocation(C,"u_center"),z=a._gl_sl_u_size=a._gl_sl_u_size||k.getUniformLocation(C,"u_size"),A=a._gl_sl_u_rotate=a._gl_sl_u_rotate||k.getUniformLocation(C,"u_rotate"),B=a._gl_sl_u_shape=a._gl_sl_u_shape||k.getUniformLocation(C,"u_shape"),E=a._gl_sl_u_size_x=a._gl_sl_u_size_x||k.getUniformLocation(C,"u_size_x"),H=a._gl_sl_u_size_y=a._gl_sl_u_size_y||
k.getUniformLocation(C,"u_size_y"),F=a._gl_sl_u_offset_x=a._gl_sl_u_offset_x||k.getUniformLocation(C,"u_offset_x"),I=a._gl_sl_u_offset_y=a._gl_sl_u_offset_y||k.getUniformLocation(C,"u_offset_y"),t=a._gl_sl_a_pt=a._gl_sl_a_pt||k.getAttribLocation(C,"a_pt"),C=a._gl_sl_u_color=a._gl_sl_u_color||k.getUniformLocation(C,"u_color");k.uniformMatrix4fv(L,!1,s._mvMatrix);k.uniformMatrix4fv(y,!1,s._pMatrix);k.uniform2f(Q,n[0],n[1]);k.uniform2f(N,r[0],r[1]);k.uniform2f(J,b[0]||0,b[1]||0);k.uniform2f(M,K[0]||
0,K[1]||0);k.uniform1f(D,v||1);k.uniform1i(O,1);k.uniform1f(P,q._res);k.uniform2f(x,f[0],f[1]);k.uniform2f(z,u[0],u[1]);k.uniform1f(A,q._rotate);"circle"==c?k.uniform1i(B,1):"rect"==c&&k.uniform1i(B,2);k.uniform1f(E,e[0]||0);k.uniform1f(H,e[1]||0);k.uniform1f(F,l[0]||0);k.uniform1f(I,l[1]||0);k.uniform4f(C,d[0]/255,d[1]/255,d[2]/255,m);b=a._gl_line_vb=a._gl_line_vb||k.createBuffer();this._bufferFloat32Array(k,b,a._gl_line_vs,t,3);k.bindBuffer(k.ARRAY_BUFFER,b);k.lineWidth(p);k.drawArrays(k.LINE_STRIP,
0,a._gl_line_vcount);k.bindBuffer(k.ARRAY_BUFFER,null)}},drawShapeImage:function(a,b,c,e,l,d){var m=a._layer,p=m._map;if(12==a._gl_fill_vcount&&c){var k=p._gl,q=p._camera,s=p._canvasOffset,t=p._canvasScale,n=p.getCenter(),r=p.getSize(),f=m._zoomScale||m._scale,m=m._aroundScreen||[],u;if(c._loaded&&(this._ensureImageTexture(c,e,p._textureCtx,k.CLAMP_TO_EDGE),u=c._gl_t)&&(c=c._gl_image_size)){var v=k.shapeImageProgram;k.useProgram(v);var K=a._gl_si_u_mv=a._gl_si_u_mv||k.getUniformLocation(v,"u_mv"),
C=a._gl_si_u_p=a._gl_si_u_p||k.getUniformLocation(v,"u_p"),L=a._gl_si_u_canvas_offset=a._gl_si_u_canvas_offset||k.getUniformLocation(v,"u_canvas_offset"),y=a._gl_si_u_canvas_scale=a._gl_si_u_canvas_scale||k.getUniformLocation(v,"u_canvas_scale"),Q=a._gl_si_u_graphic_offset=a._gl_si_u_graphic_offset||k.getUniformLocation(v,"u_graphic_offset"),N=a._gl_si_u_zoom_around=a._gl_si_u_zoom_around||k.getUniformLocation(v,"u_zoom_around"),J=a._gl_si_u_zoom_scale=a._gl_si_u_zoom_scale||k.getUniformLocation(v,
"u_zoom_scale"),M=a._gl_si_u_ignore_rotate=a._gl_si_u_ignore_rotate||k.getUniformLocation(v,"u_ignore_rotate"),D=a._gl_si_u_res=a._gl_si_u_res||k.getUniformLocation(v,"u_res"),O=a._gl_si_u_center=a._gl_si_u_center||k.getUniformLocation(v,"u_center"),P=a._gl_si_u_size=a._gl_si_u_size||k.getUniformLocation(v,"u_size"),x=a._gl_si_u_rotate=a._gl_si_u_rotate||k.getUniformLocation(v,"u_rotate"),z=a._gl_si_u_size_x=a._gl_si_u_size_x||k.getUniformLocation(v,"u_size_x"),A=a._gl_si_u_size_y=a._gl_si_u_size_y||
k.getUniformLocation(v,"u_size_y"),B=a._gl_si_u_offset_x=a._gl_si_u_offset_x||k.getUniformLocation(v,"u_offset_x"),E=a._gl_si_u_offset_y=a._gl_si_u_offset_y||k.getUniformLocation(v,"u_offset_y"),H=a._gl_si_u_image_rotate=a._gl_si_u_image_rotate||k.getUniformLocation(v,"u_image_rotate"),F=a._gl_si_u_texture_size=a._gl_si_u_texture_size||k.getUniformLocation(v,"u_texture_size"),I=a._gl_si_a_pt=a._gl_si_a_pt||k.getAttribLocation(v,"a_pt"),R=a._gl_si_u_sampler=a._gl_si_u_sampler||k.getUniformLocation(v,
"u_sampler");a._gl_si_a_texcoord=a._gl_si_a_texcoord||k.getAttribLocation(v,"a_texcoord");v=a._gl_fill_vb=a._gl_fill_vb||k.createBuffer();this._bufferFloat32Array(k,v,a._gl_fill_vs,I,3);k.uniformMatrix4fv(K,!1,q._mvMatrix);k.uniformMatrix4fv(C,!1,q._pMatrix);k.uniform2f(L,s[0],s[1]);k.uniform2f(y,t[0],t[1]);k.uniform2f(Q,b[0]||0,b[1]||0);k.uniform2f(N,m[0]||0,m[1]||0);k.uniform1f(J,f||1);k.uniform1i(M,1);k.uniform1f(D,p._res);k.uniform2f(O,n[0],n[1]);k.uniform2f(P,r[0],r[1]);k.uniform1f(x,p._rotate);
k.uniform1f(z,e[0]);k.uniform1f(A,e[1]);k.uniform1f(B,l[0]||0);k.uniform1f(E,l[1]||0);k.uniform1f(H,d||0);k.uniform1f(F,c);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,u);k.uniform1i(R,0);k.bindBuffer(k.ARRAY_BUFFER,v);k.drawArrays(k.TRIANGLES,0,a._gl_fill_vcount);k.bindBuffer(k.ARRAY_BUFFER,null);k.bindTexture(k.TEXTURE_2D,null)}}},drawShapeText:function(a,b,c,e,l,d,m,p,k,q){var s=a._layer,t=s._map;if(12==a._gl_fill_vcount&&void 0!=c){var n=t._gl,r=t._camera,f=t._canvasOffset,u=t._canvasScale,
v=t.getCenter(),K=t.getSize(),C=s._zoomScale||s._scale,s=s._aroundScreen||[],L,y,Q=e[0],N;e=a._textMeasure;if(!a._gl_image_data||c&&e!=c)L=t._textureCtx,L.save(),L.font=k+" "+Q+"px "+p,L.textBaseline="bottom",e=L.measureText(c),a._textMeasureWidth=e.width,a._textMeasure=c,N=a._textSize=[e.width,Q+2],e=this._calcTextureSize(N[0],N[1]),y=L.canvas,y.width=e,y.height=e,L.fillStyle=d,L.globalAlpha=m,L.font=k+" "+Q+"px "+p,L.textBaseline="bottom",L.fillText(c,0,N[1]-1),a._gl_image_data=L.getImageData(0,
0,e,e),a._gl_image_size=e,L.restore();!a._gl_t&&a._gl_image_data&&(c=a._gl_t=n.createTexture(),n.bindTexture(n.TEXTURE_2D,c),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,a._gl_image_data),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,
null));if(c=a._gl_t)if(e=a._gl_image_size){var J=n.shapeImageProgram;n.useProgram(J);N=a._gl_st_u_mv=a._gl_st_u_mv||n.getUniformLocation(J,"u_mv");var M=a._gl_st_u_p=a._gl_st_u_p||n.getUniformLocation(J,"u_p"),D=a._gl_st_u_canvas_offset=a._gl_st_u_canvas_offset||n.getUniformLocation(J,"u_canvas_offset"),O=a._gl_st_u_canvas_scale=a._gl_st_u_canvas_scale||n.getUniformLocation(J,"u_canvas_scale"),P=a._gl_st_u_graphic_offset=a._gl_st_u_graphic_offset||n.getUniformLocation(J,"u_graphic_offset"),x=a._gl_st_u_zoom_around=
a._gl_st_u_zoom_around||n.getUniformLocation(J,"u_zoom_around"),z=a._gl_st_u_zoom_scale=a._gl_st_u_zoom_scale||n.getUniformLocation(J,"u_zoom_scale"),A=a._gl_st_u_ignore_rotate=a._gl_st_u_ignore_rotate||n.getUniformLocation(J,"u_ignore_rotate"),B=a._gl_st_u_res=a._gl_st_u_res||n.getUniformLocation(J,"u_res"),E=a._gl_st_u_center=a._gl_st_u_center||n.getUniformLocation(J,"u_center"),H=a._gl_st_u_size=a._gl_st_u_size||n.getUniformLocation(J,"u_size"),F=a._gl_st_u_rotate=a._gl_st_u_rotate||n.getUniformLocation(J,
"u_rotate");d=a._gl_st_u_size_x=a._gl_st_u_size_x||n.getUniformLocation(J,"u_size_x");m=a._gl_st_u_size_y=a._gl_st_u_size_y||n.getUniformLocation(J,"u_size_y");p=a._gl_st_u_offset_x=a._gl_st_u_offset_x||n.getUniformLocation(J,"u_offset_x");k=a._gl_st_u_offset_y=a._gl_st_u_offset_y||n.getUniformLocation(J,"u_offset_y");Q=a._gl_st_u_image_rotate=a._gl_st_u_image_rotate||n.getUniformLocation(J,"u_image_rotate");L=a._gl_st_u_texture_size=a._gl_st_u_texture_size||n.getUniformLocation(J,"u_texture_size");
var I=a._gl_st_a_pt=a._gl_st_a_pt||n.getAttribLocation(J,"a_pt");y=a._gl_st_u_sampler=a._gl_st_u_sampler||n.getUniformLocation(J,"u_sampler");a._gl_st_a_texcoord=a._gl_st_a_texcoord||n.getAttribLocation(J,"a_texcoord");J=a._gl_fill_vb=a._gl_fill_vb||n.createBuffer();this._bufferFloat32Array(n,J,a._gl_fill_vs,I,3);n.uniformMatrix4fv(N,!1,r._mvMatrix);n.uniformMatrix4fv(M,!1,r._pMatrix);n.uniform2f(D,f[0],f[1]);n.uniform2f(O,u[0],u[1]);n.uniform2f(P,b[0],b[1]);n.uniform2f(x,s[0]||0,s[1]||0);n.uniform1f(z,
C||1);n.uniform1i(A,1);n.uniform1f(B,t._res);n.uniform2f(E,v[0],v[1]);n.uniform2f(H,K[0],K[1]);n.uniform1f(F,t._rotate);N=a._textSize;n.uniform1f(d,N[0]);n.uniform1f(m,N[1]);"left"==q?n.uniform1f(p,l[0]||0):"right"==q?n.uniform1f(p,(l[0]||0)-N[0]):n.uniform1f(p,(l[0]||0)-N[0]/2);n.uniform1f(k,(l[1]||0)-N[1]/2);n.uniform1f(Q,0);n.uniform1f(L,e);n.activeTexture(n.TEXTURE0);n.bindTexture(n.TEXTURE_2D,c);n.uniform1i(y,0);n.bindBuffer(n.ARRAY_BUFFER,J);n.drawArrays(n.TRIANGLES,0,a._gl_fill_vcount);n.bindBuffer(n.ARRAY_BUFFER,
null);n.bindTexture(n.TEXTURE_2D,null)}}},_calcTextureSize:function(a,b){var c=Math.max(a,b||a),e,l;for(e=2;8>=e;e++){l=Math.pow(2,e);if(l>=c){c=l;break}8==e&&(c=l)}return c},_ensureImageTexture:function(a,b,c,e){var l,d;a&&a._loaded&&(a._gl_image_data||(d=this._calcTextureSize(b[0],b[1]),c.save(),l=c.canvas,l.width=d,l.height=d,c.clearRect(0,0,d,d),c.drawImage(a,0,0,b[0],b[1]),a._gl_image_data=c.getImageData(0,0,d,d),a._gl_image_size=d,c.restore()),!a._gl_t&&a._gl_image_data&&(b=a._gl_t=gl.createTexture(),
gl.bindTexture(gl.TEXTURE_2D,b),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a._gl_image_data),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,e),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,e),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null)))}};
G.Layer.Tile=G.Layer.Tile.extend({_initContainer:function(){var a=this._map;this.addListener("tileSuccess",a._requestRedraw,a);this.addListener("allLoaded",a._requestRedraw,a)},_destroyContainer:function(){var a=this._map;this.removeListener("tileSuccess",a._requestRedraw,a);this.removeListener("allLoaded",a._requestRedraw,a)},_update:function(){var a=this._map;if(a._isLoaded()){var b=this._zoom=this._calcNearestZoom(!0),c=this._calcVisTileInfos(!0);a.getSize();var e=a.getCenter(),l=this.options,
d=l.zoomReses[b],m=l.tileSize,p=a.getDrawSize(),k=1+2*a.options.canvasExpandFactor,q=p[0]*k,p=p[1]*k,d=[e[0]-q*d/2,e[1]-p*d/2,e[0]+q*d/2,e[1]+p*d/2],a=a.options.maxExtent,s,t;this._redrawExtent=d;var d=G.ExtentUtil.intersect(d,a),n;for(n in this._tiles)k=this._tiles[n],a=k._info,s=a[0],q=a[1],t=a[2],p=l.zoomReses[t],t!==b&&(this._stopLoadingTile(k),(!l.keepResample||1>l.opacity)&&this._removeTile(n)),k=l.originX+s*m*p,s=l.originX+(s+1)*m*p,t=l.originY-(q+1)*m*p,q=l.originY-q*m*p,(q=G.ExtentUtil.overlaps([k,
t,s,q],d))||this._tileInfoExist(a,c)||this._removeTile(n);b=this._calcTileIndex(e[0],e[1],b);this._sortTileInfos(c,b[0],b[1]);this._addTiles(c);this._draw()}},_draw:function(){var a=this.options,b,c,e,l,d=this._zoom,m;for(m in this._tiles)b=this._tiles[m],c=b._info,l=parseInt(c[2]),!b._loaded||(l===d||!a.keepResample||1>a.opacity)||(e=parseInt(c[0]),c=parseInt(c[1]),this._placeTile(b,e,c,l));for(m in this._tiles)b=this._tiles[m],c=b._info,l=parseInt(c[2]),b._loaded&&l===d&&(e=parseInt(c[0]),c=parseInt(c[1]),
this._placeTile(b,e,c,l))},_placeTile:function(a,b,c,e){if(a._loaded){G.Browser.getPxRatio();var l=this._map,d=l._rotate,m=l._res,p=this.options,l=l.options,k=p.tileSize,q=k*p.zoomReses[e],d=p.tileEnlarge&&(!!(d%90)||G.Browser.gecko||G.Browser.safari);e=Math.ceil(q/m)+(d?2:0);b=p.originX+b*q;c=p.originY-c*q;(q=this._zoomScale||this._scale)&&1!==q&&(e/=q);if(!(e>4*(k+2)||e<k/8)&&(k=e*m,e*=m,l.wrap)){var s=q=0,l=l.maxExtent,t=this._redrawExtent;if(t&&l)var n=l[2]-l[0],s=Math.floor((t[0]-p.minX)/n)-
1,q=Math.ceil((t[2]-p.maxX)/n)+1;for(l=s;l<=q;l++)s=b+l*n,t=c,d&&(s-=m,t+=m),G.GLDrawUtil.drawTile(this,a,[s,t,s+k,t,s+k,t-e,s,t-e],p.opacity)}}},_addTiles:function(a){if(0!==a.length){this._numLoad=a.length;this._numLoadError=this._numLoadSuccess=0;for(var b=this.options,c,e,l,d,m,p=this.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE,k=0,q=a.length;k<q;k++)c=a[k],e=c[0],l=c[1],d=c[2],m=this._getTileName(e,l,d),(c=this._tiles[m])?c.src==p?+new Date-c._responseTime>b.tileLiveMs&&this._loadTile(c,e,
l,d):this._numLoadSuccess++:(c=this._getIdleTile(),this._tiles[m]=c,this._loadTile(c,e,l,d))}},_clearBgBuffer:function(){var a,b;for(b in this._tiles)a=this._tiles[b],a=a._info,a=a[2],a!==this._zoom&&this._removeTile(b)},_onTileRemoved:function(a){var b=this._map._gl;b.deleteBuffer(a._gl_vb);b.deleteBuffer(a._gl_ib);b.deleteBuffer(a._gl_tcb);b.deleteTexture(a._gl_t);a._gl_vb=null;a._gl_ib=null;a._gl_tcb=null;a._gl_t=null}});
G.Layer.Graphic=G.Layer.Graphic.extend({_update:function(){this._draw()},_draw:function(){var a=this._map.getRedrawExtent(),b=this._tree.search(a).sort(this._sortIndex),c,e,l;for(l in b)c=b[l],e=c.bbox,c._draw&&(c._layer&&G.ExtentUtil.overlaps(e,a)&&!c._isVertex)&&c._draw();for(l in b)c=b[l],e=c.bbox,c._draw&&(c._layer&&G.ExtentUtil.overlaps(e,a)&&c._isVertex)&&c._draw()}});
G.Layer.Label=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{icons:"",cluster:[],crossOrigin:"*"},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a;this.options=G.Util.merge({},this.options,b);this._lts={};this._gx=this._gy=10},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);
if(a._isLoaded()){var b=this._zoom=this._calcNearestZoom(!0),c=a.getCenter();this._clearGrids();a=a._zoomAnim;a&&a._playing||(a=this._calcVisTileInfos(),b=this._calcTileIndex(c[0],c[1],b),this._sortTileInfos(a,b[0],b[1]),this._setLts(a))}},_setLts:function(a){if(a.length){for(var b=[],c,e,l,d,m,p=0,k=a.length;p<k;p++)c=a[p],l=c[0],d=c[1],m=c[2],c=this._getTileName(l,d,m),b.push(c),c in this._lts?(e=this._lts[c],e.loading||e.data||e.ri||this._loadLtI(l,d,m)):this._loadLtI(l,d,m),this._placeLt(c);this._dirtyTileKeys=
this._dirtyTileKeys||[];for(c in this._lts)-1<b.indexOf(c)||(this._stopLoadingLt(c),this._dirtyTileKeys.push(c))}},_checkDirtyTiles:function(){var a=this._dirtyTileKeys,b;if(a&&0<a.length)for(var c=0,e=a.length;c<e;c++)b=a[c],this._removeLt(b);this._dirtyTileKeys=[]},_placeLt:function(a){if((a=this._lts[a])&&a._info&&a.data){var b=a.data.l,c,e,l,d,m,p,k,q,s,t,n,r;for(c in b)for(n in e=b[c],l=Number(e[0]),d=Number(e[1]),e=e[6],l=[l,d],d="imgs"+c,t=a[d],t)d=t[n],m=d[0],p=d[1],k=d[2],q=d[3],s=d[4],r=
d[5],r||(d[5]=r=new G.Graphic.Point(l,null,{shape:"image",size:[p,k],offset:[q,s],image:m,imageGravity:!!e}),r.addTo(this))}},_removeLt:function(a){var b=this._lts[a];if(b&&b._info&&b.data){this._stopLoadingLt(a);var c=b.data.l,e,l,d;for(e in c)for(d in c="imgs"+e,l=b[c],l)c=l[d],(g=c[5])&&g.remove();delete this._lts[a]}},_loadLtI:function(a,b,c){var e=this,l=e._getTileName(a,b,c),d=e._lts[l]=e._lts[l]||{};d._info=[a,b,c];""!==d.data&&(d.loading=!0,a=e._getTileUrl(a,b,c,{d:"i",i:G.Browser.retina?
"@2x":""}),b={},e.options.crossOrigin&&(b.crossOrigin=e.options.crossOrigin),b={responseType:"http"===a.slice(0,4).toLowerCase()?"JSONP":"JSON",header:b,success:function(a,b){d.data=b;e._processLt(l)},error:function(a){404==a.status&&(d.data="")},complete:function(){delete d.ri;d.loading=!1}},e.options.crossOrigin&&(b.responseType="JSON"),a=G.Util.ajax(a,b),d.ri=a)},_processLt:function(a){var b=this._lts[a],c=b.data;if(c){var e=c.l,l=c.b,d=c.i,c=c.bb,m=this.options.icons||"",p,k,q,s,t,n,r,f,u;for(p in e){if(l&&
p in l)for(r=l[p],f=0,u=r.length;f<u;f++)n=r[f],e=n[0],k=n[1],q=n[2],s=n[3],t=n[4],n=n[5],0!=n&&c&&(t=c.slice(t,t+n),t="data:image/png;base64,"+t,n="b"+f,b["imgs"+p]=b["imgs"+p]||{},b["imgs"+p][n]=[t,e,k,q,s]);if(d&&p in d)for(r=d[p],f=0,u=r.length;f<u;f++)t=r[f],e=t[0],k=t[1],q=t[2],s=t[3],t=t[4],t=m+t,n="i"+f,b["imgs"+p]=b["imgs"+p]||{},b["imgs"+p][n]=[t,e,k,q,s]}this._checkDirtyTiles();this._placeLt(a)}},_stopLoadingLt:function(a){a=this._lts[a];var b=G.Util.ajaxCancel;a&&(b(a.ri),a.loading=!1)},
_onIconLoad:function(){this._dirtyIcons=!0},_clearGrids:function(){this._g={}},_hitGrids:function(a,b,c,e){for(var l=a;l<=c;l++)for(var d=b;d<=e;d++)if(a=l+","+d,this._g[a])return!0;return!1},_markGrids:function(a,b,c,e){for(var l=a;l<=c;l++)for(var d=b;d<=e;d++)a=l+","+d,this._g[a]=!0}});
G.Layer.Html=G.Layer.Html.extend({_placeHtml:function(a){G.Browser.getPxRatio();var b=G.DomUtil,c=this._map.toScreen(a.geom,this._aroundScreen,this._zoomScale||this._scale),e=c[0],c=c[1];this._hidden?b.hide(a):b.show(a);b.markPosTransform(a,e,c);b.updateTransform(a)},_onZoom:function(){this._zooming&&(this._tempScale==this._latestTempScale?this._erase():this._latestTempScale=this._tempScale)},_onRotate:function(){this._draw()},_onPinch:function(){this._draw()}});
G.Layer.VectorCache=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{cluster:[]},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a;this.options=G.Util.merge({},this.options,b);this._vts={};this._visVtKeys=[];this._vIds={}},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);
a._isLoaded()&&(a=this._calcVisTileInfos(),this._addVts(a))},_addVts:function(a){if(0!==a.length){var b,c,e=[],l,d,m,p;b=0;for(c=a.length;b<c;b++)l=a[b],d=l[0],m=l[1],p=l[2],l=this._getTileName(d,m,p),e.push(l),l in this._vts?(d=this._vts[l],d.data&&this._processVt(l)):this._loadVt(d,m,p);b=0;for(c=this._visVtKeys.length;b<c;b++)l=this._visVtKeys[b],0>e.indexOf(l)&&this._removeVt(l);this._visVtKeys=e}},_removeVt:function(a){this._vts[a]&&this._stopLoadingVt(a)},_loadVt:function(a,b,c){var e=this,
l=e._getTileName(a,b,c),d=e._vts[l]=e._vts[l]||{};d._info=[a,b,c];""!==d.data&&(d.loading=!0,a=e._getTileUrl(a,b,c,{d:"f"}),b={responseType:"http"===a.slice(0,4).toLowerCase()?"JSONP":"JSON",success:function(a,b){d.data=b;e._processVt(l)},error:function(a){404==a.status&&(d.data="")},complete:function(){delete d.req;d.loading=!1}},a=G.Util.ajax(a,b),d.req=a)},_processVt:function(a){for(var b=this._map,c=this._vts[a].data,e=c.v,c=c.s,l,d,m,p,k,q=G.Util.colorHex,s=0,t=e.length;s<t;s++)l=e[s],d=l.id,
m=l.g,p=l.gt,l=l.st,l=c[l],(k=this._vIds[d])?k._updateGeom(m):"pt"===p?k=new G.Graphic.Point(m):"pl"===p?k=new G.Graphic.Polyline(m):"pg"===p&&(k=new G.Graphic.Polygon(m)),k&&(m=k.options,"pt"!==p&&"pl"===p&&(p=l.line_color,m.lineWidth=l.line_width,m.lineColor=q(p[0],p[1],p[2])),k&&(k.addTo(this),k._vtKeys=k._vtKeys||{},k._vtKeys[a]=!0,this._vIds[d]=k));b._requestRedraw()},_stopLoadingVt:function(a){a=this._vts[a];var b=G.Util.ajaxCancel;a&&(b(a.req),a.loading=!1)}});
G.Layer.FeatureService=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{mode:"all",vacuumCount:1E3},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.options=G.Util.merge({},this.options,b);this._reqFunc=a;this._loadingKeys={}},onSuccess:function(a){"tile"==this.options.mode?this.fireEvent("loadTileSuccess",{extent:a}):this.fireEvent("loadAllSuccess")},onError:function(a){"tile"==this.options.mode?this.fireEvent("loadTileError",{extent:a}):this.fireEvent("loadAllError")},onComplete:function(a){if("tile"==
this.options.mode){var b=a.join(",");delete this._loadingKeys[b];this.fireEvent("loadTileComplete",{extent:a})}else this.fireEvent("loadAllComplete")},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);a._isLoaded()&&("tile"==this.options.mode?(this.count()>this.options.vacuumCount&&this._vacuum(),a=this._calcVisTileInfos(),this._addFts(a)):this._loadAll())},_addFts:function(a){if(0!==a.length){var b,c,e,l,d,m=this._loadingKeys,p={};b=0;for(c=a.length;b<c;b++)l=a[b],e=
l[0],d=l[1],l=l[2],d=this._calcTileExtent(e,d,l),e=d.join(","),p[e]=d;for(e in m)p[e]||(a=m[e],G.Util.ajaxCancel(a),delete m[e]);for(e in p)d=p[e],this._loadFt(d)}},_loadFt:function(a){var b=a.join(","),c=this._reqFunc;b in this._loadingKeys||!c||(c=c.call(this,a),this._loadingKeys[b]=c,this.fireEvent("loadTileStart",{extent:a}))},_loadAll:function(){var a=this._reqFunc;"all"in this._loadingKeys||!a||(a=a.call(this),this._loadingKeys.all=a,this.fireEvent("loadAllStart"))}});
G.Layer.GeoHeyFeature=G.Layer.FeatureService.extend({options:{apiKey:"",where:"1=1",outFields:"",limit:1E3},init:function(a,b){var c=this;G.Layer.FeatureService.prototype.init.call(c,function(b){var l=a+"/query",d=c.options,m={ak:d.apiKey,where:d.where,outFields:d.outFields,limit:d.limit};b&&(m.geometry=JSON.stringify(b));m={responseType:"http"===l.slice(0,4).toLowerCase()?"JSONP":"JSON",data:m,success:function(a,k){var l=k.data,m=l.geometryType;if(l=l.features){var t;t=l.length-1;for(var n=Math.max(0,
t-d.limit),r,f,u,v=[],K,C,L;t>=n;t--){r=l[t];f=r.id;u=r.geom;r=r.attrs||{};if("Point"==m)v.push(new G.Graphic.Point(u,r));else if("Polyline"==m)v.push(new G.Graphic.Polyline(u,r));else if("Polygon"==m)v.push(new G.Graphic.Polygon(u,r));else if("MultiPoint"==m)for(K in u.m)C=u.m[K],v.push(new G.Graphic.Point(C,r));else if("MultiPolyline"==m)for(K in u.m)C=u.m[K],v.push(new G.Graphic.Polyline(C,r));else if("MultiPolygon"==m)for(K in u.m)C=u.m[K],v.push(new G.Graphic.Polygon(C,r));for(L in v)if(r=v[L])u=
f+"_"+L,c.get(u)||r.addTo(c,u)}}c.onSuccess(b)},error:function(){c.onError(b)},complete:function(){c.onComplete(b)}};G.Util.ajax(l,m)},b)}});
G.Layer.GeoHeyProgressiveFeature=G.Layer.Graphic.extend({options:{stepFactor:4,stepCount:4,tolerance:8,outFields:"[]"},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a},onSuccess:function(a){this.fireEvent("extentSuccess",{extent:a})},onError:function(a){this.fireEvent("extentError",{extent:a})},onComplete:function(a){this.fireEvent("extentComplete",{extent:a})},_update:function(){var a=this._map,b=this._loadRes=a._res,c=this._loadExtent=a.getExtent(),e=this._loadedStatus;
if(!e||b!=e[0]||!G.ExtentUtil.equals(c,e[1]))if(G.Layer.Graphic.prototype._update.call(this),a._isLoaded()){(a=this._req)&&G.Util.ajaxCancel(a);var l,b=this._graphics;for(l in b)a=b[l],a._dirty=!0;this._loadStep(1)}},_loadStep:function(a){var b=this,c=b.options,e=b._loadRes,l=b._loadExtent,d=c.tolerance*Math.pow(c.stepFactor,c.stepCount-a),m=b.url+"/filter",c={responseType:"JSON",data:{extent:JSON.stringify(l),excludeExtents:JSON.stringify([]),res:e,cellPixel:d,outFields:c.outFields},success:function(c,
d){b._processResult(a,d)},complete:function(){b._req=null}};b._req=G.Util.ajax(m,c)},_processResult:function(a,b){var c=this.options,e=this._loadRes,l=this._loadExtent,d=c.tolerance*Math.pow(c.stepFactor,c.stepCount-a),d=e*d,m=b.geometryType,p=b.features;if(p){var k,q,s,t,n,r;for(k=p.length-1;0<=k;k--)if(q=p[k],s=q.id,t=q.geom,q=q.attrs||{},"Point"==m)r=new G.Graphic.Point(t,q),this._updateGraphic(d,s,0,r);else if("Polyline"==m)r=new G.Graphic.Polyline(t,q),this._updateGraphic(d,s,0,r);else if("Polygon"==
m)r=new G.Graphic.Polygon(t,q),this._updateGraphic(d,s,0,r);else if("MultiPoint"==m)for(n in t.multi)r=t.multi[n],r=new G.Graphic.Point(r,q),this._updateGraphic(d,s,n,r);else if("MultiPolyline"==m)for(n in t.multi)r=t.multi[n],r=new G.Graphic.Polyline(r,q),this._updateGraphic(d,s,n,r);else if("MultiPolygon"==m)for(n in t.multi)r=t.multi[n],r=new G.Graphic.Polygon(r,q),this._updateGraphic(d,s,n,r);a<c.stepCount?this._loadStep(a+1):(this._clearDirty(),this._loadedStatus=[e,l],this.onSuccess(l),this.onComplete(l))}else this.onError(l),
this.onComplete(l)},_updateGraphic:function(a,b,c,e){b+=c?"_"+c:"";(c=this.get(b))?(a<c._res&&(c.updateGeom(e.geom,!0),c._res=a),c._dirty=!1):(e._res=a,e.addTo(this,b))},_clearDirty:function(){var a=this._graphics,b,c;for(c in a)b=a[c],b._dirty&&b.remove()}});
G.Layer.TiledService=G.Layer.extend({mixins:[G.Layer.LOD],init:function(a,b){this.options=G.Util.merge({},this.options,b);this._reqFunc=a;this._loadingKeys={};this._loadedKeys={}},onSuccess:function(a,b){var c=parseInt(a[0]),e=parseInt(a[1]),l=parseInt(a[2]),c=this._getTileName(c,e,l);this._loadedKeys[c]=a;this.fireEvent("loadTileSuccess",{tileInfo:a,data:b})},onError:function(a){this.fireEvent("loadTileError",{tileInfo:a})},onComplete:function(a){var b=parseInt(a[0]),c=parseInt(a[1]),e=parseInt(a[2]),
b=this._getTileName(b,c,e);delete this._loadingKeys[b];this.fireEvent("loadTileComplete",{tileInfo:a})},_update:function(){if(this._map._isLoaded()){var a,b,c,e,l,d,m=this._calcVisTileInfos(),p={};a=0;for(b=m.length;a<b;a++)e=m[a],c=e[0],l=e[1],d=e[2],c=this._getTileName(c,l,d),p[c]=e;this._addTiles(p);for(c in this._loadedKeys)p[c]||(e=this._loadedKeys[c],delete this._loadedKeys[c],this.fireEvent("unusedTile",{tileInfo:e}))}},_addTiles:function(a){var b,c,e=this._loadingKeys;for(b in e)a[b]||(c=
e[b],G.Util.ajaxCancel(c),delete e[b]);for(b in a)c=a[b],this._loadTile(c)},_loadTile:function(a){var b=this._reqFunc,c=parseInt(a[0]),e=parseInt(a[1]),l=parseInt(a[2]),d=this._getTileName(c,e,l);d in this._loadingKeys||d in this._loadedKeys||!b||(b=b.call(this,c,e,l),this._loadingKeys[d]=b,this.fireEvent("loadTileStart",{tileInfo:a}))}});
G.Graphic.Point=G.Graphic.Point.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;b.deleteBuffer(this._gl_line_vb);this._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.options.shape,b=this.geom;if(b){var c=b[0],b=b[1],e=[],l=[];if("rect"==a)this._pushVertex(e,c,b,0),this._pushVertex(e,
c,b,1),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,1),this._pushVertex(l,c,b,1),this._pushVertex(l,c,b,2),this._pushVertex(l,c,b,3),this._pushVertex(l,c,b,4),this._pushVertex(l,c,b,1);else if("image"==a)this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,1),this._pushVertex(e,c,b,2),this._pushVertex(e,
c,b,0),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,1);else if("text"==a)this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,1),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,0),this._pushVertex(e,
c,b,4),this._pushVertex(e,c,b,1);else{for(a=0;50>a;a++)this._pushVertex(e,c,b,-1),this._pushVertex(e,c,b,a/50),this._pushVertex(e,c,b,(a+1)/50),this._pushVertex(l,c,b,a/50);this._pushVertex(l,c,b,0)}this._gl_fill_vs=new Float32Array(e);this._gl_fill_vcount=e.length/3;this._gl_line_vs=new Float32Array(l);this._gl_line_vcount=l.length/3}},_pushVertex:function(a,b,c,e){a.push(b);a.push(c);a.push(e)},_draw:function(){for(var a=this.options,b=this._layer._map,c=a.shape,e=a.size,l=a.offset,d=a.fillColor,
m=a.fillOpacity,p=a.gradual,k=b._calcWrapPointRange(this.geom)||[0,0],q=b.options.maxExtent,q=q[2]-q[0],s=k[0];s<=k[1];s++){var t=[s*q,0];if(a.fill)if("rect"==c)G.GLDrawUtil.drawShapeFill(this,t,"rect",e,l,G.Util.colorRgb(d),null,null,m,p);else if("image"==c){var n=G.Browser.getImageSrc(a.image),n=G.DomUtil.getImgElement(n,function(){b._requestRedraw()});if(n._loaded){var r=a.imageRotate;a.imageGravity||(r+=b._rotate);G.GLDrawUtil.drawShapeImage(this,t,n,e,l,r)}}else"text"==c?G.GLDrawUtil.drawShapeText(this,
t,a.text,e,l,d,m,a.textFont,a.textStyle,a.textAlign):G.GLDrawUtil.drawShapeFill(this,t,"circle",e,l,G.Util.colorRgb(d),null,null,m,p);if(a.outline||this._mouseOver||this._editing){var n=this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor,r=this._mouseOver?a.outlineWidth+a.lineHighlightWiden:a.outlineWidth,f=a.outlineOpacity,u=a.outlineDashArray;"rect"==c?G.GLDrawUtil.drawShapeLine(this,t,"rect",e,l,G.Util.colorRgb(n),f,r,null,null,u):"image"!=c&&"text"!=c&&G.GLDrawUtil.drawShapeLine(this,
t,"circle",e,l,G.Util.colorRgb(n),f,r,null,null,u)}}},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.addListener(b.DOWN[c],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.removeListener(b.DOWN[c],this._onVertexDragStart,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil,c=a._handlers.Drag;!c||(c._dragging||this.options.allowPan)||
c.off();a._requestRedraw();this._isVertex?b.addClass(a._layersFrame,"g-edit"):b.addClass(a._layersFrame,"g-clickable")}},_onMouseOut:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil,c=a._handlers.Drag;if(c&&!c._dragging)c.on();a._requestRedraw();this._isVertex?b.removeClass(a._layersFrame,"g-edit"):b.removeClass(a._layersFrame,"g-clickable")}}});
G.Graphic.Polyline=G.Graphic.Polyline.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map;a._gl.deleteBuffer(this._gl_line_vb);this._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.geom;if(a&&!(2>a.length)){var b=[],c,e,l;c=0;for(e=a.length;c<e;c++)l=a[c],b.push(l[0]),b.push(l[1]);this._gl_line_vs=new Float32Array(b);this._gl_line_vcount=a.length}},
_draw:function(){for(var a=this.options,b=this._layer._map,c=G.Util.colorRgb(this._editing?a.lineHighlightColor:a.lineColor),e=a.lineOpacity,l=this._mouseOver?a.lineWidth+a.lineHighlightWiden:a.lineWidth,d=a.lineCap,m=a.lineJoin,a=a.lineDashArray,p=this.bbox,p=b._calcWrapPointRange([(p[0]+p[2])/2,(p[1]+p[3])/2])||[0,0],b=b.options.maxExtent,b=b[2]-b[0],k=p[0];k<=p[1];k++)G.GLDrawUtil.drawLine(this,[k*b,0],c,e,l,d,m,a)},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],
this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,e;for(c in b.DOWN)e=b.DOWN[c],a.removeListener(e,this._onVertexDragStart,this),a.removeListener(b.MOVE[e],this._onVertexDrag,this),a.removeListener(b.UP[e],this._onVertexDragEnd,this);this._removeVertexes();G.DomUtil.removeClass(a._layersFrame,"g-edit");a._requestRedraw()},_onMouseOver:function(){var a=this._layer._map,b=a._handlers.Drag;!b||(b._dragging||this.options.allowPan)||
b.off();a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Polygon=G.Graphic.Polygon.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;var c=this._fakeLineGraphics||[],e,l,d;e=0;for(l=c.length;e<l;e++)d=c[e],b.deleteBuffer(d._gl_line_vb),d._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.geom;if(a){var b,c,e,l,d,m,p,k;d=a[0];b=[];p=
null;e=0;for(l=d.length;e<l;e++)if(m=d[e],!p||p[0]!=m[0]||p[1]!=m[1])if(e!=l-1||m[0]!=d[0][0]||m[1]!=d[0][1])b.push(new poly2tri.Point(m[0],m[1])),p=m;var q=new poly2tri.SweepContext(b);b=1;for(c=a.length;b<c;b++){d=a[b];k=[];p=null;e=0;for(l=d.length;e<l;e++)if(m=d[e],!p||p[0]!=m[0]||p[1]!=m[1])if(e!=l-1||m[0]!=d[0][0]||m[1]!=d[0][1])k.push(new poly2tri.Point(m[0],m[1])),p=m;q.addHole(k)}try{q.triangulate()}catch(s){}l=q.getTriangles();d=[];b=0;for(c=l.length;b<c;b++)for(m=l[b],e=0;3>e;e++)p=m.getPoint(e),
d.push(p.x),d.push(p.y);this._gl_fill_vs=new Float32Array(d);this._gl_fill_vcount=d.length/2;p=this._fakeLineGraphics=[];b=0;for(c=a.length;b<c;b++){d=a[b];k={};q=[];e=0;for(l=d.length;e<l;e++)m=d[e],q.push(m[0]),q.push(m[1]);m=d[0];q.push(m[0]);q.push(m[1]);k._gl_line_vs=new Float32Array(q);k._gl_line_vcount=q.length/2;p.push(k)}}},_draw:function(){for(var a=this.options,b=this._layer,c=b._map,e=this.bbox,e=c._calcWrapPointRange([(e[0]+e[2])/2,(e[1]+e[3])/2])||[0,0],l=c.options.maxExtent,l=l[2]-
l[0],d=e[0];d<=e[1];d++){var m=[d*l,0];if(a.fill)if(a.fillImage){var p=G.Browser.getImageSrc(a.fillImage),p=G.DomUtil.getImgElement(p,function(){c._requestRedraw()},null,"*");p._loaded&&G.GLDrawUtil.drawFill(this,m,null,p,a.fillImageSize,a.fillOpacity)}else G.GLDrawUtil.drawFill(this,m,G.Util.colorRgb(a.fillColor),null,null,a.fillOpacity);if(a.outline||this._mouseOver||this._editing){var p=this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor,k=a.outlineCap,q=a.outlineJoin,s=(a.outline?
a.outlineWidth:0)+(this._mouseOver?a.lineHighlightWiden:0),t=a.outlineOpacity,n=a.outlineDashArray,r=this._fakeLineGraphics,f,u,v;f=0;for(u=r.length;f<u;f++)v=r[f],v._layer=b,G.GLDrawUtil.drawLine(v,m,G.Util.colorRgb(p),t,s,k,q,n)}}},_drawMask:function(){var a=this._map,b=a._maskCtx,c=this.geom,e,l,d,m=a._canvasOffset,p=this.bbox,p=a._calcWrapPointRange([(p[0]+p[2])/2,(p[1]+p[3])/2])||[0,0];e=a.options.maxExtent;for(var k=e[2]-e[0],q=p[0];q<=p[1];q++){var s=[q*k,0];b.beginPath();for(var t=0,n=c.length;t<
n;t++){l=c[t];for(var r=0,f=l.length;r<f;r++)d=l[r],d=a.toScreen([d[0]+s[0],d[1]]),e=0===r?"moveTo":"lineTo",b[e](d[0]+m[0],d[1]+m[1]);d=l[0];d=a.toScreen([d[0]+s[0],d[1]]);b.lineTo(d[0]+m[0],d[1]+m[1])}b.fill()}},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,e;for(c in b.DOWN)e=b.DOWN[c],a.removeListener(e,this._onVertexDragStart,
this),a.removeListener(b.MOVE[e],this._onVertexDrag,this),a.removeListener(b.UP[e],this._onVertexDragEnd,this);this._removeVertexes();G.DomUtil.removeClass(a._layersFrame,"g-edit");a._requestRedraw()},_onMouseOver:function(){var a=this._layer._map,b=a._handlers.Drag;!b||(b._dragging||this.options.allowPan)||b.off();a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,
"g-clickable")}});
G.Graphic.Circle=G.Graphic.Circle.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;b.deleteBuffer(this._gl_line_vb);this._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.geom;if(a){var b=a[0],a=a[1],c=[],e=[],l;for(l=0;48>l;l++)c.push(b),c.push(a),c.push(-1),c.push(b),c.push(a),c.push(l/
48),c.push(b),c.push(a),c.push((l+1)/48),e.push(b),e.push(a),e.push(l/48);e.push(b);e.push(a);e.push(0);this._gl_fill_vs=new Float32Array(c);this._gl_fill_vcount=c.length/3;this._gl_line_vs=new Float32Array(e);this._gl_line_vcount=e.length/3}},_draw:function(){var a=this.options,b=this._layer._map,c=2*(this.geom[2]/b._res);if(c)for(var e=b._calcWrapPointRange(this.geom)||[0,0],l=b.options.maxExtent,l=l[2]-l[0],d=e[0];d<=e[1];d++){var m=[d*l,0];if(a.fill)if(a.fillImage){var p=G.Browser.getImageSrc(a.fillImage),
p=G.DomUtil.getImgElement(p,function(){b._requestRedraw()},null,"*");p._loaded&&G.GLDrawUtil.drawShapeFill(this,m,"circle",[c,0],[0,0],null,p,a.fillImageSize,a.fillOpacity)}else G.GLDrawUtil.drawShapeFill(this,m,"circle",[c,0],[0,0],G.Util.colorRgb(a.fillColor),null,null,a.fillOpacity,a.gradual);if(a.outline||this._mouseOver){var p=this._mouseOver?a.outlineWidth+a.lineHighlightWiden:a.outlineWidth,k=a.outlineOpacity,q=a.outlineDashArray;G.GLDrawUtil.drawShapeLine(this,m,"circle",[c,0],[0,0],G.Util.colorRgb(this._editing?
a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor),k,p,null,null,q)}}},_drawMask:function(){for(var a=this._map,b=a._maskCtx,c=this.geom,e=c[0],l=c[1],d=c[2]/a._res,m=a._canvasOffset,c=a._calcWrapPointRange(c)||[0,0],p=a.options.maxExtent,p=p[2]-p[0],k=c[0];k<=c[1];k++){var q=a.toScreen([e+k*p,l]);q[0]+=m[0];q[1]+=m[1];b.beginPath();b.arc(q[0],q[1],d,0,2*Math.PI,!1);b.fill()}},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.addListener(b.DOWN[c],this._onVertexDragStart,
this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.removeListener(b.DOWN[c],this._onVertexDragStart,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map,b=a._handlers.Drag;!b||(b._dragging||this.options.allowPan)||b.off();a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,
"g-clickable")}});
G.Graphic.Arrow=G.Graphic.Arrow.extend({_onAdded:function(){var a=this._layer._map;this._resGl=null;a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;var c=this._fakeLineGraphics||[],e,l,d;e=0;for(l=c.length;e<l;e++)d=c[e],b.deleteBuffer(d._gl_line_vb),d._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._resGl=this._resDraw=null;var a=this._layer;a&&(a=a._map)&&(this._updateGeomDraw(a._res),this._ensureGl())},
_ensureGl:function(){var a=this._layer;if(a&&(a=a._map)&&this._resGl!=a._res){var b=this._geomDraw;if(b){var c,e,l,d,m,p,k,q;m=b[0];c=[];k=null;l=0;for(d=m.length;l<d;l++)if(p=m[l],!k||k[0]!=p[0]||k[1]!=p[1])if(l!=d-1||p[0]!=m[0][0]||p[1]!=m[0][1])c.push(new poly2tri.Point(p[0],p[1])),k=p;var s=new poly2tri.SweepContext(c);c=1;for(e=b.length;c<e;c++){m=b[c];q=[];k=null;l=0;for(d=m.length;l<d;l++)if(p=m[l],!k||k[0]!=p[0]||k[1]!=p[1])if(l!=d-1||p[0]!=m[0][0]||p[1]!=m[0][1])q.push(new poly2tri.Point(p[0],
p[1])),k=p;s.addHole(q)}try{s.triangulate()}catch(t){}d=s.getTriangles();m=[];c=0;for(e=d.length;c<e;c++)for(p=d[c],l=0;3>l;l++)k=p.getPoint(l),m.push(k.x),m.push(k.y);this._gl_fill_vs=new Float32Array(m);this._gl_fill_vcount=m.length/2;k=this._fakeLineGraphics=[];c=0;for(e=b.length;c<e;c++){m=b[c];q={};s=[];l=0;for(d=m.length;l<d;l++)p=m[l],s.push(p[0]),s.push(p[1]);p=m[0];s.push(p[0]);s.push(p[1]);q._gl_line_vs=new Float32Array(s);q._gl_line_vcount=s.length/2;k.push(q)}this._resGl=a._res}}},_draw:function(){var a=
this.options,b=this._layer,c=b._map;this._updateGeomDraw(c._res);this._ensureGl();if(this._geomDraw&&this._fakeLineGraphics)for(var e=this.bbox,e=c._calcWrapPointRange([(e[0]+e[2])/2,(e[1]+e[3])/2])||[0,0],l=c.options.maxExtent,l=l[2]-l[0],d=e[0];d<=e[1];d++){var m=[d*l,0];if(a.fill)if(a.fillImage){var p=G.Browser.getImageSrc(a.fillImage),p=G.DomUtil.getImgElement(p,function(){c._requestRedraw()},null,"*");p._loaded&&G.GLDrawUtil.drawFill(this,m,null,p,a.fillImageSize,a.fillOpacity)}else G.GLDrawUtil.drawFill(this,
m,G.Util.colorRgb(a.fillColor),null,null,a.fillOpacity);if(a.outline||this._mouseOver||this._editing){var p=this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor,k=a.outlineCap,q=a.outlineJoin,s=(a.outline?a.outlineWidth:0)+(this._mouseOver?a.lineHighlightWiden:0),t=a.outlineOpacity,n=a.outlineDashArray,r=this._fakeLineGraphics,f,u,v;f=0;for(u=r.length;f<u;f++)v=r[f],v._layer=b,G.GLDrawUtil.drawLine(v,m,G.Util.colorRgb(p),t,s,k,q,n)}}},_drawMask:function(){var a=this._map,b=a._maskCtx;
this._updateGeomDraw(a._res);var c=this._geomDraw,e,l,d,m=a._canvasOffset,p=this.bbox,p=a._calcWrapPointRange([(p[0]+p[2])/2,(p[1]+p[3])/2])||[0,0];e=a.options.maxExtent;for(var k=e[2]-e[0],q=p[0];q<=p[1];q++){var s=[q*k,0];b.beginPath();for(var t=0,n=c.length;t<n;t++){l=c[t];for(var r=0,f=l.length;r<f;r++)d=l[r],d=a.toScreen([d[0]+s[0],d[1]]),e=0===r?"moveTo":"lineTo",b[e](d[0]+m[0],d[1]+m[1]);d=l[0];d=a.toScreen([d[0]+s[0],d[1]]);b.lineTo(d[0]+m[0],d[1]+m[1])}b.fill()}},_onStartEdit:function(){var a=
this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,e;for(c in b.DOWN)e=b.DOWN[c],a.removeListener(e,this._onVertexDragStart,this),a.removeListener(b.MOVE[e],this._onVertexDrag,this),a.removeListener(b.UP[e],this._onVertexDragEnd,this);this._removeVertexes();G.DomUtil.removeClass(a._layersFrame,"g-edit");a._requestRedraw()},_onMouseOver:function(){var a=
this._layer._map,b=a._handlers.Drag;!b||(b._dragging||this.options.allowPan)||b.off();a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Group=G.Graphic.Group.extend({_onMouseOver:function(){var a=this._layer._map,b=a._handlers.Drag;!b||(b._dragging||this.options.allowPan)||b.off();a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Map=G.Map.extend({print:function(a,b){var c=G.DomUtil,e=G.Browser.getCanvasRatio(),l=this.getSize(),d=l[0],m=l[1],l=a||d,p=b||m,d=Math.max(l/d,p/m),m=this._gl.canvas,k=m.width/e[0],e=m.height/e[1],c=c.create("canvas");c.width=l;c.height=p;c.getContext("2d").drawImage(m,(l-k*d)/2,(p-e*d)/2,k*d,e*d);return c.toDataURL()},_initAddition:function(){var a=G.DomUtil,b=["webgl","experimental-webgl"],c,e;c=0;for(e=b.length;c<e&&!this._gl;c++)gl=this._gl=a.create("canvas").getContext(b[c],{alpha:!1,preserveDrawingBuffer:!0});
this._textureCtx=a.create("canvas").getContext("2d");this._initGL();this._onScreenCtx=a.create("canvas","g-layer",this._layersFrame).getContext("2d");this._snapshotCtx=a.create("canvas").getContext("2d");this._maskCtx=a.create("canvas").getContext("2d");this._mode="webgl"},_initGL:function(){var a=this._gl;if(a){var b=G.GLShaderUtil,c=b.compile(a,a.VERTEX_SHADER,b.TILE_VS),e=b.compile(a,a.FRAGMENT_SHADER,b.TILE_FS);a.tileProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.PT_VS);e=b.compile(a,
a.FRAGMENT_SHADER,b.PT_FS);a.ptProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.LINE_VS);e=b.compile(a,a.FRAGMENT_SHADER,b.LINE_FS);a.lineProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.FILL_VS);e=b.compile(a,a.FRAGMENT_SHADER,b.FILL_FS);a.fillProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.SHAPE_FILL_VS);e=b.compile(a,a.FRAGMENT_SHADER,b.SHAPE_FILL_FS);a.shapeFillProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.SHAPE_LINE_VS);e=b.compile(a,a.FRAGMENT_SHADER,
b.SHAPE_LINE_FS);a.shapeLineProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.SHAPE_IMAGE_VS);e=b.compile(a,a.FRAGMENT_SHADER,b.SHAPE_IMAGE_FS);a.shapeImageProgram=b.genProgram(a,c,e);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.flush()}},_redrawSnapshot:function(a,b,c){var e=G.Browser.getCanvasRatio(),l=this._onScreenCtx.canvas,d=l.width/(e[0]||1),e=l.height/(e[1]||1),l=G.Browser.getPxRatio(),m=l[0],p=
l[1],k=this._center,q=this._rotate,s=this._res,l=q-b,t=s/c,n=this._onScreenCtx,r,f;r=-d/2;f=-e/2;b&&(b=G.MathUtil.rotateVector([r,f],-b),r=b[0],f=b[1]);b=r*c*m+a[0];a=-f*c*p+a[1];r=(b-k[0])/s/m;f=-(a-k[1])/s/p;q&&(b=G.MathUtil.rotateVector([r,f],q),r=b[0],f=b[1]);a=d/2+r;c=e/2+f;this._clearCanvas(n);n.save();n.translate(a,c);n.rotate(l/G.MathUtil.DEGREE_PER_RADIAN);n.drawImage(this._snapshotCtx.canvas,0,0,d/t,e/t);n.restore()},_redraw:function(){var a=this._gl;if(a){var b=this._zoomAnim,c=this._rotateAnim,
e=this._handlers.Pinch;if(!this.options.canvasAnimRedraw&&b&&b._playing)this._redrawSnapshot(b._startCenter,this._rotate,b._startRes);else if(!this.options.canvasAnimRedraw&&c&&c._playing)this._redrawSnapshot(this._center,c._startRotate,this._res);else if(!this.options.canvasAnimRedraw&&e&&e._pinching)this._redrawSnapshot(e._startCenter,e._startRotate,e._startRes);else{this._clearGlCanvas();for(var l in this._layerOrder)b=this._layerOrder[l],b=this._layers[b],b.isVisible()&&b._draw();a.flush();a=
G.Browser.getCanvasRatio();l=this._onScreenCtx.canvas;w=l.width/(a[0]||1);h=l.height/(a[1]||1);try{this._clearCanvas(this._onScreenCtx),this._onScreenCtx.drawImage(this._gl.canvas,0,0,w,h)}catch(d){}try{this._onScreenCtx.drawImage(this._maskCtx.canvas,0,0)}catch(m){}this._drawMask()}}},_update:function(){var a=this._gl;if(a){this._clearGlCanvas();var b,c;for(c in this._layers)b=this._layers[c],b.isVisible()&&b._update();a.flush();a=G.Browser.getCanvasRatio();b=this._onScreenCtx.canvas;w=b.width/(a[0]||
1);h=b.height/(a[1]||1);try{this._clearCanvas(this._onScreenCtx),this._onScreenCtx.drawImage(this._gl.canvas,0,0,w,h)}catch(e){}this._drawMask();try{this._onScreenCtx.drawImage(this._maskCtx.canvas,0,0)}catch(l){}}},_drawMask:function(){var a=this._maskCtx,b=this.options,c,e=this._masks;if(e){var l=e.length;if(b.mask&&(this._clearCanvas(this._maskCtx),0!=l)){a.save();a.globalCompositeOperation="source-over";a.fillStyle=b.maskColor;a.globalAlpha=b.maskOpacity;a.fillRect(0,0,a.canvas.width,a.canvas.height);
a.globalCompositeOperation="destination-out";a.globalAlpha=1;for(b=0;b<l;b++)c=e[b],c._drawMask&&c._drawMask();a.restore()}}},_onResize:function(){this._resizeCanvases();this._updateDrawSize();this._requestUpdate()},_clearCanvas:function(a){a.clearRect(0,0,a.canvas.width,a.canvas.height)},_clearGlCanvas:function(){var a=this._gl,b=G.Util.colorRgb(this.options.glColor);a.clearColor(b[0]/255,b[1]/255,b[2]/255,1);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},_resizeCanvas:function(a,b,c,e){var l=a.canvas,
d=e?e[0]||1:1;e=e?e[1]||1:1;var m=this.options.canvasExpandFactor,p=b*m,m=c*m;b+=2*p;c+=2*m;G.DomUtil.setPosition(l,-p,-m);1==d&&1==e?(l.width=b,l.height=c,l.style.width="",l.style.height="",a.scale(1,1)):(l.width=b*d,l.height=c*e,l.style.width=b+"px",l.style.height=c+"px",a.scale(d,e))},_resizeGlCanvas:function(){var a=this._gl,b=a.canvas,c=G.Browser.getCanvasRatio(),e=c?c[0]||1:1,c=c?c[1]||1:1,l=this.getSize(),d=l[0],m=l[1],l=d/2,p=m/2,k=this.options.canvasExpandFactor,q=d*k,k=m*k,d=d+2*q,m=m+2*
k;G.DomUtil.setPosition(b,-q,-k);this._canvasOffset=[q,k];var s=this._camera,s=this._camera=new G.GLOrthoCamera(-l-q,l+q,-p-k,p+k,s?s.near:void 0,s?s.far:void 0);s.moveTo(l+q,-p-k,s.far/2);s.lookAt(l+q,-p-k,0);1==e&&1==c?(b.width=d,b.height=m,b.style.width="",b.style.height="",this._canvasScale=[1,1]):(b.width=d*e,b.height=m*c,b.style.width=d+"px",b.style.height=m+"px",this._canvasScale=[e,c]);d=b.width;m=b.height;a.viewport(0,0,d,m)},_resizeCanvases:function(){var a=this.getSize(),b=a[0],a=a[1],
c=G.Browser.getCanvasRatio(),e=this.options.canvasExpandFactor;this._canvasOffset=[b*e,a*e];this._resizeCanvas(this._onScreenCtx,b,a,c);this._resizeCanvas(this._snapshotCtx,b,a,c);this._resizeCanvas(this._maskCtx,b,a,[1,1]);this._resizeGlCanvas()},_onZoomStart:function(a){this._snapshotCanvas()},_onRotateStart:function(a){this._snapshotCanvas()},_onPinchStart:function(a){this._snapshotCanvas()},_snapshotCanvas:function(){if(!this.options.canvasAnimRedraw){var a=this._onScreenCtx.canvas,b=G.Browser.getCanvasRatio(),
c=a.width/(b[0]||1),b=a.height/(b[1]||1);this._clearCanvas(this._snapshotCtx);this._snapshotCtx.drawImage(a,0,0,c,b)}},_calcCanvasOffset:function(){var a=this.getSize(),b=this.getDrawSize();return[(a[0]-b[0])/2,(a[1]-b[1])/2]},_beforeMergeFramePos:function(){var a=G.DomUtil.getPosition(this._mapFrame),b=a[0],a=a[1];try{this._onScreenCtx.drawImage(this._onScreenCtx.canvas,b,a)}catch(c){}}});

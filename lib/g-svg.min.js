G.Layer.Tile=G.Layer.Tile.extend({_initContainer:function(){var b=this._map,a=G.DomUtil,c=this._container=a.create("div","g-layer");this._bg=a.create("div","g-tile-container g-zoom-animated",this._container);this._front=a.create("div","g-tile-container g-zoom-animated",this._container);b._layersFrame.appendChild(this._container);a.setZIndex(c,this._zIndex)},_destroyContainer:function(){this._container.parentNode.removeChild(this._container);delete this._container},_update:function(){var b=this._map;
if(b._isLoaded()){var a=this._zoom=this._calcNearestZoom(!0),c=this._calcVisTileInfos(!0);b.getSize();var e=b.getCenter(),d=this.options,f=d.zoomReses[a],h=d.tileSize,k=b.getDrawSize(),m=k[0],k=k[1],f=[e[0]-m*f/2,e[1]-k*f/2,e[0]+m*f/2,e[1]+k*f/2],b=b.options.maxExtent,p,n,l;this._redrawExtent=f;var f=G.ExtentUtil.intersect(f,b),q;for(q in this._tiles)n=this._tiles[q],b=n._info,p=b[0],m=b[1],l=b[2],k=d.zoomReses[l],l!==a&&(this._stopLoadingTile(n),(!d.keepResample||1>d.opacity)&&this._removeTile(q)),
n=d.originX+p*h*k,p=d.originX+(p+1)*h*k,l=d.originY-(m+1)*h*k,m=d.originY-m*h*k,(m=G.ExtentUtil.overlaps([n,l,p,m],f))||this._tileInfoExist(b,c)||this._removeTile(q);this._placeLoadedTiles(this._bg);this._placeLoadedTiles(this._front);a=this._calcTileIndex(e[0],e[1],a);this._sortTileInfos(c,a[0],a[1]);this._addTiles(c)}},_draw:function(){var b=G.DomUtil;this._map._isLoaded()&&(b.show(this._bg),b.show(this._front),b.setZIndex(this._container,this._zIndex),this._placeLoadedTiles(this._bg),this._placeLoadedTiles(this._front))},
_erase:function(){var b=G.DomUtil;b.hide(this._bg);b.hide(this._front)},_onZoomStart:function(b){var a=this._map,c=a._mapFrame,e=a.getSize(),d=a._rotate,f=this._front,h=this._bg,k=G.DomUtil,m=k.Transition,k=k.Transform;if(!this._zooming){this._zooming=!0;this._prepareBgBuffer();var e=[e[0]/2,e[1]/2],p=b.aroundScreen||e,n=e[0]-p[0],l=e[1]-p[1];d&&(n&&l)&&(d=G.MathUtil.rotateVector([n,l],-d),p=[e[0]-d[0],e[1]-d[1]]);this._aroundScreen=p;a=a._zoomAnim&&a._zoomAnim._params.ignoreAnim;b=G.DomUtil.genScaleStyle(1/
b.scale,p[0],p[1]);f.style[k]=b;h.style[k]=b;a||(f.style[m]=c.style[m],h.style[m]=c.style[m])}},_onZoomUpdate:function(b){var a=this._front,c=this._bg,e=G.DomUtil,d=e.Transform;if(this._zooming){var f=this._aroundScreen;b=e.genScaleStyle(1/b.scale,f[0],f[1]);a.style[d]=b;c.style[d]=b}},_onZoomEnd:function(){var b=this._front,a=this._bg,c=G.DomUtil,e=c.Transition,c=c.Transform;b.parentNode.appendChild(b);b.style[c]="";b.style[e]="";a.style[c]="";a.style[e]="";this._zooming=!1},_clearBgBuffer:function(){var b=
this._map;b&&!b._zooming&&(this._bg.innerHTML="")},_prepareBgBuffer:function(){var b=this._front,a=this._bg;this._stopLoadingTiles(a);this._front=a;this._bg=b},_placeLoadedTiles:function(b){var a=this.options.zoomReses.length,c=this._calcNearestZoom(!0);b=b.getElementsByTagName("img");for(var e,d,f,h,k,m=0,p=b.length;m<p;m++)(e=b[m])&&e.complete&&(d=e._info,f=parseInt(d[0]),h=parseInt(d[1]),d=parseInt(d[2]),k=d==c?a+1:d,this._placeTile(e,f,h,d,k))},_addTiles:function(b){if(0!==b.length){this._numLoad=
b.length;this._numLoadError=this._numLoadSuccess=0;for(var a=document.createDocumentFragment(),c=this.options,e=c.zoomReses.length,d,f,h,k,m,p=this.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE,n=0,l=b.length;n<l;n++){d=b[n];f=d[0];h=d[1];k=d[2];m=this._getTileName(f,h,k);(d=this._tiles[m])?d.src==p?+new Date-d._responseTime>c.tileLiveMs&&this._loadTile(d,f,h,k):this._numLoadSuccess++:(d=this._getIdleTile(),this._tiles[m]=d,this._loadTile(d,f,h,k));if(d.parentNode!==this._front&&(a.appendChild(d),
d._wraps))for(var q in d._wraps)(m=d._wraps[q])&&m.parentNode!==this._front&&a.appendChild(m);this._placeTile(d,f,h,k,e)}this._front.appendChild(a)}},_onNewWrapTile:function(b,a){var c=b._wraps[a];c&&c.parentNode!==this._front&&this._front.appendChild(c)}});
G.Layer.Graphic=G.Layer.Graphic.extend({_initContainer:function(){var b=this._map,a=G.DomUtil,c=this._container=a.create("div","g-layer");this._svg=a.createSVG("svg","g-graphic-container g-zoom-animated",c);this._defs=a.createSVG("defs","",this._svg);b._layersFrame.appendChild(c);a.setZIndex(c,this._zIndex)},_update:function(){this.isVisible()?this._draw():this._erase()},_draw:function(){var b=this._map,a=G.DomUtil,c=this._svg,e=a.getPosition(b._mapFrame),d=b.getSize(),f=b.getDrawSize(),h=f[0],f=
f[1],k=(h-d[0])/2,d=(f-d[1])/2;if(!(b.isZooming()||b.isDragging()||b.isPanning()||b.isRotating())){a.setZIndex(this._container,this._zIndex);a.show(c);c.style[a.Transform]=a.genTranslateStyle(-k,-d);c.setAttribute("width",h);c.setAttribute("height",f);c.setAttribute("viewBox",[-e[0],-e[1],h,f].join(" "));var b=b.getRedrawExtent(),m;for(m in this._graphics)a=this._graphics[m],c=a.bbox,a._layer&&G.ExtentUtil.overlaps(c,b)?a._draw():a._erase()}},_erase:function(){G.DomUtil.hide(this._svg)},_onClear:function(){var b=
this._svg;if(b){for(b.innerHTML="";b.lastChild;)b.removeChild(b.lastChild);this._defs=G.DomUtil.createSVG("defs","",this._svg)}},_onZoomStart:function(b){var a=this._map,c=a._mapFrame,e=a._rotate,d=this._svg,f=G.DomUtil,h=f.Transition,f=f.Transform;if(d){this._zooming||(this._zooming=!0);var k=a.getSize(),m=a.getDrawSize(),p=(m[0]-k[0])/2,m=(m[1]-k[1])/2,k=[k[0]/2,k[1]/2],n=b.aroundScreen||k,l=k[0]-n[0],q=k[1]-n[1];e&&(l&&q)&&(e=G.MathUtil.rotateVector([l,q],-e),n=[k[0]-e[0],k[1]-e[1]]);n=this._aroundScreen=
[n[0]-k[0],n[1]-k[1]];b=G.DomUtil.genScaleStyle(1/b.scale,n[0],n[1],-p,-m);d.style[f]=b;a._zoomAnim&&a._zoomAnim._params.ignoreAnim||(d.style[h]=c.style[h])}},_onZoomUpdate:function(b){var a=this._map,c=a._mapFrame,e=this._svg,d=G.DomUtil,f=d.Transition,d=d.Transform;if(e&&this._zooming){var h=this._aroundScreen,k=a.getSize(),m=a.getDrawSize();b=G.DomUtil.genScaleStyle(1/b.scale,h[0],h[1],-((m[0]-k[0])/2),-((m[1]-k[1])/2));e.style[d]=b;a._zoomAnim&&a._zoomAnim._params.ignoreAnim||(e.style[f]=c.style[f])}},
_onZoomEnd:function(){var b=this._map,a=this._svg,c=G.DomUtil;if(a){var e=b.getSize(),d=b.getDrawSize(),b=(d[0]-e[0])/2,e=(d[1]-e[1])/2;a.style.visibility="";a.parentNode.appendChild(a);a.style[c.Transform]=c.genTranslateStyle(-b,-e);a.style[c.Transition]="";this._zooming=!1}}});
G.Layer.Label=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{icons:"",cluster:[],crossOrigin:"*"},init:function(b,a){G.Layer.Graphic.prototype.init.call(this,a);this.url=b;this.options=G.Util.merge({},this.options,a);this._lts={};this._gx=this._gy=10},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var b=this._map;G.Layer.Graphic.prototype._update.call(this);
if(b._isLoaded()){var a=this._zoom=this._calcNearestZoom(!0),c=b.getCenter();this._clearGrids();b=b._zoomAnim;b&&b._playing||(b=this._calcVisTileInfos(),a=this._calcTileIndex(c[0],c[1],a),this._sortTileInfos(b,a[0],a[1]),this._setLts(b))}},_setLts:function(b){if(b.length){for(var a=[],c,e,d,f,h,k=0,m=b.length;k<m;k++)c=b[k],d=c[0],f=c[1],h=c[2],c=this._getTileName(d,f,h),a.push(c),c in this._lts?(e=this._lts[c],e.loading||e.data||e.ri||this._loadLtI(d,f,h)):this._loadLtI(d,f,h),this._placeLt(c);this._dirtyTileKeys=
this._dirtyTileKeys||[];for(c in this._lts)-1<a.indexOf(c)||(this._stopLoadingLt(c),this._dirtyTileKeys.push(c))}},_checkDirtyTiles:function(){var b=this._dirtyTileKeys,a;if(b&&0<b.length)for(var c=0,e=b.length;c<e;c++)a=b[c],this._removeLt(a);this._dirtyTileKeys=[]},_placeLt:function(b){if((b=this._lts[b])&&b._info&&b.data){var a=b.data.l,c,e,d,f,h,k,m,p,n,l,q,r;for(c in a)for(q in e=a[c],d=Number(e[0]),f=Number(e[1]),e=e[6],d=[d,f],f="imgs"+c,l=b[f],l)f=l[q],h=f[0],k=f[1],m=f[2],p=f[3],n=f[4],r=
f[5],r||(f[5]=r=new G.Graphic.Point(d,null,{shape:"image",size:[k,m],offset:[p,n],image:h,imageGravity:!!e}),r.addTo(this))}},_removeLt:function(b){var a=this._lts[b];if(a&&a._info&&a.data){this._stopLoadingLt(b);var c=a.data.l,e,d,f;for(e in c)for(f in c="imgs"+e,d=a[c],d)c=d[f],(g=c[5])&&g.remove();delete this._lts[b]}},_loadLtI:function(b,a,c){var e=this,d=e._getTileName(b,a,c),f=e._lts[d]=e._lts[d]||{};f._info=[b,a,c];""!==f.data&&(f.loading=!0,b=e._getTileUrl(b,a,c,{d:"i",i:G.Browser.retina?
"@2x":""}),a={},e.options.crossOrigin&&(a.crossOrigin=e.options.crossOrigin),a={responseType:"http"===b.slice(0,4).toLowerCase()?"JSONP":"JSON",header:a,success:function(a,b){f.data=b;e._processLt(d)},error:function(a){404==a.status&&(f.data="")},complete:function(){delete f.ri;f.loading=!1}},e.options.crossOrigin&&(a.responseType="JSON"),b=G.Util.ajax(b,a),f.ri=b)},_processLt:function(b){var a=this._lts[b],c=a.data;if(c){var e=c.l,d=c.b,f=c.i,c=c.bb,h=this.options.icons||"",k,m,p,n,l,q,r,u,s;for(k in e){if(d&&
k in d)for(r=d[k],u=0,s=r.length;u<s;u++)q=r[u],e=q[0],m=q[1],p=q[2],n=q[3],l=q[4],q=q[5],0!=q&&c&&(l=c.slice(l,l+q),l="data:image/png;base64,"+l,q="b"+u,a["imgs"+k]=a["imgs"+k]||{},a["imgs"+k][q]=[l,e,m,p,n]);if(f&&k in f)for(r=f[k],u=0,s=r.length;u<s;u++)l=r[u],e=l[0],m=l[1],p=l[2],n=l[3],l=l[4],l=h+l,q="i"+u,a["imgs"+k]=a["imgs"+k]||{},a["imgs"+k][q]=[l,e,m,p,n]}this._checkDirtyTiles();this._placeLt(b)}},_stopLoadingLt:function(b){b=this._lts[b];var a=G.Util.ajaxCancel;b&&(a(b.ri),b.loading=!1)},
_onIconLoad:function(){this._dirtyIcons=!0},_clearGrids:function(){this._g={}},_hitGrids:function(b,a,c,e){for(var d=b;d<=c;d++)for(var f=a;f<=e;f++)if(b=d+","+f,this._g[b])return!0;return!1},_markGrids:function(b,a,c,e){for(var d=b;d<=c;d++)for(var f=a;f<=e;f++)b=d+","+f,this._g[b]=!0}});
G.Layer.VectorCache=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{cluster:[]},init:function(b,a){G.Layer.Graphic.prototype.init.call(this,a);this.url=b;this.options=G.Util.merge({},this.options,a);this._vts={};this._visVtKeys=[];this._vIds={}},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var b=this._map;G.Layer.Graphic.prototype._update.call(this);
b._isLoaded()&&(b=this._calcVisTileInfos(),this._addVts(b))},_addVts:function(b){if(0!==b.length){var a,c,e=[],d,f,h,k;a=0;for(c=b.length;a<c;a++)d=b[a],f=d[0],h=d[1],k=d[2],d=this._getTileName(f,h,k),e.push(d),d in this._vts?(f=this._vts[d],f.data&&this._processVt(d)):this._loadVt(f,h,k);a=0;for(c=this._visVtKeys.length;a<c;a++)d=this._visVtKeys[a],0>e.indexOf(d)&&this._removeVt(d);this._visVtKeys=e}},_removeVt:function(b){this._vts[b]&&this._stopLoadingVt(b)},_loadVt:function(b,a,c){var e=this,
d=e._getTileName(b,a,c),f=e._vts[d]=e._vts[d]||{};f._info=[b,a,c];""!==f.data&&(f.loading=!0,b=e._getTileUrl(b,a,c,{d:"f"}),a={responseType:"http"===b.slice(0,4).toLowerCase()?"JSONP":"JSON",success:function(a,b){f.data=b;e._processVt(d)},error:function(a){404==a.status&&(f.data="")},complete:function(){delete f.req;f.loading=!1}},b=G.Util.ajax(b,a),f.req=b)},_processVt:function(b){for(var a=this._map,c=this._vts[b].data,e=c.v,c=c.s,d,f,h,k,m,p=G.Util.colorHex,n=0,l=e.length;n<l;n++)d=e[n],f=d.id,
h=d.g,k=d.gt,d=d.st,d=c[d],(m=this._vIds[f])?m._updateGeom(h):"pt"===k?m=new G.Graphic.Point(h):"pl"===k?m=new G.Graphic.Polyline(h):"pg"===k&&(m=new G.Graphic.Polygon(h)),m&&(h=m.options,"pt"!==k&&"pl"===k&&(k=d.line_color,h.lineWidth=d.line_width,h.lineColor=p(k[0],k[1],k[2])),m&&(m.addTo(this),m._vtKeys=m._vtKeys||{},m._vtKeys[b]=!0,this._vIds[f]=m));a._requestRedraw()},_stopLoadingVt:function(b){b=this._vts[b];var a=G.Util.ajaxCancel;b&&(a(b.req),b.loading=!1)}});
G.Layer.FeatureService=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{mode:"all",vacuumCount:1E3},init:function(b,a){G.Layer.Graphic.prototype.init.call(this,a);this.options=G.Util.merge({},this.options,a);this._reqFunc=b;this._loadingKeys={}},onSuccess:function(b){"tile"==this.options.mode?this.fireEvent("loadTileSuccess",{extent:b}):this.fireEvent("loadAllSuccess")},onError:function(b){"tile"==this.options.mode?this.fireEvent("loadTileError",{extent:b}):this.fireEvent("loadAllError")},onComplete:function(b){if("tile"==
this.options.mode){var a=b.join(",");delete this._loadingKeys[a];this.fireEvent("loadTileComplete",{extent:b})}else this.fireEvent("loadAllComplete")},_update:function(){var b=this._map;G.Layer.Graphic.prototype._update.call(this);b._isLoaded()&&("tile"==this.options.mode?(this.count()>this.options.vacuumCount&&this._vacuum(),b=this._calcVisTileInfos(),this._addFts(b)):this._loadAll())},_addFts:function(b){if(0!==b.length){var a,c,e,d,f,h=this._loadingKeys,k={};a=0;for(c=b.length;a<c;a++)d=b[a],e=
d[0],f=d[1],d=d[2],f=this._calcTileExtent(e,f,d),e=f.join(","),k[e]=f;for(e in h)k[e]||(b=h[e],G.Util.ajaxCancel(b),delete h[e]);for(e in k)f=k[e],this._loadFt(f)}},_loadFt:function(b){var a=b.join(","),c=this._reqFunc;a in this._loadingKeys||!c||(c=c.call(this,b),this._loadingKeys[a]=c,this.fireEvent("loadTileStart",{extent:b}))},_loadAll:function(){var b=this._reqFunc;"all"in this._loadingKeys||!b||(b=b.call(this),this._loadingKeys.all=b,this.fireEvent("loadAllStart"))}});
G.Layer.GeoHeyFeature=G.Layer.FeatureService.extend({options:{apiKey:"",where:"1=1",outFields:"",limit:1E3},init:function(b,a){var c=this;G.Layer.FeatureService.prototype.init.call(c,function(a){var d=b+"/query",f=c.options,h={ak:f.apiKey,where:f.where,outFields:f.outFields,limit:f.limit};a&&(h.geometry=JSON.stringify(a));h={responseType:"http"===d.slice(0,4).toLowerCase()?"JSONP":"JSON",data:h,success:function(b,d){var h=d.data,n=h.geometryType;if(h=h.features){var l;l=h.length-1;for(var q=Math.max(0,
l-f.limit),r,u,s,t=[],v,w,y;l>=q;l--){r=h[l];u=r.id;s=r.geom;r=r.attrs||{};if("Point"==n)t.push(new G.Graphic.Point(s,r));else if("Polyline"==n)t.push(new G.Graphic.Polyline(s,r));else if("Polygon"==n)t.push(new G.Graphic.Polygon(s,r));else if("MultiPoint"==n)for(v in s.m)w=s.m[v],t.push(new G.Graphic.Point(w,r));else if("MultiPolyline"==n)for(v in s.m)w=s.m[v],t.push(new G.Graphic.Polyline(w,r));else if("MultiPolygon"==n)for(v in s.m)w=s.m[v],t.push(new G.Graphic.Polygon(w,r));for(y in t)if(r=t[y])s=
u+"_"+y,c.get(s)||r.addTo(c,s)}}c.onSuccess(a)},error:function(){c.onError(a)},complete:function(){c.onComplete(a)}};G.Util.ajax(d,h)},a)}});
G.Layer.GeoHeyProgressiveFeature=G.Layer.Graphic.extend({options:{stepFactor:4,stepCount:4,tolerance:8,outFields:"[]"},init:function(b,a){G.Layer.Graphic.prototype.init.call(this,a);this.url=b},onSuccess:function(b){this.fireEvent("extentSuccess",{extent:b})},onError:function(b){this.fireEvent("extentError",{extent:b})},onComplete:function(b){this.fireEvent("extentComplete",{extent:b})},_update:function(){var b=this._map,a=this._loadRes=b._res,c=this._loadExtent=b.getExtent(),e=this._loadedStatus;
if(!e||a!=e[0]||!G.ExtentUtil.equals(c,e[1]))if(G.Layer.Graphic.prototype._update.call(this),b._isLoaded()){(b=this._req)&&G.Util.ajaxCancel(b);var d,a=this._graphics;for(d in a)b=a[d],b._dirty=!0;this._loadStep(1)}},_loadStep:function(b){var a=this,c=a.options,e=a._loadRes,d=a._loadExtent,f=c.tolerance*Math.pow(c.stepFactor,c.stepCount-b),h=a.url+"/filter",c={responseType:"JSON",data:{extent:JSON.stringify(d),excludeExtents:JSON.stringify([]),res:e,cellPixel:f,outFields:c.outFields},success:function(c,
d){a._processResult(b,d)},complete:function(){a._req=null}};a._req=G.Util.ajax(h,c)},_processResult:function(b,a){var c=this.options,e=this._loadRes,d=this._loadExtent,f=c.tolerance*Math.pow(c.stepFactor,c.stepCount-b),f=e*f,h=a.geometryType,k=a.features;if(k){var m,p,n,l,q,r;for(m=k.length-1;0<=m;m--)if(p=k[m],n=p.id,l=p.geom,p=p.attrs||{},"Point"==h)r=new G.Graphic.Point(l,p),this._updateGraphic(f,n,0,r);else if("Polyline"==h)r=new G.Graphic.Polyline(l,p),this._updateGraphic(f,n,0,r);else if("Polygon"==
h)r=new G.Graphic.Polygon(l,p),this._updateGraphic(f,n,0,r);else if("MultiPoint"==h)for(q in l.multi)r=l.multi[q],r=new G.Graphic.Point(r,p),this._updateGraphic(f,n,q,r);else if("MultiPolyline"==h)for(q in l.multi)r=l.multi[q],r=new G.Graphic.Polyline(r,p),this._updateGraphic(f,n,q,r);else if("MultiPolygon"==h)for(q in l.multi)r=l.multi[q],r=new G.Graphic.Polygon(r,p),this._updateGraphic(f,n,q,r);b<c.stepCount?this._loadStep(b+1):(this._clearDirty(),this._loadedStatus=[e,d],this.onSuccess(d),this.onComplete(d))}else this.onError(d),
this.onComplete(d)},_updateGraphic:function(b,a,c,e){a+=c?"_"+c:"";(c=this.get(a))?(b<c._res&&(c.updateGeom(e.geom,!0),c._res=b),c._dirty=!1):(e._res=b,e.addTo(this,a))},_clearDirty:function(){var b=this._graphics,a,c;for(c in b)a=b[c],a._dirty&&a.remove()}});
G.Layer.TiledService=G.Layer.extend({mixins:[G.Layer.LOD],init:function(b,a){this.options=G.Util.merge({},this.options,a);this._reqFunc=b;this._loadingKeys={};this._loadedKeys={}},onSuccess:function(b,a){var c=parseInt(b[0]),e=parseInt(b[1]),d=parseInt(b[2]),c=this._getTileName(c,e,d);this._loadedKeys[c]=b;this.fireEvent("loadTileSuccess",{tileInfo:b,data:a})},onError:function(b){this.fireEvent("loadTileError",{tileInfo:b})},onComplete:function(b){var a=parseInt(b[0]),c=parseInt(b[1]),e=parseInt(b[2]),
a=this._getTileName(a,c,e);delete this._loadingKeys[a];this.fireEvent("loadTileComplete",{tileInfo:b})},_update:function(){if(this._map._isLoaded()){var b,a,c,e,d,f,h=this._calcVisTileInfos(),k={};b=0;for(a=h.length;b<a;b++)e=h[b],c=e[0],d=e[1],f=e[2],c=this._getTileName(c,d,f),k[c]=e;this._addTiles(k);for(c in this._loadedKeys)k[c]||(e=this._loadedKeys[c],delete this._loadedKeys[c],this.fireEvent("unusedTile",{tileInfo:e}))}},_addTiles:function(b){var a,c,e=this._loadingKeys;for(a in e)b[a]||(c=
e[a],G.Util.ajaxCancel(c),delete e[a]);for(a in b)c=b[a],this._loadTile(c)},_loadTile:function(b){var a=this._reqFunc,c=parseInt(b[0]),e=parseInt(b[1]),d=parseInt(b[2]),f=this._getTileName(c,e,d);f in this._loadingKeys||f in this._loadedKeys||!a||(a=a.call(this,c,e,d),this._loadingKeys[f]=a,this.fireEvent("loadTileStart",{tileInfo:b}))}});
G.Graphic.Point=G.Graphic.Point.extend({_onAdded:function(){this._dom||(this._dom=G.DomUtil.createSVG("g"));this._points={};var b=this._layer._map;b&&b._requestRedraw()},_onRemoved:function(){var b=this._dom;b&&b.parentNode&&b.parentNode.removeChild(b);(b=this._layer._map)&&b._requestRedraw()},_draw:function(){var b=G.DomUtil,a=this.options,c=this._layer,e=c._map;if(this.geom){c=c._svg;this._dom&&(c&&!this._dom.parentNode)&&c.appendChild(this._dom);var d=e.getSize(),f=e.getDrawSize(),c=(f[0]-d[0])/
2,d=(f[1]-d[1])/2,f=e._rotate,h=a.shape,k=a.size,m=k[0],k=k[1],p=a.offset,n=a.imageRotate;"image"==h&&n&&(f-=n);"image"!=h||a.imageGravity||(f-=e._rotate);for(var n=this.geom[0],l=this.geom[1],q=e._calcWrapPointRange(this.geom)||[0,0],r=e.options.maxExtent,r=r[2]-r[0],u=q[0];u<=q[1];u++){var s=this._points[u];s||(s="rect"==h?this._points[u]=b.createSVG("rect"):"image"==h?this._points[u]=b.createSVG("image"):"text"==h?this._points[u]=b.createSVG("text"):this._points[u]=b.createSVG("circle"),s._graphic=
this,this._dom.appendChild(s));var t=e.toScreen([n+u*r,l],0,0,!0),v=t[0]+c,w=t[1]+d,t=v+p[0],y=w+p[1],v="rotate("+-f+","+v+","+w+")";if("circle"==h)s.setAttribute("cx",t),s.setAttribute("cy",y),s.setAttribute("r",m/2);else if("rect"==h)s.setAttribute("x",t-m/2),s.setAttribute("y",y-k/2),s.setAttribute("width",m),s.setAttribute("height",k);else if("image"==h)s.setAttribute("x",t),s.setAttribute("y",y),s.setAttribute("width",m),s.setAttribute("height",k),t=G.Browser.getImageSrc(a.image),s.setAttributeNS(G.DomUtil.XLINK_NS,
"href",t);else if("text"==h){w=a.text;if(!this._textMeasureWidth||this._textMeasure!=w){var x=b.create("div","",document.body);x.style.position="absolute";x.style.visibility="hidden";x.style.width=x.style.height="auto";x.style.fontFamily=a.textFont;x.style.fontStyle="italic"==a.textStyle?"italic":"normal";x.style.fontWeight="bold"==a.textStyle?"bold":"normal";x.style.fontSize=m+"px";x.innerHTML=w;this._textMeasureWidth=x.clientWidth+4;x.parentNode.removeChild(x);this._textMeasure=w}s.setAttribute("x",
t);s.setAttribute("y",y);s.setAttribute("font-size",m+"px");s.setAttribute("text-anchor","center"==a.textAlign?"middle":"left"==a.textAlign?"start":"end");s.setAttribute("alignment-baseline","middle");s.setAttribute("font-family",a.textFont);s.setAttribute("font-style","italic"==a.textStyle?"italic":"normal");s.setAttribute("font-weight","bold"==a.textStyle?"bold":"normal");s.innerHTML=s.textContent=a.text}s.setAttribute("transform",v)}this._updateStyles()}},_updateStyles:function(){var b=G.DomUtil,
a=this.options,c=this._layer._defs,e;for(e in this._points){var d=this._points[e];(a.outline||this._mouseOver||this._editing)&&"text"!=a.shape?(d.setAttribute("stroke",this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor),d.setAttribute("stroke-dasharray",a.outlineDashArray.join(" ")),d.setAttribute("stroke-width",this._mouseOver?a.outlineWidth+a.lineHighlightWiden:a.outlineWidth),d.setAttribute("stroke-opacity",a.outlineOpacity)):d.setAttribute("stroke","none");if(a.fill)if(a.fillImage){var f=
G.Browser.getImageSrc(a.fillImage),h=a.fillImageSize,f=b.svgImagePattern(c,f,h[0],h[1]);d.setAttribute("fill","url(#"+f+")");d.setAttribute("fill-opacity",a.fillOpacity)}else a.gradual?(f=b.svgGradient(c,a.fillColor,a.fillOpacity),d.setAttribute("fill","url(#"+f+")")):(d.setAttribute("fill",a.fillColor),d.setAttribute("fill-opacity",a.fillOpacity));else d.setAttribute("fill","none")}},_onStartEdit:function(){var b=this._layer._map,a=this.virtualMouse;for(i in a.DOWN)b.addListener(a.DOWN[i],this._onVertexDragStart,
this);this._refreshVertexes()},_onEndEdit:function(){var b=this._layer._map,a=this.virtualMouse,c,e;for(c in a.DOWN)e=a.DOWN[c],b.removeListener(e,this._onVertexDragStart,this),b.removeListener(a.MOVE[e],this._onVertexDrag,this),b.removeListener(a.UP[e],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var b=this._layer;if(b){var b=b._map,a=G.DomUtil,c=b._handlers.Drag;!c||(c._dragging||this.options.allowPan)||c.off();this._updateStyles();this._isVertex?a.addClass(b._layersFrame,
"g-edit"):a.addClass(b._layersFrame,"g-clickable")}},_onMouseOut:function(){var b=this._layer;if(b){var b=b._map,a=G.DomUtil,c=b._handlers.Drag;if(c&&!c._dragging)c.on();this._updateStyles();this._isVertex?a.removeClass(b._layersFrame,"g-edit"):a.removeClass(b._layersFrame,"g-clickable")}}});
G.Graphic.Polyline=G.Graphic.Polyline.extend({_onAdded:function(){this._dom||(this._dom=G.DomUtil.createSVG("g"));this._polylines={};var b=this._layer._map;b&&b._requestRedraw()},_onRemoved:function(){var b=this._dom;b&&b.parentNode&&b.parentNode.removeChild(b);(b=this._layer._map)&&b._requestRedraw()},_draw:function(){var b=G.DomUtil,a=this._layer,c=a._map;if(this.geom){a=a._svg;this._dom&&(a&&!this._dom.parentNode)&&a.appendChild(this._dom);for(var e=c.getSize(),d=c.getDrawSize(),a=(d[0]-e[0])/
2,e=(d[1]-e[1])/2,d=this.geom,f=d.length,h=this.bbox,h=c._calcWrapPointRange([(h[0]+h[2])/2,(h[1]+h[3])/2])||[0,0],k=c.options.maxExtent,k=k[2]-k[0],m=h[0];m<=h[1];m++){var p=this._polylines[m];p||(p=this._polylines[m]=b.createSVG("polyline"),p._graphic=this,this._dom.appendChild(p));for(var n="",l,q,r=0;r<f;r++)l=c.toScreen([d[r][0]+m*k,d[r][1]],0,0,!0),q=l[0]+a,l=l[1]+e,n+=n?" ":"",n+=q+","+l;p.setAttribute("points",n)}this._updateStyles()}},_updateStyles:function(){var b=this.options,a;for(a in this._polylines){var c=
this._polylines[a];c.setAttribute("stroke",this._editing?b.lineHighlightColor:b.lineColor);c.setAttribute("stroke-dasharray",b.lineDashArray.join(" "));c.setAttribute("stroke-linecap",b.lineCap);c.setAttribute("stroke-linejoin",b.lineJoin);c.setAttribute("stroke-opacity",b.lineOpacity);c.setAttribute("stroke-width",this._mouseOver?b.lineWidth+b.lineHighlightWiden:b.lineWidth);c.setAttribute("fill","none")}},_onStartEdit:function(){var b=this._layer._map,a=this.virtualMouse;for(i in a.DOWN)b.addListener(a.DOWN[i],
this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var b=this._layer._map,a=this.virtualMouse,c,e;for(c in a.DOWN)e=a.DOWN[c],b.removeListener(e,this._onVertexDragStart,this),b.removeListener(a.MOVE[e],this._onVertexDrag,this),b.removeListener(a.UP[e],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var b=this._layer._map,a=b._handlers.Drag;if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.addClass(b._layersFrame,"g-clickable")},_onMouseOut:function(){var b=
this._layer._map,a=b._handlers.Drag;if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.removeClass(b._layersFrame,"g-clickable")}});
G.Graphic.Polygon=G.Graphic.Polygon.extend({_onAdded:function(){this._dom||(this._dom=G.DomUtil.createSVG("g"));this._polygons={};var b=this._layer._map;b&&b._requestRedraw()},_onRemoved:function(){var b=this._dom;b&&b.parentNode&&b.parentNode.removeChild(b);(b=this._layer._map)&&b._requestRedraw()},_draw:function(){var b=G.DomUtil,a=this._layer,c=a._map;if(this.geom){a=a._svg;this._dom&&(a&&!this._dom.parentNode)&&a.appendChild(this._dom);for(var e=c.getSize(),d=c.getDrawSize(),a=(d[0]-e[0])/2,e=
(d[1]-e[1])/2,d=this.geom,f=this.bbox,f=c._calcWrapPointRange([(f[0]+f[2])/2,(f[1]+f[3])/2])||[0,0],h=c.options.maxExtent,h=h[2]-h[0],k=f[0];k<=f[1];k++){var m=this._polygons[k];m||(m=this._polygons[k]=b.createSVG("path"),m._graphic=this,this._dom.appendChild(m));for(var p="",n,l,q,r,u=0,s=d.length;u<s;u++){n=d[u];l="";for(var t=0,v=n.length;t<v;t++)q=c.toScreen([n[t][0]+k*h,n[t][1]],0,0,!0),r=q[0]+a,q=q[1]+e,l+=0===t?" M ":"",l+=1===t?" L ":" ",l+=r+" "+q;l+=" Z";p+=l}m.setAttribute("d",p)}this._updateStyles()}},
_updateStyles:function(){var b=G.DomUtil,a=this.options,c=this._layer._defs,e;for(e in this._polygons){var d=this._polygons[e];a.outline||this._mouseOver||this._editing?(d.setAttribute("stroke",this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor),d.setAttribute("stroke-dasharray",a.outlineDashArray.join(" ")),d.setAttribute("stroke-linecap",a.outlineCap),d.setAttribute("stroke-linejoin",a.outlineJoin),d.setAttribute("stroke-width",(a.outline?a.outlineWidth:0)+(this._mouseOver?
a.lineHighlightWiden:0)),d.setAttribute("stroke-opacity",a.outlineOpacity)):d.setAttribute("stroke","none");if(a.fill){if(a.fillImage){var f=G.Browser.getImageSrc(a.fillImage),h=a.fillImageSize,f=b.svgImagePattern(c,f,h[0],h[1]);d.setAttribute("fill","url(#"+f+")")}else d.setAttribute("fill",a.fillColor);d.setAttribute("fill-opacity",a.fillOpacity)}else d.setAttribute("fill","none")}},_updateMask:function(){var b=G.DomUtil,a=this._map;if(this.geom){this._masks=this._masks||{};for(var c=a.getSize(),
e=a.getDrawSize(),d=(e[0]-c[0])/2,c=(e[1]-c[1])/2,e=this.geom,f=this.bbox,f=a._calcWrapPointRange([(f[0]+f[2])/2,(f[1]+f[3])/2])||[0,0],h=a.options.maxExtent,h=h[2]-h[0],k=f[0];k<=f[1];k++){var m=this._masks[k];m||(m=this._masks[k]=b.createSVG("path"),m._graphic=this);for(var p="",n,l,q,r,u=0,s=e.length;u<s;u++){n=e[u];l="";for(var t=0,v=n.length;t<v;t++)q=a.toScreen([n[t][0]+k*h,n[t][1]],0,0,!0),r=q[0]+d,q=q[1]+c,l+=0===t?" M ":"",l+=1===t?" L ":" ",l+=r+" "+q;l+=" Z";p+=l}m.setAttribute("d",p)}}},
_onStartEdit:function(){var b=this._layer._map,a=this.virtualMouse;for(i in a.DOWN)b.addListener(a.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var b=this._layer._map,a=this.virtualMouse,c,e;for(c in a.DOWN)e=a.DOWN[c],b.removeListener(e,this._onVertexDragStart,this),b.removeListener(a.MOVE[e],this._onVertexDrag,this),b.removeListener(a.UP[e],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var b=this._layer._map,a=b._handlers.Drag;
if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.addClass(b._layersFrame,"g-clickable")},_onMouseOut:function(){var b=this._layer._map,a=b._handlers.Drag;if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.removeClass(b._layersFrame,"g-clickable")}});
G.Graphic.Circle=G.Graphic.Circle.extend({_onAdded:function(){this._dom||(this._dom=G.DomUtil.createSVG("g"));this._circles={};var b=this._layer._map;b&&b._requestRedraw()},_onRemoved:function(){var b=this._dom;b&&b.parentNode&&b.parentNode.removeChild(b);(b=this._layer._map)&&b._requestRedraw()},_draw:function(){var b=G.DomUtil,a=this._layer,c=a._map;if(this.geom){a=a._svg;this._dom&&(a&&!this._dom.parentNode)&&a.appendChild(this._dom);for(var e=c.getSize(),d=c.getDrawSize(),a=(d[0]-e[0])/2,e=(d[1]-
e[1])/2,d=c._res,f=this.geom[0],h=this.geom[1],k=this.geom[2],m=c._calcWrapPointRange(this.geom)||[0,0],p=c.options.maxExtent,p=p[2]-p[0],n=m[0];n<=m[1];n++){var l=this._circles[n];l||(l=this._circles[n]=b.createSVG("circle"),l._graphic=this,this._dom.appendChild(l));var q=c.toScreen([f+n*p,h],0,0,!0),r=q[1]+e,u=k/d;l.setAttribute("cx",q[0]+a);l.setAttribute("cy",r);l.setAttribute("r",u)}this._updateStyles()}},_updateStyles:function(){var b=G.DomUtil,a=this.options,c=this._layer._defs,e;for(e in this._circles){var d=
this._circles[e];a.outline||this._mouseOver||this._editing?(d.setAttribute("stroke",this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor),d.setAttribute("stroke-dasharray",a.outlineDashArray.join(" ")),d.setAttribute("stroke-linecap",a.outlineCap),d.setAttribute("stroke-linejoin",a.outlineJoin),d.setAttribute("stroke-width",this._mouseOver?a.outlineWidth+a.lineHighlightWiden:a.outlineWidth),d.setAttribute("stroke-opacity",a.outlineOpacity)):this._mouseOver?(d.setAttribute("stroke",
a.outlineColor),d.setAttribute("stroke-width",this._mouseOver?a.lineHighlightWiden:0)):d.setAttribute("stroke","none");if(a.fill)if(a.fillImage){var f=G.Browser.getImageSrc(a.fillImage),h=a.fillImageSize,f=b.svgImagePattern(c,f,h[0],h[1]);d.setAttribute("fill","url(#"+f+")");d.setAttribute("fill-opacity",a.fillOpacity)}else a.gradual?(f=b.svgGradient(c,a.fillColor,a.fillOpacity),d.setAttribute("fill","url(#"+f+")")):(d.setAttribute("fill",a.fillColor),d.setAttribute("fill-opacity",a.fillOpacity));
else d.setAttribute("fill","none")}},_updateMask:function(){var b=G.DomUtil,a=this._map;if(this.geom){this._masks=this._masks||{};for(var c=a.getSize(),e=a.getDrawSize(),d=(e[0]-c[0])/2,c=(e[1]-c[1])/2,e=a._res,f=this.geom,h=f[0],k=f[1],f=f[2],m=a._calcWrapPointRange([h,k])||[0,0],p=a.options.maxExtent,p=p[2]-p[0],n=m[0];n<=m[1];n++){var l=this._masks[n];l||(l=this._masks[n]=b.createSVG("circle"),l._graphic=this);var q=a.toScreen([h+n*p,k],0,0,!0),r=q[1]+c,u=f/e;l.setAttribute("cx",q[0]+d);l.setAttribute("cy",
r);l.setAttribute("r",u)}}},_onStartEdit:function(){var b=this._layer._map,a=this.virtualMouse;for(i in a.DOWN)b.addListener(a.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var b=this._layer._map,a=this.virtualMouse,c,e;for(c in a.DOWN)e=a.DOWN[c],b.removeListener(e,this._onVertexDragStart,this),b.removeListener(a.MOVE[e],this._onVertexDrag,this),b.removeListener(a.UP[e],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var b=this._layer._map,
a=b._handlers.Drag;if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.addClass(b._layersFrame,"g-clickable")},_onMouseOut:function(){var b=this._layer._map,a=b._handlers.Drag;if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.removeClass(b._layersFrame,"g-clickable")}});
G.Graphic.Arrow=G.Graphic.Arrow.extend({_onAdded:function(){this._dom||(this._dom=G.DomUtil.createSVG("g"));this._polygons={};var b=this._layer._map;b&&b._requestRedraw()},_onRemoved:function(){var b=this._dom;b&&b.parentNode&&b.parentNode.removeChild(b);(b=this._layer._map)&&b._requestRedraw()},_draw:function(){var b=G.DomUtil,a=this._layer,c=a._map;this._updateGeomDraw(c._res);if(this._geomDraw){a=a._svg;this._dom&&(a&&!this._dom.parentNode)&&a.appendChild(this._dom);for(var e=c.getSize(),d=c.getDrawSize(),
a=(d[0]-e[0])/2,e=(d[1]-e[1])/2,d=this._geomDraw,f=this.bbox,f=c._calcWrapPointRange([(f[0]+f[2])/2,(f[1]+f[3])/2])||[0,0],h=c.options.maxExtent,h=h[2]-h[0],k=f[0];k<=f[1];k++){var m=this._polygons[k];m||(m=this._polygons[k]=b.createSVG("path"),m._graphic=this,this._dom.appendChild(m));for(var p="",n,l,q,r,u=0,s=d.length;u<s;u++){n=d[u];l="";for(var t=0,v=n.length;t<v;t++)q=c.toScreen([n[t][0]+k*h,n[t][1]],0,0,!0),r=q[0]+a,q=q[1]+e,l+=0===t?" M ":"",l+=1===t?" L ":" ",l+=r+" "+q;l+=" Z";p+=l}m.setAttribute("d",
p)}this._updateStyles()}},_updateStyles:function(){var b=G.DomUtil,a=this.options,c=this._layer._defs,e;for(e in this._polygons){var d=this._polygons[e];a.outline||this._mouseOver||this._editing?(d.setAttribute("stroke",this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor),d.setAttribute("stroke-dasharray",a.outlineDashArray.join(" ")),d.setAttribute("stroke-linecap",a.outlineCap),d.setAttribute("stroke-linejoin",a.outlineJoin),d.setAttribute("stroke-width",(a.outline?a.outlineWidth:
0)+(this._mouseOver?a.lineHighlightWiden:0)),d.setAttribute("stroke-opacity",a.outlineOpacity)):d.setAttribute("stroke","none");if(a.fill){if(a.fillImage){var f=G.Browser.getImageSrc(a.fillImage),h=a.fillImageSize,f=b.svgImagePattern(c,f,h[0],h[1]);d.setAttribute("fill","url(#"+f+")")}else d.setAttribute("fill",a.fillColor);d.setAttribute("fill-opacity",a.fillOpacity)}else d.setAttribute("fill","none")}},_updateMask:function(){var b=G.DomUtil,a=this._map;this._updateGeomDraw(a._res);if(this._geomDraw){this._masks=
this._masks||{};for(var c=a.getSize(),e=a.getDrawSize(),d=(e[0]-c[0])/2,c=(e[1]-c[1])/2,e=this._geomDraw,f=this.bbox,f=a._calcWrapPointRange([(f[0]+f[2])/2,(f[1]+f[3])/2])||[0,0],h=a.options.maxExtent,h=h[2]-h[0],k=f[0];k<=f[1];k++){var m=this._masks[k];m||(m=this._masks[k]=b.createSVG("path"),m._graphic=this);for(var p="",n,l,q,r,u=0,s=e.length;u<s;u++){n=e[u];l="";for(var t=0,v=n.length;t<v;t++)q=a.toScreen([n[t][0]+k*h,n[t][1]],0,0,!0),r=q[0]+d,q=q[1]+c,l+=0===t?" M ":"",l+=1===t?" L ":" ",l+=
r+" "+q;l+=" Z";p+=l}m.setAttribute("d",p)}}},_onStartEdit:function(){var b=this._layer._map,a=this.virtualMouse;for(i in a.DOWN)b.addListener(a.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var b=this._layer._map,a=this.virtualMouse,c,e;for(c in a.DOWN)e=a.DOWN[c],b.removeListener(e,this._onVertexDragStart,this),b.removeListener(a.MOVE[e],this._onVertexDrag,this),b.removeListener(a.UP[e],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var b=
this._layer._map,a=b._handlers.Drag;if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.addClass(b._layersFrame,"g-clickable")},_onMouseOut:function(){var b=this._layer._map,a=b._handlers.Drag;if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.removeClass(b._layersFrame,"g-clickable")}});
G.Graphic.Group=G.Graphic.Group.extend({_updateStyles:function(){var b=this._graphics,a,c,e;if(b&&b.length)for(a=0,c=b.length;a<c;a++)e=b[a],e._updateStyles&&e._updateStyles()},_onMouseOver:function(){var b=this._layer._map,a=b._handlers.Drag;if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.addClass(b._layersFrame,"g-clickable")},_onMouseOut:function(){var b=this._layer._map,a=b._handlers.Drag;if(a&&!a._dragging)a.on();this._updateStyles();G.DomUtil.removeClass(b._layersFrame,"g-clickable")}});
G.Map=G.Map.extend({_initAddition:function(){var b=G.DomUtil,a=this._maskFrame,c=a._svg=b.createSVG("svg","g-graphic-container g-zoom-animated",a),c=a._defs=b.createSVG("defs","",c),a=a._mask=b.createSVG("mask","",c);a.setAttribute("id","svg_mask");b=a._base=b.createSVG("rect","",a);b.setAttribute("width","100%");b.setAttribute("height","100%");b.setAttribute("fill","#fff");this._mode="svg"},_drawMask:function(){var b=this.options,a=G.DomUtil,c=this._maskFrame,e=c._svg,d=c._mask;if(b.mask&&this._masks&&
0<this._masks.length){a.show(e);var c=a.getPosition(this._mapFrame),f=this.getSize(),h=this.getDrawSize(),k=h[0],h=h[1];e.style[a.Transform]=a.genTranslateStyle(-((k-f[0])/2),-((h-f[1])/2));e.setAttribute("width",k);e.setAttribute("height",h);e.setAttribute("viewBox",[-c[0],-c[1],k,h].join(" "));var f=this.getCenter(),m=this._res;G.ExtentUtil.intersect([f[0]-k*m/2,f[1]-h*m/2,f[0]+k*m/2,f[1]+h*m/2],this.options.maxExtent);for(var p in this._masks){f=this._masks[p];f._updateMask();for(var n in f._masks)(m=
f._masks[n])&&(m.parentNode||d.appendChild(m))}a=e._rect=e._rect?e._rect:a.createSVG("rect");a.setAttribute("x",-c[0]);a.setAttribute("y",-c[1]);a.setAttribute("width",k);a.setAttribute("height",h);a.setAttribute("mask","url(#svg_mask)");a.setAttribute("fill",b.maskColor);a.setAttribute("fill-opacity",b.maskOpacity);a.parentNode||e.appendChild(a)}else a.hide(e)},_onZoomStart:function(b){var a=this._mapFrame,c=this._maskFrame._svg,e=this._rotate,d=G.DomUtil,f=d.Transition,d=d.Transform;self._zooming||
(self._zooming=!0);var h=this.getSize(),k=this.getDrawSize(),m=(k[0]-h[0])/2,k=(k[1]-h[1])/2,h=[h[0]/2,h[1]/2],p=b.aroundScreen||h,n=h[0]-p[0],l=h[1]-p[1];e&&(n&&l)&&(e=G.MathUtil.rotateVector([n,l],-e),p=[h[0]-e[0],h[1]-e[1]]);p=self._aroundScreen=[p[0]-h[0],p[1]-h[1]];b=G.DomUtil.genScaleStyle(1/b.scale,p[0],p[1],-m,-k);c.style[d]=b;this._zoomAnim&&this._zoomAnim._params.ignoreAnim||(c.style[f]=a.style[f])},_onZoomUpdate:function(b){var a=this._mapFrame,c=this._maskFrame._svg,e=G.DomUtil,d=e.Transition,
e=e.Transform;if(self._zooming){var f=self._aroundScreen,h=this.getSize(),k=this.getDrawSize();b=G.DomUtil.genScaleStyle(1/b.scale,f[0],f[1],-((k[0]-h[0])/2),-((k[1]-h[1])/2));c.style[e]=b;this._zoomAnim&&this._zoomAnim._params.ignoreAnim||(c.style[d]=a.style[d])}},_onZoomEnd:function(){var b=this._maskFrame._svg,a=G.DomUtil,c=this.getSize(),e=this.getDrawSize(),d=(e[0]-c[0])/2,c=(e[1]-c[1])/2;b.style.visibility="";b.parentNode.appendChild(b);b.style[a.Transform]=a.genTranslateStyle(-d,-c);b.style[a.Transition]=
"";self._zooming=!1}});
